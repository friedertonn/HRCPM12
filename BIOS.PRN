	MACRO-80 3.44	09-Dec-81	PAGE	1


                                ; ***********************************************************
                                ; *                                                         *
                                ; *  HRCPM12-BIOS fuer den AC1      Version vom 06.08.2023  *
                                ; *                                                         *
                                ; *                                                BIOS136  *
                                ; *                                                         *
                                ; ***********************************************************
                                ;
                                ; Korrekturen/Fehlerbehebungen am HRCPM12:
                                ; - alle nicht genutzten Programmteile (HRDOS?) entfernt
                                ; - LOAD (Turbo) entfernt
                                ; - BWS(Farb)Init geaendert
                                ; - ^G BEEP + PUNCH:=V24out + LIST:=V24out zugefuegt
                                ; - keine Pruefsumme, kein Vergleichslesen v. RAM-Disk (entfernt)
                                ; - fehlerhafte Maskierung USER in WBOOT entfernt
                                ; - Kursorblinken im Texteditor
                                ; - Consolenkommandos Kursor-ON / Kursor-OFF
                                ; - RAM-Disk mit 64 REC/TRK, Systemspur 16k -> 8k, dadurch 8k mehr f. Daten
                                ; - GIDE-Laufwerke (C:, D:, E:) auf 8MB, da nicht alle BDOS'se mit mehr
                                ;   als 16 Bit fuer REC-NR. zurechtkommen.
                                ; - Formatierung RAM-Disk: letzter Sektor wurde nicht formatiert
                                ;
                                ; Neu hinzugekommen:
                                ; - EXIT loescht CCPPUFLEN (B132)
                                ; - WBOOT loescht CCPPUFLEN, weil in Systemspur "aktiver Befehl" (B133)
                                ; - Eintragen von NMI auf 066h in BOOT1 entfernt (CPM Page-Zero) (B133)
                                ; - Tastaturpuffer von FFD0h -> FF00h , "d"-Befehl ueberschrieben (B134)
                                ; - nicht benutzte "Arbeitszellen" am Ende auskommentiert (B135)
                                ; - automatische Erkennung der RAM-Disk Groesse 256k/1024k/2048k (B136)
                                ;
                                        IF1
                                        .PRINTX 'PASS 1'
                                        ENDIF
                                ;
                                        IF2
                                        .PRINTX 'PASS 2'
                                        ENDIF
                                ;
                                        .CREF
                                        .Z80
                                ;
                                        .PHASE 0E600H
                                ;
                                ;
  07F1                          OUTHL   EQU  07F1H
  01A5                          RSA     EQU  01A5H        ;CPU-Register nach RSA - nicht Monitor 11 !
  05CE                          REGIST  EQU  05CEH        ;Registeranzeige - nicht Monitor 11 !
  0DF9                          MV24A   EQU  0DF9H        ;MO-UP V24-Out
                                ;
                                ;
  1800                          CUPOS   EQU  1800H
  1818                          BREAK   EQU  1818H        ;NMI Sprungziel
  181F                          CBWSB   EQU  181FH        ;Merkzelle fuer das Farbbyte im AC1-Monitor 
                                ;                         ;0=kein Color-BWS, sonst der eingestellte Farbwert
  185B                          ARG1    EQU  185BH
  185D                          ARG2    EQU  185DH
                                ;
                                ;
  0000                          WARMBT  EQU  0000H        ;WBOOT der Grundseite
  0005                          BDOSF   EQU  0005H        ;BDOS-Aufruf + TPA-MAX
  0038                          RST38   EQU  0038H        ;CP/M-Break
  0066                          NMI     EQU  0066H
	MACRO-80 3.44	09-Dec-81	PAGE	1-1


                                ;
                                ;
  0003                          IOBYTE  EQU  0003H
  0004                          LWBYTE  EQU  0004H        ;LW (Bit0-3) + USER Nr.(Bit4-7)
                                ;
  FF00                          ZEIPUF  EQU  0FF00H       ;1 + 32 Byte Puffer fuer Tastatur
                                ;                          --> war urspruenlich auf 0FFD0H
                                ;                          --> ueberschreibt den "d"-Befehl
                                ;
  D806                          BDOS    EQU  0D806H       ;BDOS-EinsprungAdresse
  E603                          WBOOTB  EQU  0E603H       ;BIOS-Eisprung WBOOT
                                ;
                                ;
  C000                          HPRDSK  EQU  0C000H       ;Hilfsprogramm: Format RAM-Disk
  D000                          CCP     EQU  0D000H       ;Start CCP
  D007                          COMLEN  EQU  CCP+07       ;CCP-Kommandopuffer-Laenge
                                ;
  00E0                          PE0     EQU  0E0H         ;Grundadresse der RAM-Disk
  00F0                          PF0     EQU  0F0H         ;BWS-CPLD-(Steuer)Port
                                ;
  0040                          CFDC    EQU  40H          ;Hauptstatusregister FDC
  0041                          DFDC    EQU  41H          ;Datenport FDC
  0043                          WAIT    EQU  43H          ;IO-Adr. /WAIT Monoflop
  0045                          LATCH   EQU  45H          ;IO-Adr. Latch 74LS175
                                ;
  000F                          CUZEI   EQU  0FH          ;KursorSymbol
                                ;
                                ;============================================================================
                                ;
  E600    C3 E86C                       JP   BOOT
  E603    C3 E930                       JP   WBOOT
  E606    C3 EA57                       JP   CONST
  E609    C3 EA5F                       JP   CONIN
  E60C    C3 EAD7                       JP   CONOUT
  E60F    C3 EAAE                       JP   LIST
  E612    C3 EACA                       JP   PUNCH
  E615    C3 EA5F                       JP   CONIN        ;eigentlich JP READER
  E618    C3 EE0C                       JP   HOME
  E61B    C3 EDED                       JP   SELDSK
  E61E    C3 EE0F                       JP   SETTRK
  E621    C3 EE14                       JP   SETSEC
  E624    C3 EE19                       JP   SETDMA
  E627    C3 EE2A                       JP   READ
  E62A    C3 EE2F                       JP   WRITE
  E62D    C3 EDEA                       JP   LISTST
  E630    C3 EE1E                       JP   SECTRN
                                ;
  E633    43 38 35 41                   DEFM 'C85AC'      ;fuer PC/BC Progr.
  E637    43                    
  E638    C3 E9B8                       JP   EXIT         ;User-Kommando EXIT
  E63B    C3 EFF8                       JP   LOAD         ;User-Kommando LOAD
  E63E    C3 0000                       JP   0000H
                                ;
  E641    07                    NDISK:  DEFB 7            ;Anzahl der LW = 7
                                ;
  E642    E644                  DPHX:   DEFW DPHY         ;Zeiger auf den 1. Block?
  E644    E652                  DPHY:   DEFW DPH0         ;DPH von LW A:
  E646    E662                          DEFW DPH1         ;DPH von LW B:
  E648    E672                          DEFW DPH2         ;DPH von LW C:
  E64A    E682                          DEFW DPH3         ;DPH von LW D:
  E64C    E692                          DEFW DPH4         ;DPH von LW E:
  E64E    E6A2                          DEFW DPH5         ;DPH von LW F:
	MACRO-80 3.44	09-Dec-81	PAGE	1-2


  E650    E6B2                          DEFW DPH6         ;DPH von LW G:
                                ;
  E652    0000                  DPH0:   DEFW 0            ;RAM-Disk A:
  E654    0000                          DEFW 0
  E656    0000                          DEFW 0
  E658    0000                          DEFW 0
  E65A    F881                          DEFW DIRBF
  E65C    E6C4                          DEFW DPB0
  E65E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E660    F901                          DEFW ALL00
                                ;
  E662    0000                  DPH1:   DEFW 0            ;Floppy B:
  E664    0000                          DEFW 0
  E666    0000                          DEFW 0
  E668    0000                          DEFW 0
  E66A    F881                          DEFW DIRBF
  E66C    E6D5                          DEFW DPB1
  E66E    FE0F                          DEFW CHK01
  E670    F981                          DEFW ALL01
                                ;
  E672    0000                  DPH2:   DEFW 0            ;GIDE C:
  E674    0000                          DEFW 0
  E676    0000                          DEFW 0
  E678    0000                          DEFW 0
  E67A    F881                          DEFW DIRBF
  E67C    E6F1                          DEFW DPB2
  E67E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E680    F9B3                          DEFW ALL02
                                ;
  E682    0000                  DPH3:   DEFW 0            ;GIDE D:
  E684    0000                          DEFW 0
  E686    0000                          DEFW 0
  E688    0000                          DEFW 0
  E68A    F881                          DEFW DIRBF
  E68C    E70D                          DEFW DPB3
  E68E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E690    FBAB                          DEFW ALL03
                                ;
  E692    0000                  DPH4:   DEFW 0            ;GIDE E:
  E694    0000                          DEFW 0
  E696    0000                          DEFW 0
  E698    0000                          DEFW 0
  E69A    F881                          DEFW DIRBF
  E69C    E729                          DEFW DPB4
  E69E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E6A0    FCAB                          DEFW ALL04
                                ;
  E6A2    0000                  DPH5:   DEFW 0            ;Floppy F:
  E6A4    0000                          DEFW 0
  E6A6    0000                          DEFW 0
  E6A8    0000                          DEFW 0
  E6AA    F881                          DEFW DIRBF
  E6AC    E745                          DEFW DPB5
  E6AE    FE2F                          DEFW CHK05
  E6B0    FDAB                          DEFW ALL05
                                ;
  E6B2    0000                  DPH6:   DEFW 0            ;Floppy G:
  E6B4    0000                          DEFW 0
  E6B6    0000                          DEFW 0
  E6B8    0000                          DEFW 0
  E6BA    F881                          DEFW DIRBF
  E6BC    E761                          DEFW DPB6
	MACRO-80 3.44	09-Dec-81	PAGE	1-3


  E6BE    FE4F                          DEFW CHK06
  E6C0    FDDD                          DEFW ALL06
                                ;
                                ; https://hc-ddr.hucki.net/wiki/doku.php/cpm/write_a_bios/teil_1
                                ;
  E6C2    EE56                          DEFW RDSKRW       ;Routine zum Lesen/Schreiben der RAM-Disk
                                ;
                                ;RAM-Disk 256 KByte
  E6C4    0040                  DPB0:   DEFW 64           ;64 Sectoren/Track (Rec/Trk) = 8 Kbyte/Track
  E6C6    03                            DEFB 3            ;Blockgroesse = 1 Kbyte
  E6C7    07                            DEFB 7
  E6C8    00                            DEFB 0            ;8-Bit Blockadressen im FCB/DIR, da weniger als 255 Bloecke
  E6C9    00F7                          DEFW 247          ;248 * 1 Kbyte-Bloecke  -> 256k-8k(System)=248k(CP/M) ( - 2k(DIR) -> 246k (NETTO f. Daten))
  E6CB    003F                          DEFW 63           ;64 DIR - Eintaege
  E6CD    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E6CF    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E6D1    0001                          DEFW 1            ;8 Kbyte System / Track-Offset
                                ;
  E6D3    F018                          DEFW LF019        ;? Blocking / Deblocking
                                ;
                                ;Floppy 780 KByte
  E6D5    0050                  DPB1:   DEFW 80           ;80 Sectoren/Track
  E6D7    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E6D8    0F                            DEFB 15
  E6D9    00                            DEFB 0
  E6DA    0185                          DEFW 389          ;390 * 2 Kbyte - Bloecke
  E6DC    007F                          DEFW 127          ;128 DIR - Eintraege
  E6DE    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E6E0    0020                          DEFW 32
  E6E2    0002                          DEFW 2            ;20 Kbyte System
                                ;
  E6E4    03 07 05 25                   DEFB 3,7,5,25H
  E6E8    50 00 43 FF                   DEFB 50H,0,43H,0FFH
  E6EC    E1 33 FF                      DEFB 0E1H,33H,0FFH
                                ;
  E6EF    F014                          DEFW LF015        ;? Blocking / Deblocking
                                ;
                                ;GIDE 8 MByte
  E6F1    0800                  DPB2:   DEFW 2048         ;2048 Records/Track = 256k/Trk
  E6F3    05                            DEFB 5
  E6F4    1F                            DEFB 31           ;4k Bloecke
  E6F5    01                            DEFB 1            ;16-Bit Blockadressen im FCB/DIR
  E6F6    07BF                          DEFW 1983         ;1984 * 4k-Bloecke = 7936k
  E6F8    07FF                          DEFW 2047         ;2048 DIR-Eintraege
  E6FA    FFFF                          DEFW 0FFFFH       ;16 DIR-Bloecke = 64 k
  E6FC    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E6FE    0001                          DEFW 1            ;1 Trk = 256k System
                                ;
  E700    02 03 A0                      DEFB 2,3,0A0H     ;?,?, add constant bits fuer Kopf-Register ?
  E703    000A                          DEFW 000AH        ;10 = 1. Zylinder-Nr. phys. LW, wo BDOS-LW beginnt
  E705    0040                          DEFW 0040H        ;64 Zyl. f. 16 MB LW-Groesse
  E707    03D8                          DEFW 03D8H        ;984 Zylinder HDD
  E709    10                            DEFB 10H          ;16 Koepfe HDD
  E70A    20                            DEFB 20H          ;32 Sektoren/Spur HDD
                                ;
  E70B    F014                          DEFW LF015        ;? Blocking / Deblocking
                                ;
                                ;GIDE 8 MByte
  E70D    0800                  DPB3:   DEFW 2048         ;2048 Records/Track = 256k/Trk
  E70F    06                            DEFB 6
  E710    3F                            DEFB 63           ;8k Bloecke
  E711    03                            DEFB 3            ;16Bit Blockadressen im FCB/DIR
	MACRO-80 3.44	09-Dec-81	PAGE	1-4


  E712    03FF                          DEFW 1023         ;1024 * 8k-Bloecke = 8192k = 8M
  E714    0FFF                          DEFW 4095         ;4096 DIR-Eintraege
  E716    FFFF                          DEFW 0FFFFH       ;16 DIR-Bloecke
  E718    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E71A    0000                          DEFW 0            ;kein System-Track
                                ;
  E71C    02 03 A0                      DEFB 2,3,0A0H     ;?,?, add constant bits fuer Kopf-Register ?
  E71F    0096                          DEFW 0096H        ;150 = 1. Zylinder-Nr. phys. LW, wo BDOS-LW beginnt
  E721    0040                          DEFW 0040H        ;64 Zyl. f. 16 MB LW-Groesse
  E723    03D8                          DEFW 03D8H        ;984 Zylinder HDD
  E725    10                            DEFB 10H          ;16 Koepfe HDD
  E726    20                            DEFB 20H          ;32 Sektoren/Spur HDD
                                ;
  E727    F014                          DEFW LF015        ;? Blocking / Deblocking
                                ;
                                ;GIDE 8 MByte
  E729    0800                  DPB4:   DEFW 2048         ;2048 Records/Track = 256k/Trk
  E72B    06                            DEFB 6
  E72C    3F                            DEFB 63           ;8k Bloecke
  E72D    03                            DEFB 3            ;16Bit Blockadressen im FCB/DIR
  E72E    03FF                          DEFW 1023         ;1024 * 8k-Bloecke = 8192k = 8M
  E730    0FFF                          DEFW 4095         ;4096 DIR-Eintraege
  E732    FFFF                          DEFW 0FFFFH       ;16 DIR-Bloecke
  E734    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E736    0000                          DEFW 0            ;kein System-Track
                                ;
  E738    02 03 A0                      DEFB 2,3,0A0H     ;?,?, add constant bits fuer Kopf-Register ?
  E73B    012C                          DEFW 012CH        ;300 = 1. Zylinder-Nr. phys. LW, wo BDOS-LW beginnt
  E73D    0040                          DEFW 0040H        ;64 Zyl. f. 16 MB LW-Groesse
  E73F    03D8                          DEFW 03D8H        ;984 Zylinder HDD
  E741    10                            DEFB 10H          ;16 Koepfe HDD
  E742    20                            DEFB 20H          ;32 Sektoren/Spur HDD
                                ;
  E743    F018                          DEFW LF019        ;? Blocking / Deblocking
                                ;
                                ;Floppy 640 KByte
  E745    0040                  DPB5:   DEFW 64           ;64 Sectoren/Track
  E747    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E748    0F                            DEFB 15
  E749    00                            DEFB 0
  E74A    013F                          DEFW 319          ;320 * 2 Kbyte - Bloecke
  E74C    007F                          DEFW 127          ;128 DIR - Eintraege
  E74E    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E750    0020                          DEFW 32
  E752    0000                          DEFW 0            ;kein System-Track
                                ;
  E754    01 01 10 14                   DEFB 1,1,10H,14H
  E758    50 00 43 FF                   DEFB 50H,0,43H,0FFH
  E75C    E1 33 FF                      DEFB 0E1H,33H,0FFH
                                ;
  E75F    F018                          DEFW LF019        ;? Blocking / Deblocking
                                ;
                                ;Floppy 800 KByte
  E761    0050                  DPB6:   DEFW 80           ;80 Sectoren/Track
  E763    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E764    0F                            DEFB 15
  E765    00                            DEFB 0
  E766    018F                          DEFW 399          ;400 * 2 Kbyte - Bloecke
  E768    007F                          DEFW 127          ;128 DIR - Eintraege
  E76A    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E76C    0020                          DEFW 32
  E76E    0000                          DEFW 0            ;kein System-Track
	MACRO-80 3.44	09-Dec-81	PAGE	1-5


                                ;
  E770    03 07 05 25                   DEFB 3,7,5,25H
  E774    50 01 43 FF                   DEFB 50H,1,43H,0FFH
  E778    E1 33 FF                      DEFB 0E1H,33H,0FFH
                                ;
                                ;RAM-Disk 1024 KByte
  E77B    0040                  DP1024: DEFW 64           ;64 Sectoren/Track (Rec/Trk) = 8 Kbyte/Track
  E77D    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E77E    0F                            DEFB 15
  E77F    00                            DEFB 0            ;16-Bit Blockadressen im FCB/DIR, da mehr als 255 Bloecke
  E780    01FB                          DEFW 507          ;508 * 2 Kbyte-Bloecke  -> 1024k-8k(System)=1016k(CP/M) ( - 4k(DIR) -> 1012k (NETTO f. Daten))
  E782    007F                          DEFW 127          ;128 DIR - Eintraege -> bei 64 DIR-Eintraegen bekommt man die RAM-Disk nicht voll
  E784    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E786    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E788    0001                          DEFW 1            ;8 Kbyte System / Track-Offset
                                ;
                                ;RAM-Disk 2048 KByte
  E78A    0040                  DP2048: DEFW 64           ;64 Sectoren/Track (Rec/Trk) = 8 Kbyte/Track
  E78C    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E78D    0F                            DEFB 15
  E78E    00                            DEFB 0            ;16-Bit Blockadressen im FCB/DIR, da mehr als 255 Bloecke
  E78F    03FB                          DEFW 1019         ;1020 * 2 Kbyte-Bloecke  -> 2048k-8k(System)=2040k(CP/M) ( - 8k(DIR) -> 2032k (NETTO f. Daten))
  E791    00FF                          DEFW 255          ;256 DIR - Eintraege
  E793    00F0                          DEFW 0F0H         ;4 DIR-Bloecke
  E795    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E797    0001                          DEFW 1            ;8 Kbyte System / Track-Offset
                                ;
  E799    0C                    TXT01:  DEFB 0CH
  E79A    48 52 43 50                   DEFM "HRCPM AC1 V1.2 CPA "
  E79E    4D 20 41 43           
  E7A2    31 20 56 31           
  E7A6    2E 32 20 43           
  E7AA    50 41 20              
  E7AD    32 34 2E 30                   DEFM "24.08.86 FA-MODE "
  E7B1    38 2E 38 36           
  E7B5    20 46 41 2D           
  E7B9    4D 4F 44 45           
  E7BD    20                    
  E7BE    43 6F 6E 49                   DEFM "ConIn INT"
  E7C2    6E 20 49 4E           
  E7C6    54                    
  E7C7    0F                            DEFB 0FH
  E7C8    20 76 2E 20                   DEFM " v. 03.12.11  B136"
  E7CC    30 33 2E 31           
  E7D0    32 2E 31 31           
  E7D4    20 20 42 31           
  E7D8    33 36                 
  E7DA    0D 0A 0D 0A                   DEFB 0DH,0AH,0DH,0AH
  E7DE    47 49 44 45                   DEFM "GIDE(80H) C0:8MB,"
  E7E2    28 38 30 48           
  E7E6    29 20 43 30           
  E7EA    3A 38 4D 42           
  E7EE    2C                    
  E7EF    20 20 20 44                   DEFM "   D0: 8MB   E0: 8MB"
  E7F3    30 3A 20 38           
  E7F7    4D 42 20 20           
  E7FB    20 45 30 3A           
  E7FF    20 38 4D 42           
  E803    0D 0A                         DEFB 0DH,0AH
  E805    46 44 43 20                   DEFM "FDC (45H) B0:5*1024"   ;B0 --> Floppy-Drive 0,
  E809    28 34 35 48           
  E80D    29 20 42 30           
	MACRO-80 3.44	09-Dec-81	PAGE	1-6


  E811    3A 35 2A 31           
  E815    30 32 34              
  E818    20 46 30 3A                   DEFM " F0:16*256 G1:5*1024"  ;F0 --> Floppy-Drive 0, G1 --> Floppy-Drive 1
  E81C    31 36 2A 32           
  E820    35 36 20 47           
  E824    31 3A 35 2A           
  E828    31 30 32 34           
  E82C    0D 0A 0D 0A                   DEFB 0DH,0AH,0DH,0AH
  E830    52 46 4C 20                   DEFM "RFL Praeci.Port E0H"
  E834    50 72 61 65           
  E838    63 69 2E 50           
  E83C    6F 72 74 20           
  E840    45 30 48              
  E843    20 41 3A 20                   DEFM " A: "
  E847    00                            DEFB 0
  E848    32 35 36 6B           TXT01A: DEFM "256k"
  E84C    00                            DEFB 0
  E84D    31 30 32 34           TXT01B: DEFM "1024k"
  E851    6B                    
  E852    00                            DEFB 0
  E853    32 30 34 38           TXT01C: DEFM "2048k"
  E857    6B                    
  E858    00                            DEFB 0
  E859    20 2D 2D 3E           TXT02:  DEFM " --> Format A:(J)?"
  E85D    20 46 6F 72           
  E861    6D 61 74 20           
  E865    41 3A 28 4A           
  E869    29 3F                 
  E86B    00                            DEFB 0
                                ;
                                ;******************************   BOOT   *******************************
                                ;
  E86C    F3                    BOOT:   DI
  E86D    31 F439                       LD   SP,CPMSTK
  E870    AF                            XOR  A
  E871    D3 1E                         OUT  (P1E),A      ;zwingend AC1-Mode !!
  E873    32 F45C                       LD   (LATPU),A    ;FDC-Latch zuruecksetzen
  E876    CD EDB4                       CALL BWSINI
  E879    DB 05                         IN   A,(P05)
  E87B    CB 9F                         RES  3,A          ;BildInvers (PIO1B) Bit3 aus
  E87D    D3 05                         OUT  (P05),A
  E87F    2A 1818                       LD   HL,(BREAK)   ;Sprungtabelle NMI MONITOR
  E882    22 F448                       LD   (OLDNMI),HL  ;sichern
  E885    21 E603                       LD   HL,WBOOTB    ;CP/M-Warmstart-Einsprungadresse
  E888    22 1818                       LD   (BREAK),HL
  E88B    CD E9AD                       CALL CPMMOD
  E88E    AF                            XOR  A
  E88F    32 F47C                       LD   (DF51A),A
  E892    32 0003                       LD   (IOBYTE),A
  E895    32 0004                       LD   (LWBYTE),A
  E898    32 FF00                       LD   (ZEIPUF),A
  E89B    CD E989                       CALL BOOT1        ;CP/M "Grundseite" INIT
                                ;
  E89E    3E 03                         LD   A,03H        ;CTC init. + Interrupt abgeschaltet
  E8A0    D3 00                         OUT  (P00),A
  E8A2    D3 01                         OUT  (P01),A
  E8A4    D3 02                         OUT  (P02),A
  E8A6    D3 03                         OUT  (P03),A
  E8A8    3E FF                         LD   A,0FFH       ;HWT vom Interruptvektor 0FF80h ff.
  E8AA    ED 47                         LD   I,A
  E8AC    ED 5E                         IM   2            ;Interrupt freigeben
  E8AE    21 F304                       LD   HL,INTEND    ;Adresse Einsprungpunkt fuer nicht verwendete Interrupts
	MACRO-80 3.44	09-Dec-81	PAGE	1-7


  E8B1    22 FF80                       LD   (DFF80),HL   ;Prog. Einsprung IV fuer CTC-Kanal 0
  E8B4    22 FF82                       LD   (DFF82),HL   ;Prog. Einsprung IV fuer CTC-Kanal 1
  E8B7    22 FF84                       LD   (DFF84),HL   ;Prog. Einsprung IV fuer CTC-Kanal 2
  E8BA    21 F2E9                       LD   HL,ISRCTC    ;Einsprungpunkt CTC-Interrupt - Steuerung Nachlauf Floppy-LW
  E8BD    22 FF86                       LD   (DFF86),HL   ;Prog. Einsprung IV fuer CTC-Kanal 3
  E8C0    3E 80                         LD   A,80H
  E8C2    D3 00                         OUT  (P00),A      ;CTC-Interruptadresse NWT (= 80h) eintragen
  E8C4    3E FF                         LD   A,0FFH
  E8C6    32 F45B                       LD   (CTCCNT),A   ;Init. CTC-Counter = 255 --> Zusatzzaehler fuer CTC-Interrupt
  E8C9    3E A7                         LD   A,0A7H
  E8CB    D3 03                         OUT  (P03),A      ;Programmierung der CTC K3 als Zeitgeber mit Interrupt, Vorteiler 256
  E8CD    AF                            XOR  A
  E8CE    D3 03                         OUT  (P03),A      ;Programmierung der CTC K3 - Hauptteiler = 256
                                                          ;d.h. bei 2 MHz CPU-Takt wird alle 33ms ein CTC-Interrupt ausgeloest
                                ;
  E8D0    21 E9DF                       LD   HL,ISRTAS    ;1. Einsprungpunkt PIO-Interrupt --> Taste in Tastaturpuffer schreiben
  E8D3    22 FF88                       LD   (DFF88),HL   ;auf 0FF88h eintragen
  E8D6    21 EA32                       LD   HL,ISRPA     ;2. Einsprungpunkt PIO-Interrupt --> weitere PIO_1A-Interrupts "ignorieren"
  E8D9    22 FF8A                       LD   (DFF8A),HL   ;auf 0FF8Ah eintragen
  E8DC    01 0506                       LD   BC,0506H     ;5 Bytes auf Controlkanal PIO1 A
  E8DF    21 EA40                       LD   HL,PIO1TAB
  E8E2    ED B3                         OTIR              ;PIO1_A Init. fuer 1. Einsprungpunkt
                                ;
  E8E4    21 E799                       LD   HL,TXT01     ;Begruessungstext
  E8E7    CD EA47                       CALL OUTTXT
                                ;
  E8EA    CD EEBB                       CALL RDTEST       ;Kapazitaet der RAM-Disk bestimmen
  E8ED    21 EF13                       LD   HL,RDSIZE    ;RD-Size: 0=256K 1=1024K 2=2048K
  E8F0    7E                            LD   A,(HL)
  E8F1    21 E78A                       LD   HL,DP2048    ;DPB 2048K RAM-Disk
  E8F4    FE 02                         CP   2
  E8F6    28 09                         JR   Z,BOOT2
  E8F8    21 E77B                       LD   HL,DP1024    ;DPB 1024K RAM-Disk
  E8FB    FE 01                         CP   1
  E8FD    28 02                         JR   Z,BOOT2
  E8FF    18 08                         JR   BOOT3        ;256K RAM-Disk, nichts kopieren
                                ;        
  E901    11 E6C4               BOOT2:  LD   DE,DPB0
  E904    01 000F                       LD   BC,15
  E907    ED B0                         LDIR
  E909    21 E848               BOOT3:  LD   HL,TXT01A    ;256k
  E90C    FE 00                         CP   0
  E90E    28 0A                         JR   Z,BOOT4
  E910    21 E84D                       LD   HL,TXT01B    ;1024k
  E913    FE 01                         CP   1
  E915    28 03                         JR   Z,BOOT4
  E917    21 E853                       LD   HL,TXT01C    ;2048k
  E91A    CD EA47               BOOT4:  CALL OUTTXT
  E91D    21 E859                       LD   HL,TXT02     ;Formatieren? (J)
  E920    CD EA47                       CALL OUTTXT
  E923    FB                            EI
  E924    CD EA5F                       CALL CONIN
  E927    CB AF                         RES  5,A          ;Grossbuchstaben
  E929    FE 4A                         CP   4AH          ;J --> RAM-Disk formatieren
  E92B    CC EF14                       CALL Z,RDFORM
  E92E    18 22                         JR   WBOOT1
                                ;
                                ;*******************************   WBOOT   *****************************
                                ;
  E930    31 F439               WBOOT:  LD   SP,CPMSTK
  E933    CD E9AD                       CALL CPMMOD
  E936    3A F47D                       LD   A,(DF51B)
	MACRO-80 3.44	09-Dec-81	PAGE	1-8


  E939    B7                            OR   A
  E93A    C4 F0CD                       CALL NZ,LF0CE
  E93D    06 2C                         LD   B,2CH        ;44 Records CCP+BDOS
  E93F    21 EE2A                       LD   HL,READ
  E942    22 EFA0                       LD   (WRCCP2),HL
  E945    CD EF86                       CALL WRCCP        ;wirklich READCCP !
  E948    21 EE2F                       LD   HL,WRITE
  E94B    22 EFA0                       LD   (WRCCP2),HL
  E94E    AF                            XOR  A
  E94F    32 D007                       LD   (COMLEN),A   ;auf Laenge=0 setzen
                                ;
  E952    CD E989               WBOOT1: CALL BOOT1        ;CP/M "Grundseite" INIT
  E955    3E 01                         LD   A,01H        ;Kursor einschalten
  E957    32 F43F                       LD   (CUFLAG),A
  E95A    3A F43C                       LD   A,(COLO2)
  E95D    32 F43A                       LD   (COLOR),A    ;Arbeitszelle Farbbyte
  E960    E6 77                         AND  77H          ;Intensivdarstellung maskieren
  E962    32 F43B                       LD   (COLO1),A    ;Arbeitszelle "Normaldarstellung"
  E965    3A 0004                       LD   A,(LWBYTE)
  E968    4F                            LD   C,A
  E969    CD EDED                       CALL SELDSK
  E96C    C3 D000                       JP   CCP          ;JP CCP
                                ;
                                ;
  E96F    F5                    CPMERR: PUSH AF           ;CP/M-Fehler - zurueck z. MONITOR
  E970    E5                            PUSH HL
  E971    CD E9BC                       CALL EXIT1
  E974    DF                            RST  18H
  E975    20 43 50                      DEFM " CP"
  E978    CD                            DEFB 4DH+80H      ;"M+80H
  E979    E1                            POP  HL
  E97A    F1                            POP  AF
  E97B    CD 01A5                       CALL RSA
  E97E    E1                            POP  HL
  E97F    2B                            DEC  HL
  E980    CD 07F1                       CALL OUTHL
  E983    DF                            RST  18H
  E984    8D                            DEFB 0DH+80H
  E985    CD 05CE                       CALL REGIST       ;MONI - Registeranzeige - nicht Monitor 11 !
  E988    FF                            RST  38H          ;zurueck zum MONI
                                ;
                                ;
  E989    3E C3                 BOOT1:  LD   A,0C3H       ;CP/M "Grundseite" INIT
  E98B    32 0000                       LD   (WARMBT),A
  E98E    32 0005                       LD   (BDOSF),A
  E991    32 0038                       LD   (RST38),A
  E994    21 E603                       LD   HL,WBOOTB
  E997    22 0001                       LD   (WARMBT+1),HL
  E99A    21 D806                       LD   HL,BDOS
  E99D    22 0006                       LD   (BDOSF+1),HL
  E9A0    21 E96F                       LD   HL,CPMERR
  E9A3    22 0039                       LD   (RST38+1),HL
  E9A6    21 0080                       LD   HL,0080H
  E9A9    22 F463                       LD   (DMA),HL
  E9AC    C9                            RET
                                ;
                                ;+++++++++++++++++++++++++++++++++   Ende BOOT / WBOOT   +++++++++++++++++
                                ;
  E9AD    F5                    CPMMOD: PUSH AF           ;CP/M EIN
  E9AE    3E 01                         LD   A,01H
  E9B0    18 02                         JR   MOD1
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-9


  E9B2    F5                    AC1MOD: PUSH AF           ;CP/M AUS (AC1-Mode)
  E9B3    AF                            XOR  A
  E9B4    D3 1E                 MOD1:   OUT  (P1E),A
  E9B6    F1                            POP  AF
  E9B7    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
                                ;EXIT - Routine
                                ;
  E9B8    21 0000               EXIT:   LD   HL,0000H     ;Ruecksprungadresse fuer RET
  E9BB    E5                            PUSH HL
  E9BC    AF                    EXIT1:  XOR  A
  E9BD    32 D007                       LD   (COMLEN),A   ;auf Laenge=0 setzen
  E9C0    D3 1E                         OUT  (P1E),A      ;AC1-Mode
  E9C2    D3 11                         OUT  (P11),A      ;Modul_1 - ggf. EPROMs ausblenden
  E9C4    2A F448                       LD   HL,(OLDNMI)
  E9C7    22 1818                       LD   (BREAK),HL   ;alten NMI wiederherstellen
  E9CA    3E 03                         LD   A,03H
  E9CC    D3 00                         OUT  (P00),A      ;CTC: Interrupts ausschalten
  E9CE    D3 01                         OUT  (P01),A
  E9D0    D3 02                         OUT  (P02),A
  E9D2    D3 03                         OUT  (P03),A
  E9D4    D3 06                         OUT  (P06),A      ;PIO1 A: Interrupt auschalten
  E9D6    3E CF                         LD   A,0CFH
  E9D8    D3 06                         OUT  (P06),A      ;PIO1 A: "Mode 3" + "Set Mode"
  E9DA    3E FF                         LD   A,0FFH
  E9DC    D3 06                         OUT  (P06),A      ;PIO1 A: PA0 bis PA7 sind Eingaenge
  E9DE    C9                            RET               ;zurueck zum MONITOR, normal
                                ;
                                ;
                                ;Interrupt-Einsprung fuer die Tastatur
                                ;
  E9DF    F3                    ISRTAS: DI
  E9E0    F5                            PUSH AF
  E9E1    C5                            PUSH BC
  E9E2    E5                            PUSH HL
  E9E3    DB 04                         IN   A,(P04)      ;PIO_A abfragen
  E9E5    CB 7F                         BIT  7,A          ;Taste gedrueckt?
  E9E7    28 43                         JR   Z,ISREND     ;nein, ISR beenden
  E9E9    4F                            LD   C,A
                                ;
  E9EA    06 1E                         LD   B,1EH        ;Tastaturentprellung
  E9EC    DB 04                 PRELL1: IN   A,(P04)
  E9EE    B9                            CP   C
  E9EF    20 3B                         JR   NZ,ISREND
  E9F1    10 F9                         DJNZ PRELL1       ;30 Durchlaeufe
                                ;
  E9F3    FE 80                         CP   80H
  E9F5    28 35                         JR   Z,ISREND     ;das war eine NULL-Eingabe
  E9F7    21 EA45                       LD   HL,PIO2TAB
  E9FA    01 0206                       LD   BC,0206H     ;PIO_A-Control, 2 Bytes
  E9FD    ED B3                         OTIR              ;weitere Interrupts "ignorieren"
                                ;
  E9FF    4F                            LD   C,A
  EA00    21 FF00                       LD   HL,ZEIPUF
  EA03    7E                            LD   A,(HL)       ;Fuellstand Zeichenpuffer
  EA04    3C                            INC  A
  EA05    FE 1F                         CP   1FH          ;Puffer voll?
  EA07    28 23                         JR   Z,ISREND
  EA09    77                            LD   (HL),A       ;Anzahl der Zeichen im Puffer
  EA0A    C5                            PUSH BC
	MACRO-80 3.44	09-Dec-81	PAGE	1-10


  EA0B    4F                            LD   C,A
  EA0C    09                            ADD  HL,BC        ;HL = Position im Zeichenpuffer
  EA0D    C1                            POP  BC
  EA0E    CB B9                         RES  7,C          ;7. Bit loeschen und
  EA10    71                            LD   (HL),C       ;Taste in Zeichenpuffer eintragen
                                ;
                                ;       LD   BC,8034H     ;Initialisierung Tastenpiep --> 2 MHz
  EA11    01 8068                       LD   BC,8068H     ;Initialisierung Tastenpiep --> 4 MHz
  EA14    79                    BEEP1:  LD   A,C
  EA15    3D                    BEEP2:  DEC  A
  EA16    20 FD                         JR   NZ,BEEP2
  EA18    DB 05                         IN   A,(P05)      ;PIO_B-Daten
  EA1A    EE 01                         XOR  01H          ;Tastenpiep
  EA1C    D3 05                         OUT  (P05),A
  EA1E    10 F4                         DJNZ BEEP1
  EA20    E6 FE                         AND  0FEH
  EA22    D3 05                         OUT  (P05),A
                                ;
  EA24    01 0200                       LD   BC,0200H     ;Warteschleife - Entprellung
  EA27    0B                    PRELL2: DEC  BC
  EA28    78                            LD   A,B
  EA29    B1                            OR   C
  EA2A    20 FB                         JR   NZ,PRELL2
                                ;
  EA2C    E1                    ISREND: POP  HL
  EA2D    C1                            POP  BC
  EA2E    F1                            POP  AF
  EA2F    FB                            EI
  EA30    ED 4D                         RETI
                                ;
                                ;
                                ;2. Interrupt-Einsprung fuer PIO1 Kanal A - Neuinitialisierung der PIO
                                ;
  EA32    F3                    ISRPA:  DI
  EA33    F5                            PUSH AF
  EA34    C5                            PUSH BC
  EA35    E5                            PUSH HL
  EA36    21 EA40                       LD   HL,PIO1TAB
  EA39    01 0506                       LD   BC,0506H     ;5 Bytes f. PIO_A-Control
  EA3C    ED B3                         OTIR
  EA3E    18 EC                         JR   ISREND
                                ;
  EA40    88 CF FF B7           PIO1TAB: DEFB 88H,0CFH,0FFH,0B7H,7FH  ;PIO 1A: Init.-Tabelle
  EA44    7F                    
                                ;  88H --> NWT Interruptvektor --> 0FF88H
                                ; 0CFH --> "Mode 3" + "Set Mode" (kein Handshaking, next Byte = I/O-Zuordnung)
                                ; 0FFH --> PA0 bis PA7 sind Eingaenge
                                ; 0B7H --> Setting Interrupt Control Word --> mit nachfolgender Maskierung
                                ;  7FH --> Bit7=Low --> nur PA7 erzeugt Interrupts
                                ;
  EA45    8A 87                 PIO2TAB: DEFB 8AH,87H     ;PIO 1A: "Ignorieren" weiterer Interrupts
                                ;  8AH --> "Verbiegen" NWT Interruptvektor --> 0FF8A
                                ;  87H --> Setting Interrupt Control Word --> ohne nachfolgende Maskierung
                                ;
                                ;
  EA47    C5                    OUTTXT: PUSH BC
  EA48    F5                            PUSH AF
  EA49    4E                    TEXT1:  LD   C,(HL)
  EA4A    79                            LD   A,C
  EA4B    B7                            OR   A
  EA4C    28 06                         JR   Z,TEXT2
  EA4E    CD EAD7                       CALL CONOUT
	MACRO-80 3.44	09-Dec-81	PAGE	1-11


  EA51    23                            INC  HL
  EA52    18 F5                         JR   TEXT1
  EA54    F1                    TEXT2:  POP  AF
  EA55    C1                            POP  BC
  EA56    C9                            RET
                                ;
                                ;************************   CONST   *************************
                                ;
  EA57    3A FF00               CONST:  LD   A,(ZEIPUF)
  EA5A    B7                            OR   A
  EA5B    C8                            RET  Z
  EA5C    3E FF                         LD   A,0FFH
  EA5E    C9                            RET
                                ;
                                ;***************************   CONIN   ***********************
                                ;
  EA5F    F3                    CONIN:  DI
  EA60    ED 73 F444                    LD   (SPCIN),SP
  EA64    31 F3BA                       LD   SP,CINSP
  EA67    C5                            PUSH BC
  EA68    D5                            PUSH DE
  EA69    E5                            PUSH HL
  EA6A    01 017F                       LD   BC,017FH     ;Kursor-Blinker ruecksetzen
  EA6D    AF                    CONIN1: XOR  A
  EA6E    F3                            DI
  EA6F    2A FF00                       LD   HL,(ZEIPUF)  ;L = Anz. der Zeichen, H = 1. Zeichen
  EA72    B5                            OR   L
  EA73    20 20                         JR   NZ,CONIN4    ;Zeichen im Tastaturpuffer vorhanden
  EA75    FB                            EI
  EA76    10 F5                         DJNZ CONIN1       ;256*LOOP: warte auf ein Zeichen
  EA78    3A F43F                       LD   A,(CUFLAG)
  EA7B    B7                            OR   A
  EA7C    28 EF                         JR   Z,CONIN1     ;kein "Kursor-Blinken"
  EA7E    F3                            DI
  EA7F    CD E9B2                       CALL AC1MOD       ;AC1 Mode
  EA82    2A 1800                       LD   HL,(CUPOS)
  EA85    0C                            INC  C
  EA86    CB 79                         BIT  7,C          ;hier wird die Cursor-Blinkfrequenz festgelegt
  EA88    3A F443                       LD   A,(CHAR)     ;bisheriges Zeichen auf der Kursorposition
  EA8B    28 02                         JR   Z,CONIN3
  EA8D    3E 0F                         LD   A,CUZEI      ;Kursor = 0FH
  EA8F    77                    CONIN3: LD   (HL),A       ;"Kursor-Blinken" - Bildschirm-Ausgabe
  EA90    CD E9AD                       CALL CPMMOD       ;CP/M Mode
  EA93    18 D8                         JR   CONIN1
                                ;
  EA95    3D                    CONIN4: DEC  A            ;DEC Anzahl_der_Zeichen_im_Tastaturpuffer
  EA96    32 FF00                       LD   (ZEIPUF),A
  EA99    7C                            LD   A,H          ;1. Zeichen aus dem Tastaturpuffer --> A
  EA9A    21 FF02                       LD   HL,ZEIPUF+2
  EA9D    11 FF01                       LD   DE,ZEIPUF+1
  EAA0    01 001F                       LD   BC,001FH
  EAA3    ED B0                         LDIR              ;alle Zeichen im Puffer rC<cken 1 Pos. n. links
  EAA5    E1                            POP  HL
  EAA6    D1                            POP  DE
  EAA7    C1                            POP  BC
  EAA8    ED 7B F444                    LD   SP,(SPCIN)
  EAAC    FB                            EI
  EAAD    C9                            RET
                                ;
                                ;***************************   LIST   ************************
                                ;
  EAAE    F3                    LIST:   DI
	MACRO-80 3.44	09-Dec-81	PAGE	1-12


  EAAF    CD E9B2                       CALL AC1MOD
  EAB2    F5                            PUSH AF      
  EAB3    79                            LD   A,C
  EAB4    FE 0A                         CP   0AH  
  EAB6    28 0C                         JR   Z,LEND1  
  EAB8    CD 0DF9                       CALL MV24A        ;MONI V24 Ausgabe Akku
  EABB    FE 0D                         CP   0DH     
  EABD    20 05                         JR   NZ,LEND1 
  EABF    3E 0A                         LD   A,0AH   
  EAC1    CD 0DF9                       CALL MV24A        ;MONI V24 Ausgabe Akku
  EAC4    F1                    LEND1:  POP  AF      
  EAC5    CD E9AD                       CALL CPMMOD
  EAC8    FB                            EI
  EAC9    C9                            RET
                                ;
                                ;***************************   PUNCH   ***********************
                                ;
  EACA    F3                    PUNCH:  DI                ;Ausgabe C nach V24
  EACB    79                            LD   A,C
  EACC    CD E9B2                       CALL AC1MOD
  EACF    CD 0DF9                       CALL MV24A        ;MONI V24 Ausgabe Akku
  EAD2    CD E9AD                       CALL CPMMOD
  EAD5    FB                            EI
  EAD6    C9                            RET
                                ;
                                ;******************************* CONOUT  *********************
                                ;
                                ;       Ausgabe eines Zeichens,   IN: Zeichen in C
                                ;
  EAD7    F3                    CONOUT: DI
  EAD8    ED 73 F446                    LD   (SPCOUT),SP  ;Stack bei MON-Aufruf retten
  EADC    31 F3E0                       LD   SP,COUTSP
  EADF    F5                            PUSH AF
  EAE0    C5                            PUSH BC
  EAE1    D5                            PUSH DE
  EAE2    E5                            PUSH HL
  EAE3    CD E9B2                       CALL AC1MOD
  EAE6    E5                            PUSH HL
  EAE7    2A 1800                       LD   HL,(CUPOS)   ;Cursorposition
  EAEA    3A F443                       LD   A,(CHAR)
  EAED    77                            LD   (HL),A       ;altes Zeichen auf Position
  EAEE    3A F440                       LD   A,(STZ00)    ;Durchlauf bei Steuerzeichen?
  EAF1    A7                            AND  A
  EAF2    C2 ED22                       JP   NZ,KONV10    ;NZ= Steuerzeichen 2. oder 3. Durchlauf
  EAF5    79                            LD   A,C          ;Byte
  EAF6    FE 20                         CP   20H          ;kleinstes Zeichen
  EAF8    38 26                         JR   C,KONVTB
  EAFA    FE 7F                         CP   7FH          ;groesstes Zeichen
  EAFC    30 22                         JR   NC,KONVTB
  EAFE    2A 1800                       LD   HL,(CUPOS)
  EB01    C3 EC5F                       JP   CCHAR        ;Ausgabe einzelnes Zeichen
                                ;
  EB04    2A 1800               KONVT9: LD   HL,(CUPOS)
  EB07    7E                            LD   A,(HL)
  EB08    32 F443                       LD   (CHAR),A
  EB0B    3A F43F                       LD   A,(CUFLAG)
  EB0E    B7                            OR   A
  EB0F    28 02                         JR   Z,COEN1      ;Kursor nicht darstellen
  EB11    36 0F                         LD   (HL),CUZEI
  EB13    CD E9AD               COEN1:  CALL CPMMOD
  EB16    E1                            POP  HL
  EB17    D1                            POP  DE
	MACRO-80 3.44	09-Dec-81	PAGE	1-13


  EB18    C1                            POP  BC
  EB19    F1                            POP  AF
  EB1A    ED 7B F446                    LD   SP,(SPCOUT)
  EB1E    FB                            EI
  EB1F    C9                            RET
                                ;
                                ;Verzweigung bei Steuerzeichen
                                ;INPUT:  A=Zeichen
                                ;
  EB20    FE 1B                 KONVTB: CP   1BH          ;ESC ?
  EB22    20 07                         JR   NZ,KONVT1
  EB24    3E 02                         LD   A,02H        ;wenn ja
  EB26    32 F440                       LD   (STZ00),A    ;Zeiger auf 2
  EB29    18 D9                         JR   KONVT9       ;nichts ausgeben
                                ;
  EB2B    2A 1800               KONVT1: LD   HL,(CUPOS)
  EB2E    FE 01                         CP   01H          ;^A Cursor home                      
  EB30    28 5B                         JR   Z,CHOME                                             
  EB32    FE 07                         CP   07H          ;^G akustisches Signal                                                 
  EB34    CA ECB1                       JP   Z,MBEEP                                              
  EB37    FE 08                         CP   08H          ;^H Cursor links                     
  EB39    CA EBB5                       JP   Z,CLEFT                                             
  EB3C    FE 0A                         CP   0AH          ;^J Zeilenvorschub                   
  EB3E    CA EBB9                       JP   Z,CLF                                               
  EB41    FE 0C                         CP   0CH          ;^L CLS                              
  EB43    28 51                         JR   Z,BCLS                                              
  EB45    FE 0D                         CP   0DH          ;^M Wagenruecklauf                   
  EB47    CA EBD1                       JP   Z,CCRET                                             
  EB4A    FE 14                         CP   14H          ;^T BS ab Cursor loeschen            
  EB4C    CA EBD8                       JP   Z,CBLOE                                             
  EB4F    FE 15                         CP   15H          ;^U Cursor nach rechts               
  EB51    CA EBFB                       JP   Z,CRIGH                                             
  EB54    FE 16                         CP   16H          ;^V Zeile ab Cursor loeschen         
  EB56    CA EBFF                       JP   Z,CZLOE                                             
  EB59    FE 18                         CP   18H          ;^X Zeile ab Cursor loeschen + CR    
  EB5B    CA EC26                       JP   Z,CZLCR                                             
  EB5E    FE 1A                         CP   1AH          ;^Z Cursor hoch                      
  EB60    CA EC4F                       JP   Z,CHOCH                                             
  EB63    FE 82                         CP   82H          ;Kursor ein
  EB65    CA ED13                       JP   Z,CUON
  EB68    FE 83                         CP   83H          ;Kursor aus
  EB6A    CA ED1B                       JP   Z,CUOFF
                                ;
  EB6D    47                            LD   B,A          ;Zeichen merken                      
  EB6E    3A F43A                       LD   A,(COLOR)                                         
  EB71    A7                            AND  A            ;Test auf Color-BWS                  
  EB72    CA EB04                       JP   Z,KONVT9     ;Z = monochrom  
  EB75    78                            LD   A,B                                                 
                                ;
  EB76    FE 84                         CP   84H          ;normale Darstellung
  EB78    CA ECD8                       JP   Z,BNORM
  EB7B    FE 85                         CP   85H          ;invers
  EB7D    CA ECE6                       JP   Z,BINVN
  EB80    FE 86                         CP   86H          ;intensiv - HihgLight
  EB82    CA ECF5                       JP   Z,BINTE
  EB85    FE 87                         CP   87H          ;intensiv + invers
  EB87    CA ED02                       JP   Z,BIVIN
  EB8A    C3 EB04                       JP   KONVT9
                                ;
  EB8D    21 17FF               CHOME:  LD   HL,17FFH
  EB90    22 1800                       LD   (CUPOS),HL
  EB93    C3 EB04                       JP   KONVT9
	MACRO-80 3.44	09-Dec-81	PAGE	1-14


                                ;
  EB96    3E 20                 BCLS:   LD   A,20H        ;0Ch  Bildschirm loeschen
  EB98    CD EBC2                       CALL BCL1         ;Loeschroutine
  EB9B    22 1800                       LD   (CUPOS),HL   ;Cursorposition
  EB9E    3A F43A                       LD   A,(COLOR)    ;Farbbyte
  EBA1    E6 77                         AND  77H          ;Farb-BWS vorhanden?
  EBA3    CA EB04                       JP   Z,KONVT9     ;Z = nein, dann Ende
  EBA6    CD EDA5                       CALL BWSCOL       ;Farbspeicher ein
  EBA9    3A F43A                       LD   A,(COLOR)
  EBAC    CD EBC2                       CALL BCL1
  EBAF    CD EDAB                       CALL BWSZEI       ;Farbspeicher aus
  EBB2    C3 EB04                       JP   KONVT9
                                ;
  EBB5    23                    CLEFT:  INC  HL           ;08h  Cursor links
  EBB6    C3 EC53                       JP   CHOLI
                                ;
  EBB9    11 0040               CLF:    LD   DE,0040H     ;0Ah  Zeilenvorschub
  EBBC    A7                            AND  A
  EBBD    ED 52                         SBC  HL,DE
  EBBF    C3 EC70                       JP   SCROL
                                ;
  EBC2    21 1000               BCL1:   LD   HL,1000H     ;Anfang BWS
  EBC5    77                            LD   (HL),A
  EBC6    54                            LD   D,H
  EBC7    5D                            LD   E,L
  EBC8    1C                            INC  E
  EBC9    C5                            PUSH BC
  EBCA    01 07FF                       LD   BC,07FFH     ;Laenge BWS
  EBCD    ED B0                         LDIR
  EBCF    C1                            POP  BC
  EBD0    C9                            RET
                                ;
  EBD1    7D                    CCRET:  LD   A,L          ;0Dh  Wagenruecklauf
  EBD2    F6 3F                         OR   3FH
  EBD4    6F                            LD   L,A
  EBD5    C3 EC70                       JP   SCROL
                                ;
  EBD8    E5                    CBLOE:  PUSH HL
  EBD9    3E 0F                         LD   A,CUZEI      ;14h  BS ab Cursor loeschen
  EBDB    36 20                 CBLO1:  LD   (HL),20H
  EBDD    2B                            DEC  HL
  EBDE    BC                            CP   H
  EBDF    20 FA                         JR   NZ,CBLO1
  EBE1    E1                            POP  HL
  EBE2    3A F43A                       LD   A,(COLOR)
  EBE5    47                            LD   B,A
  EBE6    E6 77                         AND  77H
  EBE8    CA EB04                       JP   Z,KONVT9
  EBEB    CD EDA5                       CALL BWSCOL       ;Farbspeicher ein
  EBEE    3E 0F                         LD   A,CUZEI
  EBF0    70                    CBLO2:  LD   (HL),B
  EBF1    2B                            DEC  HL
  EBF2    BC                            CP   H
  EBF3    20 FB                         JR   NZ,CBLO2
  EBF5    CD EDAB                       CALL BWSZEI       ;Farbspeicher aus
  EBF8    C3 EB04                       JP   KONVT9
                                ;
  EBFB    2B                    CRIGH:  DEC  HL           ;15h  Cursor nach rechts
  EBFC    C3 EC70                       JP   SCROL
                                ;
  EBFF    E5                    CZLOE:  PUSH HL           ;16h  Zeile ab Cursor loeschen
  EC00    7D                            LD   A,L
	MACRO-80 3.44	09-Dec-81	PAGE	1-15


  EC01    E6 3F                         AND  3FH
  EC03    47                            LD   B,A
  EC04    04                            INC  B
  EC05    36 20                 CZLO1:  LD   (HL),20H
  EC07    2B                            DEC  HL
  EC08    10 FB                         DJNZ CZLO1
  EC0A    E1                            POP  HL
  EC0B    3A F43A                       LD   A,(COLOR)
  EC0E    4F                            LD   C,A
  EC0F    E6 77                         AND  77H
  EC11    CA EB04                       JP   Z,KONVT9
  EC14    CD EDA5                       CALL BWSCOL       ;Farbspeicher ein
  EC17    7D                            LD   A,L
  EC18    E6 3F                         AND  3FH
  EC1A    47                            LD   B,A
  EC1B    04                            INC  B
  EC1C    71                    CZLO2:  LD   (HL),C
  EC1D    2B                            DEC  HL
  EC1E    10 FC                         DJNZ CZLO2
  EC20    CD EDAB                       CALL BWSZEI       ;Farbspeicher aus
  EC23    C3 EB04                       JP   KONVT9
                                ;
  EC26    E5                    CZLCR:  PUSH HL           ;18h  Zeile ab Cursor loeschen + CR
  EC27    7D                            LD   A,L
  EC28    F6 3F                         OR   3FH
  EC2A    6F                            LD   L,A
  EC2B    22 1800                       LD   (CUPOS),HL
  EC2E    E5                            PUSH HL
  EC2F    06 40                         LD   B,40H        ;Zeilenlaenge
  EC31    36 20                 CZLC1:  LD   (HL),20H
  EC33    2B                            DEC  HL
  EC34    10 FB                         DJNZ CZLC1
  EC36    E1                            POP  HL
  EC37    3A F43A                       LD   A,(COLOR)
  EC3A    4F                            LD   C,A
  EC3B    E6 77                         AND  77H
  EC3D    CA EB04                       JP   Z,KONVT9
  EC40    CD EDA5                       CALL BWSCOL       ;Farbspeicher ein
  EC43    06 40                         LD   B,40H
  EC45    71                    CZLC2:  LD   (HL),C
  EC46    2B                            DEC  HL
  EC47    10 FC                         DJNZ CZLC2
  EC49    CD EDAB                       CALL BWSZEI       ;Farbspeicher aus
  EC4C    C3 EB04                       JP   KONVT9
                                ;
  EC4F    11 0040               CHOCH:  LD   DE,0040H     ;1Ah     Cursor hoch
  EC52    19                            ADD  HL,DE
                                ;
  EC53    3E 18                 CHOLI:  LD   A,18H        ;Begrenzung Cursor hoch und links
  EC55    BC                            CP   H
  EC56    CA EB04                       JP   Z,KONVT9
  EC59    22 1800                       LD   (CUPOS),HL
  EC5C    C3 EB04                       JP   KONVT9
                                ;
  EC5F    77                    CCHAR:  LD   (HL),A
  EC60    3A F43A                       LD   A,(COLOR)
  EC63    4F                            LD   C,A
  EC64    E6 77                         AND  77H
  EC66    28 07                         JR   Z,CCHA1
  EC68    CD EDA5                       CALL BWSCOL       ;Farbspeicher ein
  EC6B    71                            LD   (HL),C
  EC6C    CD EDAB                       CALL BWSZEI       ;Farbspeicher aus
	MACRO-80 3.44	09-Dec-81	PAGE	1-16


  EC6F    2B                    CCHA1:  DEC  HL
                                ;
  EC70    22 1800               SCROL:  LD   (CUPOS),HL
  EC73    EB                            EX   DE,HL        ;Test ob Scrollen noetig
  EC74    21 0FFF                       LD   HL,0FFFH
  EC77    A7                            AND  A
  EC78    ED 52                         SBC  HL,DE        ;DE = akt. Cursorpos.
  EC7A    EB                            EX   DE,HL
  EC7B    DA EB04                       JP   C,KONVT9     ;CY = nicht scrollen
  EC7E    3E 20                         LD   A,20H        ;Leerzeichen
  EC80    CD EC9A                       CALL SCR11        ;Scrollen
  EC83    3A F43A                       LD   A,(COLOR)
  EC86    E6 77                         AND  77H
  EC88    CA EB04                       JP   Z,KONVT9     ;Z = kein Farbspeicher
  EC8B    CD EDA5                       CALL BWSCOL       ;Farbspeicher ein
  EC8E    3A F43A                       LD   A,(COLOR)    ;Farbbyte
  EC91    CD EC9A                       CALL SCR11
  EC94    CD EDAB                       CALL BWSZEI       ;Farbspeicher aus
  EC97    C3 EB04                       JP   KONVT9
                                ;
  EC9A    21 17BF               SCR11:  LD   HL,17BFH     ;Umladeroutine Scrollen
  EC9D    11 17FF                       LD   DE,17FFH
  ECA0    01 07C0                       LD   BC,07C0H
  ECA3    ED B8                         LDDR
  ECA5    EB                            EX   DE,HL
  ECA6    22 1800                       LD   (CUPOS),HL
  ECA9    23                            INC  HL
  ECAA    06 40                         LD   B,40H        ;eine Zeilenlaenge
  ECAC    2D                    SCR12:  DEC  L
  ECAD    77                            LD   (HL),A       ;Leerzeile schreiben
  ECAE    10 FC                         DJNZ SCR12
  ECB0    C9                            RET
                                ;
                                ;
                                ;UP 'MBEEP' (Monitor-Beep)
                                ;
  ECB1    C5                    MBEEP:  PUSH BC 
  ECB2    06 02                         LD   B,02H        ;2 Wiederholungen
  ECB4    C5                    MBEEP1: PUSH BC 
                                ;       LD   BC,0040H     ;--> fuer 2 MHz
  ECB5    01 0080                       LD   BC,0080H     ;--> fuer 4 MHz
  ECB8    CD ECC8                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
                                ;       LD   BC,0F032H    ;--> fuer 2 MHz
  ECBB    01 F064                       LD   BC,0F064H    ;--> fuer 4 MHz
  ECBE    CD ECC8                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
  ECC1    C1                            POP  BC 
  ECC2    10 F0                         DJNZ MBEEP1 
  ECC4    C1                            POP  BC 
  ECC5    C3 EB13                       JP   COEN1 
                                ;
                                ;
                                ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
                                ;
  ECC8    F5                    UPTON:  PUSH AF 
  ECC9    DB 05                 UPTON1: IN   A,(P05) 
  ECCB    1F                            RRA 
  ECCC    3F                            CCF 
  ECCD    17                            RLA 
  ECCE    D3 05                         OUT  (P05),A 
  ECD0    79                            LD   A,C 
  ECD1    3D                    UPTON2: DEC  A 
  ECD2    20 FD                         JR   NZ,UPTON2 
	MACRO-80 3.44	09-Dec-81	PAGE	1-17


  ECD4    10 F3                         DJNZ UPTON1 
  ECD6    F1                            POP  AF 
  ECD7    C9                            RET 
                                ;
                                ;
  ECD8    3A F43B               BNORM:  LD   A,(COLO1)    ;84h  normale Darstellung
  ECDB    E6 77                         AND  77H
  ECDD    32 F43A                       LD   (COLOR),A
  ECE0    32 F43B                       LD   (COLO1),A
  ECE3    C3 EB04                       JP   KONVT9
                                ;
  ECE6    3A F43B               BINVN:  LD   A,(COLO1)    ;85h  invers EIN
  ECE9    E6 77                         AND  77H
  ECEB    0F                            RRCA
  ECEC    0F                            RRCA
  ECED    0F                            RRCA
  ECEE    0F                            RRCA
  ECEF    32 F43A                       LD   (COLOR),A
  ECF2    C3 EB04                       JP   KONVT9
                                ;
  ECF5    3A F43B               BINTE:  LD   A,(COLO1)    ;86h  intensiv EIN
  ECF8    E6 77                         AND  77H
  ECFA    F6 08                         OR   08H
  ECFC    32 F43A                       LD   (COLOR),A
  ECFF    C3 EB04                       JP   KONVT9
                                ;
  ED02    3A F43A               BIVIN:  LD   A,(COLOR)    ;87h  intensiv + invers
  ED05    E6 77                         AND  77H
  ED07    F6 08                         OR   08H
  ED09    0F                            RRCA
  ED0A    0F                            RRCA
  ED0B    0F                            RRCA
  ED0C    0F                            RRCA
  ED0D    32 F43A                       LD   (COLOR),A
  ED10    C3 EB04                       JP   KONVT9
                                ;
  ED13    3E 01                 CUON:   LD   A,01H        ;82h Cursor EIN
  ED15    32 F43F                       LD   (CUFLAG),A
  ED18    C3 EB04                       JP   KONVT9
                                ;
  ED1B    AF                    CUOFF:  XOR  A            ;83h Cursor AUS
  ED1C    32 F43F                       LD   (CUFLAG),A
  ED1F    C3 EB04                       JP   KONVT9
                                ;
                                ; Behandlung ESC-Sequenzen
                                ;
                                ; Input: ESC + 2 Steuerzeichen
                                ; wenn 1. Zeichen > 80h dann Cursorposition
                                ; sonst Auswertung Farbe / Grafikzeichen
                                ; (stz00) = Zaehler fuer Zeichenanzahl
                                ;
  ED22    3A F440               KONV10: LD   A,(STZ00)
  ED25    FE 02                         CP   02H          ;2 = 1. Steuerzeichen (Zeile)
  ED27    20 0C                         JR   NZ,KONV20    ;sonst 3. Durchlauf (Spalte)
  ED29    79                            LD   A,C
  ED2A    32 F441                       LD   (STZ01),A    ;erstes Zeichen merken
  ED2D    3E 01                         LD   A,01H        ;Zeiger fuer 3. Durchlauf
  ED2F    32 F440                       LD   (STZ00),A
  ED32    C3 EB04                       JP   KONVT9       ;nichts ausgeben
                                ;
                                ; Verzweigung Cursorposition / weitere Funktionen
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-18


  ED35    79                    KONV20: LD   A,C
  ED36    32 F442                       LD   (STZ02),A    ;zweites Zeichen merken
  ED39    AF                            XOR  A
  ED3A    32 F440                       LD   (STZ00),A    ;Durchlaufzaehler ruecksetzen
  ED3D    21 F441                       LD   HL,STZ01
  ED40    7E                            LD   A,(HL)
  ED41    CB 7F                         BIT  7,A          ;welche Funktion? NZ = Cursor
  ED43    28 2F                         JR   Z,KONV22     ;Z = weitere Funktionen
                                
                                ; Berechnung direkte Cursorposition
                                ; OUT:    HL = BWS-Adresse
                                ;
  ED45    F5                            PUSH AF
  ED46    79                            LD   A,C
  ED47    E6 3F                         AND  3FH          ;max. Spaltenzahl
  ED49    6F                            LD   L,A
  ED4A    F1                            POP  AF
  ED4B    E6 1F                         AND  1FH          ;max. Zeilenzahl
  ED4D    16 00                         LD   D,00H
  ED4F    62                            LD   H,D
  ED50    5F                            LD   E,A
  ED51    06 06                         LD   B,06H
  ED53    CB 23                 KONV21: SLA  E
  ED55    CB 12                         RL   D
  ED57    10 FA                         DJNZ KONV21
  ED59    19                            ADD  HL,DE
  ED5A    EB                            EX   DE,HL
  ED5B    21 17FF                       LD   HL,17FFH     ;Ende BWS-RAM
  ED5E    A7                            AND  A
  ED5F    ED 52                         SBC  HL,DE
                                ;
                                ; Cursor direkt positionieren
                                ; IN:    HL = Adresse Cursor
                                ;
  ED61    E5                            PUSH HL
  ED62    2A 1800                       LD   HL,(CUPOS)	  ;alte Position
  ED65    3A F443                       LD   A,(CHAR)	  ;Zeichen holen
  ED68    77                            LD   (HL),A	      ;auf BS schreiben
  ED69    E1                            POP  HL
  ED6A    22 1800                       LD   (CUPOS),HL   ;neue Position setzen
  ED6D    7E                            LD   A,(HL)       ;neues Zeichen holen
  ED6E    32 F443                       LD   (CHAR),A     ;und merken
  ED71    C3 EB04                       JP   KONVT9
                                ;
                                ; Auswertung weiterer ESC-Funktionen
                                ; IN:      A = 1. Steuerzeichen
                                ;
                                ; Ausgabe Grafikzeichen aus AC1-ZG ( > 80h )
                                ;
  ED74    FE 5F                 KONV22: CP   5FH          ;Grafikzeichen?
  ED76    20 08                         JR   NZ,KONV24    ;NZ = nein
  ED78    23                            INC  HL
  ED79    7E                            LD   A,(HL)       ;2. Zeichen holen
  ED7A    2A 1800                       LD   HL,(CUPOS)
  ED7D    C3 EC5F                       JP   CCHAR        ;Zeichen ausgeben
                                ;
                                ; Einstellen der Farbe (nur Color-BWS)
                                ;
  ED80    FE 5D                 KONV24: CP   5DH          ;Farbe?
  ED82    C2 EB04                       JP   NZ,KONVT9    ;NZ = nein
  ED85    3A F43A                       LD   A,(COLOR)    ;Color-BWS?
  ED88    A7                            AND  A
	MACRO-80 3.44	09-Dec-81	PAGE	1-19


  ED89    CA EB04                       JP   Z,KONVT9     ;Z = nein
  ED8C    23                            INC  HL
  ED8D    7E                            LD   A,(HL)       ;2. Zeichen holen
  ED8E    E6 77                         AND  77H          ;intensiv maskieren
  ED90    47                            LD   B,A
  ED91    0F                            RRCA
  ED92    0F                            RRCA
  ED93    0F                            RRCA
  ED94    0F                            RRCA
  ED95    B8                            CP   B            ;Zeichen- und HG-Farbe gleich?
  ED96    CA EB04                       JP   Z,KONVT9     ;Z = Ja, dann ignorieren
  ED99    78                            LD   A,B
  ED9A    32 F43A                       LD   (COLOR),A    ;Farbe setzen
  ED9D    E6 77                         AND  77H          ;intensiv maskieren
  ED9F    32 F43B                       LD   (COLO1),A    ;Backup
  EDA2    C3 EB04                       JP   KONVT9
                                ;
  EDA5    DB F0                 BWSCOL: IN   A,(PF0)      ;bwsport
  EDA7    CB D7                         SET  2,A          ;Farbspeicher ein
  EDA9    18 04                         JR   BWSZ1
                                ;
  EDAB    DB F0                 BWSZEI: IN   A,(PF0)      ;bwsport
  EDAD    CB 97                         RES  2,A          ;Farbspeicher aus
  EDAF    E6 07                 BWSZ1:  AND  07H
  EDB1    D3 F0                         OUT  (PF0),A
  EDB3    C9                            RET
                                ;
  EDB4    AF                    BWSINI: XOR  A            ;Farbbyte auf Monochrom setzen
  EDB5    32 F43A                       LD   (COLOR),A    ;Arbeitszelle Farbbyte im BIOS
  EDB8    32 F43C                       LD   (COLO2),A    ;Merkzelle fuer WBOOT im BIOS
  EDBB    0E F0                         LD   C,0F0H       ;I/O-Adresse COLOR-BWS
  EDBD    ED 40                         IN   B,(C)        ;Konfigbyte COLOR-BWS lesen
  EDBF    04                            INC  B            ;fuer COLOR-BWS muss B<255 sein
  EDC0    C8                            RET  Z            ;kein COLOR-BWS vorhanden --> Ende
                                        ;hier wird die Routine verlassen, wenn kein CPLD vorh. ist
  EDC1    05                            DEC  B            ;Konfigbyte COLOR-BWS: Farb-RAM aus
  EDC2    50                            LD   D,B
  EDC3    CB D2                         SET  2,D          ;Konfigbyte COLOR-BWS: Farb-RAM ein
  EDC5    21 1000                       LD   HL,1000H
  EDC8    5E                            LD   E,(HL)       ;Zeichen aus 1000h
  EDC9    ED 51                         OUT  (C),D        ;Farb-RAM einschalten
  EDCB    3A 181F                       LD   A,(CBWSB)    ;Farbbyte aus dem AC1-Monitor
  EDCE    77                            LD   (HL),A       ;Farbe auf 1000h setzen
  EDCF    BE                            CP   (HL)         ;ist Farb-RAM gesteckt?
  EDD0    ED 41                         OUT  (C),B        ;Farb-RAM ausschalten
  EDD2    73                            LD   (HL),E       ;Zeichen auf 1000h zurueckschreiben
  EDD3    C0                            RET  NZ           ;Farbe hat nicht geklappt --> Ende
                                        ;hier wird die Routine verlassen, wenn kein Farb-RAM steckt
  EDD4    ED 51                         OUT  (C),D        ;Farb-RAM einschalten
  EDD6    C5                            PUSH BC
  EDD7    11 1001                       LD   DE,1001H
  EDDA    01 07FF                       LD   BC,07FFH
  EDDD    ED B0                         LDIR              ;Farb-RAM initialisieren
  EDDF    7E                            LD   A,(HL)       ;Farbe aus 17FFh ruecklesen
  EDE0    C1                            POP  BC
  EDE1    ED 41                         OUT  (C),B        ;Farb-RAM ausschalten
  EDE3    32 F43A                       LD   (COLOR),A    ;Arbeitszelle Farbbyte im BIOS
  EDE6    32 F43C                       LD   (COLO2),A    ;Merkzelle fuer WBOOT im BIOS
  EDE9    C9                            RET
                                ;
                                ;+++++++++++++++++++++++++++++   Ende CONOUT  ++++++++++++++++
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-20


  EDEA    AF                    LISTST: XOR  A
  EDEB    3D                            DEC  A
  EDEC    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
  EDED    21 E641               SELDSK: LD   HL,NDISK     ;max. Anzahl der LW
  EDF0    79                            LD   A,C          ;C = akt. LW
  EDF1    BE                            CP   (HL)
  EDF2    21 0000                       LD   HL,0000H     ;HL=0 --> kein LW
  EDF5    D0                            RET  NC           ;akt. LW >= NDISK!!!
  EDF6    2A E642                       LD   HL,(DPHX)    ;AnfangsADR DPH(y)-Tabelle
  EDF9    06 00                         LD   B,00H        ;BC = akt. LW
  EDFB    09                            ADD  HL,BC
  EDFC    09                            ADD  HL,BC        ;HL = DPHY + (2 * LW)
  EDFD    5E                            LD   E,(HL)
  EDFE    23                            INC  HL
  EDFF    56                            LD   D,(HL)       ;DE = (DPHY + (2 * LW))
  EE00    EB                            EX   DE,HL        ;HL = DPH-ADR vom akt. LW
  EE01    7C                            LD   A,H
  EE02    B5                            OR   L
  EE03    C8                            RET  Z            ;HL=0 --> kein DPB
  EE04    79                            LD   A,C
  EE05    32 F45E                       LD   (DRIVE),A    ;aktives LW --> A
  EE08    22 F465                       LD   (DPH),HL     ;zugeordneter DPH --> HL
  EE0B    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
  EE0C    01 0000               HOME:   LD   BC,0000H
  EE0F    ED 43 F45F            SETTRK: LD   (TRACK),BC
  EE13    C9                            RET
                                ;
  EE14    ED 43 F461            SETSEC: LD   (SECTOR),BC
  EE18    C9                            RET
                                ;
  EE19    ED 43 F463            SETDMA: LD   (DMA),BC
  EE1D    C9                            RET
                                ;
  EE1E    60                    SECTRN: LD   H,B
  EE1F    69                            LD   L,C
  EE20    7A                            LD   A,D
  EE21    B3                            OR   E
  EE22    C8                            RET  Z
  EE23    EB                            EX   DE,HL
  EE24    06 00                         LD   B,00H
  EE26    09                            ADD  HL,BC
  EE27    6E                            LD   L,(HL)
  EE28    62                            LD   H,D
  EE29    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
  EE2A    0E 02                 READ:   LD   C,02H
  EE2C    3E 04                         LD   A,04H
  EE2E    21                            DEFB 21H          ;LD HL,063EH mit nxt. Befehl!!! - DUMMY
  EE2F    3E 06                 WRITE:  LD   A,06H        ;DUMMY fuer READ
  EE31    32 F45D                       LD   (RWBYTE),A   ;hier geht es fuer READ weiter!
  EE34    79                            LD   A,C
  EE35    32 F480                       LD   (DF51E),A
  EE38    21 EE51                       LD   HL,LEDEC
  EE3B    E5                            PUSH HL
	MACRO-80 3.44	09-Dec-81	PAGE	1-21


  EE3C    2A F465                       LD   HL,(DPH)
  EE3F    11 000A                       LD   DE,000AH
  EE42    19                            ADD  HL,DE
  EE43    7E                            LD   A,(HL)
  EE44    23                            INC  HL
  EE45    66                            LD   H,(HL)
  EE46    6F                            LD   L,A
  EE47    2B                            DEC  HL
  EE48    7E                            LD   A,(HL)
  EE49    2B                            DEC  HL
  EE4A    6E                            LD   L,(HL)
  EE4B    67                            LD   H,A
  EE4C    E5                            PUSH HL
  EE4D    21 F45D                       LD   HL,RWBYTE    ;HL -> Bytefolge fuer R/W
  EE50    C9                            RET
                                ;
  EE51    B7                    LEDEC:  OR   A
  EE52    C8                            RET  Z
  EE53    3E 01                         LD   A,01H
  EE55    C9                            RET
                                ;
                                ;************************  RAM-Disk   ******************************
                                ;
  EE56    4E                    RDSKRW: LD   C,(HL)       ;RWBYTE: 04 = Lesen; 06 = Schreiben 
  EE57    23                            INC  HL           ;DRIVE wird uebersprungen
  EE58    23                            INC  HL
  EE59    7E                            LD   A,(HL)       ;TRACK NWT
  EE5A    32 F43D                       LD   (RAFTRK),A
  EE5D    23                            INC  HL
  EE5E    7E                            LD   A,(HL)       ;TRACK HWT
  EE5F    A7                            AND  A
  EE60    20 32                         JR   NZ,RDERR     ;muss 0 sein
  EE62    23                            INC  HL
  EE63    7E                            LD   A,(HL)       ;SEKTOR NWT
  EE64    32 F43E                       LD   (RAFSEC),A
  EE67    CB 7F                         BIT  7,A
  EE69    20 29                         JR   NZ,RDERR     ;Bit 7 muss 0 sein
  EE6B    CB 77                         BIT  6,A
  EE6D    20 25                         JR   NZ,RDERR     ;Bit 6 muss 0 sein
  EE6F    23                            INC  HL
  EE70    7E                            LD   A,(HL)       ;SEKTOR HWT
  EE71    A7                            AND  A
  EE72    20 20                         JR   NZ,RDERR     ;muss 0 sein
  EE74    23                            INC  HL
  EE75    23                            INC  HL           ;DMA wird uebersprungen
  EE76    79                            LD   A,C
  EE77    01 0080                       LD   BC,0080H
  EE7A    FE 06                         CP   06H
  EE7C    28 08                         JR   Z,RDSKWR     ;C = 06 --> RDSK Schreiben
  EE7E    CD EFBE                       CALL ADRRAF
  EE81    ED B2                         INIR
  EE83    00                            NOP
  EE84    AF                            XOR  A            ;in Ordnung
  EE85    C9                            RET
                                ;
  EE86    21 0080               RDSKWR: LD   HL,0080H     ;RAM-Disk schreiben 
  EE89    ED 5B F463                    LD   DE,(DMA)
  EE8D    CD EFBE                       CALL ADRRAF
  EE90    ED B3                         OTIR
  EE92    AF                            XOR  A            ;in Ordnung
  EE93    C9                            RET
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-22


  EE94    3E FF                 RDERR:  LD   A,0FFH       ;Fehler
  EE96    C9                            RET
                                ;
  EE97    20 3D 3E 49           TXTRDI: DEFM " =>INIT.."
  EE9B    4E 49 54 2E           
  EE9F    2E                    
  EEA0    00                            DEFB 0
                                ;
  EEA1    4F 4B                 TXTRDO: DEFM "OK"
  EEA3    00                            DEFB 0
                                ;
  EEA4    2A 2A 2A 20           TXTRDE: DEFM "*** RFL ERROR! ***"
  EEA8    52 46 4C 20           
  EEAC    45 52 52 4F           
  EEB0    52 21 20 2A           
  EEB4    2A 2A                 
  EEB6    0D 0A 0D 0A                   DEFB 0DH,0AH,0DH,0AH
  EEBA    00                            DEFB 0
                                ;
  EEBB    AF                    RDTEST: XOR  A            ;Kapazitaet der RAM-Disk testen
  EEBC    D3 E6                         OUT  (PE0+6),A    ;H-Adresse ruecksetzen
  EEBE    21 EF10                       LD   HL,RDMERK    ;Merkzellen RAM
  EEC1    06 03                         LD   B,3          ;3 Durchlaeufe
  EEC3    0E E0                         LD   C,PE0        ;Test erfolgt in der 1. RAM-Bank
  EEC5    16 00                         LD   D,0          ;Startwert Extended-Adresse
  EEC7    AF                    RDTST1: XOR  A
  EEC8    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EECA    7A                            LD   A,D
  EECB    CB 27                         SLA  A            ;Extended-Adresse *= 2
  EECD    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse auswaehlen
  EECF    ED 78                         IN   A,(C)
  EED1    77                            LD   (HL),A       ;Daten aus der RAM-Disk sichern
  EED2    AF                            XOR  A
  EED3    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EED5    7A                            LD   A,D
  EED6    ED 79                         OUT  (C),A        ;Testwert in die RAM-Disk schreiben
  EED8    23                            INC  HL           ;Merkzelle++
  EED9    14                            INC  D            ;Extended-Adresse++ / Testwert++
  EEDA    10 EB                         DJNZ RDTST1
                                ;
                                ;Tabelle der Test-Werte (mit *...* sind die zu testenden Werte):
                                ;
                                ;     RAM-Disk-Size =     256K  1024K  2048K
                                ;Extended-Adresse=0000B    02H    02H   *00H*
                                ;Extended-Adresse=0010B    02H   *01H*   01H
                                ;Extended-Adresse=0100B   *02H*   02H    02H
                                ;
  EEDC    06 03                         LD   B,3          ;3 Durchlaeufe
  EEDE    16 00                         LD   D,0          ;Startwert Extended-Adresse
  EEE0    AF                    RDTST2: XOR  A
  EEE1    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EEE3    7A                            LD   A,D
  EEE4    CB 27                         SLA  A            ;Extended-Adresse *= 2
  EEE6    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse auswaehlen
  EEE8    ED 78                         IN   A,(C)
  EEEA    BA                            CP   D
  EEEB    28 06                         JR   Z,RDTST3     ;2048K (B=3), 1024K (B=2), 256K (B=1)
  EEED    14                            INC  D            ;Extended-Adresse++ / Testwert++
  EEEE    10 F0                         DJNZ RDTST2
  EEF0    C3 EFB5                       JP   RDERRO       ;Fehler: hier stimmt was nicht!
                                ;
  EEF3    21 EF13               RDTST3: LD   HL,RDSIZE
	MACRO-80 3.44	09-Dec-81	PAGE	1-23


  EEF6    05                            DEC  B
  EEF7    70                            LD   (HL),B       ;RD-Size: 0=256K 1=1024K 2=2048K
                                ;
  EEF8    21 EF10                       LD   HL,RDMERK    ;Merkzellen RAM (in die RD zurueck)
  EEFB    04                            INC  B            ;1-3 Durchlaeufe, je nach RDSIZE
  EEFC    0E E0                         LD   C,PE0        ;1. RAM-Bank
  EEFE    16 00                         LD   D,0          ;Startwert Extended-Adresse
  EF00    AF                    RDTST4: XOR  A
  EF01    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EF03    7A                            LD   A,D
  EF04    CB 27                         SLA  A            ;Extended-Adresse *= 2
  EF06    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse auswaehlen
  EF08    7E                            LD   A,(HL)
  EF09    ED 79                         OUT  (C),A        ;urspruengliche Daten zurueckschreiben
  EF0B    23                            INC  HL
  EF0C    14                            INC  D
  EF0D    10 F1                         DJNZ RDTST4       ;WICHTIG: nicht mehr als notwendig
  EF0F    C9                            RET               ;in die RAM-Disk zurC<ckschreiben!!
                                ;
  EF10                          RDMERK: DEFS 3,0          ;3 Merkzellen fuer den RAM
  EF13    00                    RDSIZE: DEFB 0            ;RD-Size: 0=256K 1=1024K 2=2048K
                                ;
  EF14    21 EE97               RDFORM: LD   HL,TXTRDI    ;Formatierungstext...
  EF17    CD EA47                       CALL OUTTXT
  EF1A    21 C002                       LD   HL,0C002H    ;Hilfsprogramm von 0C000H bis 0C800H
  EF1D    54                            LD   D,H
  EF1E    5D                            LD   E,L
  EF1F    2B                            DEC  HL
  EF20    36 E0                         LD   (HL),PE0     ;0C001H = Grundadresse der RAM-Disk
  EF22    2B                            DEC  HL
  EF23    36 D3                         LD   (HL),0D3H    ;0C000H = 0D3H --> OUT n
  EF25    01 0200                       LD   BC,0200H
  EF28    ED B0                         LDIR              ;0D3H,0E0H von 0C000H bis 0C1FFH
  EF2A    23                            INC  HL
  EF2B    36 E1                         LD   (HL),PE0+1
  EF2D    2B                            DEC  HL
  EF2E    01 0200                       LD   BC,0200H
  EF31    ED B0                         LDIR              ;0D3H,0E1H von 0C200H bis 0C3FFH
  EF33    23                            INC  HL
  EF34    36 E2                         LD   (HL),PE0+2
  EF36    2B                            DEC  HL
  EF37    01 0200                       LD   BC,0200H
  EF3A    ED B0                         LDIR              ;0D3H,0E2H von 0C400H bis 0C5FFH
  EF3C    23                            INC  HL
  EF3D    36 E3                         LD   (HL),PE0+3
  EF3F    2B                            DEC  HL
  EF40    01 0200                       LD   BC,0200H
  EF43    ED B0                         LDIR              ;0D3H,0E3H von 0C600H bis 0C7FFH
  EF45    36 C9                         LD   (HL),0C9H    ;RET auf 0C800H
                                ;
  EF47    21 EF13                       LD   HL,RDSIZE    ;RD-Size: 0=256K 1=1024K 2=2048K
  EF4A    7E                            LD   A,(HL)
  EF4B    FE 00                         CP   0
  EF4D    28 05                         JR   Z,RDFOR1
  EF4F    CB 27                         SLA  A            ;A *= 2
  EF51    CB 27                         SLA  A            ;A *= 2
  EF53    3D                            DEC  A
  EF54    57                    RDFOR1: LD   D,A
  EF55    14                            INC  D            ;neue RD-Size: 1=256K 4=1024K 8=2048K
  EF56    AF                            XOR  A
  EF57    D3 E7                         OUT  (PE0+7),A    ;L-Adresse setzen
  EF59    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse
	MACRO-80 3.44	09-Dec-81	PAGE	1-24


  EF5B    1E 00                         LD   E,0          ;Merker fuer Extended-Adresse
  EF5D    06 00                         LD   B,0          ;256 Durchlaeufe
  EF5F    0E E6                         LD   C,PE0+6
  EF61    ED 41                 RDFOR2: OUT  (C),B        ;H-Adresse setzen
  EF63    3E E5                         LD   A,0E5H       ;RD wird mit 0E5H formatiert
  EF65    CD C000                       CALL HPRDSK       ;Hilfsprogramm Format RAM-Disk
  EF68    10 F7                         DJNZ RDFOR2       ;fuer alle H-Adressen (256 Durchl.)
  EF6A    1C                            INC  E
  EF6B    7B                            LD   A,E
  EF6C    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse
  EF6E    15                            DEC  D
  EF6F    20 F0                         JR   NZ,RDFOR2        
                                ;
  EF71    21 D000                       LD   HL,CCP
  EF74    22 F463                       LD   (DMA),HL
  EF77    06 2C                         LD   B,2CH        ;44 Bloecke CCP+BDOS
  EF79    CD EF86                       CALL WRCCP
  EF7C    C2 E96F                       JP   NZ,CPMERR
  EF7F    21 EEA1                       LD   HL,TXTRDO    ;"OK"
  EF82    CD EA47                       CALL OUTTXT
  EF85    C9                            RET
                                ;
  EF86    C5                    WRCCP:  PUSH BC           ;CCP+BDOS in Systemtrack schreiben
  EF87    0E 00                         LD   C,00H        ;LW A:
  EF89    CD EDED                       CALL SELDSK
  EF8C    C1                            POP  BC
  EF8D    21 0000                       LD   HL,0000H
  EF90    22 F45F                       LD   (TRACK),HL   ;Track 0
  EF93    EB                            EX   DE,HL
  EF94    21 D000                       LD   HL,CCP
  EF97    ED 53 F461            WRCCP1: LD   (SECTOR),DE
  EF9B    22 F463                       LD   (DMA),HL
  EF9E    C5                            PUSH BC
  EF9F    CD                            DEFB 0CDH         ;CALL WRITE -> CD ED CA
  EFA0    EE2F                  WRCCP2: DEFW WRITE        ;kannn durch READ (EDC5) ersetzt werden
  EFA2    C1                            POP  BC
  EFA3    20 10                         JR   NZ,RDERRO
  EFA5    2A F463                       LD   HL,(DMA)
  EFA8    11 0080                       LD   DE,0080H
  EFAB    19                            ADD  HL,DE
  EFAC    ED 5B F461                    LD   DE,(SECTOR)
  EFB0    13                            INC  DE
  EFB1    10 E4                         DJNZ WRCCP1
  EFB3    AF                            XOR  A
  EFB4    C9                            RET
                                ;
  EFB5    21 EEA4               RDERRO: LD   HL,TXTRDE
  EFB8    CD EA47                       CALL OUTTXT
  EFBB    AF                            XOR  A
  EFBC    3D                            DEC  A
  EFBD    C9                            RET
                                ;
                                ;Adressarithmetik RAF: L=RADR 0-7 , H=RADR 8-15 , A=RADR 16-19
                                ;
  EFBE    AF                    ADRRAF: XOR  A            ;CY = 0
  EFBF    6F                            LD   L,A 
  EFC0    3A F43E                       LD   A,(RAFSEC)   ;8 bit
  EFC3    67                            LD   H,A          ;H=Sektor (max. 64 = Bit 0-5)
  EFC4    CB 1C                         RR   H
  EFC6    CB 1D                         RR   L            ;H0 -> L7 ...... H5 -> H4
  EFC8    3A F43D                       LD   A,(RAFTRK)   ;8 bit , A=Track (max. 128 bei 1M = Bit 0-6)
  EFCB    CB 1F                         RR   A            ;A0 -> CY
	MACRO-80 3.44	09-Dec-81	PAGE	1-25


  EFCD    30 02                         JR   NC,ADRAF1
  EFCF    CB EC                         SET  5,H          ;H5 = A0 (RADR13)
  EFD1    CB 1F                 ADRAF1: RR   A            ;A1 -> CY
  EFD3    30 02                         JR   NC,ADRAF2
  EFD5    CB F4                         SET  6,H          ;H6 = A1 (RADR14)
  EFD7    CB 1F                 ADRAF2: RR   A            ;A2 -> CY
  EFD9    30 02                         JR   NC,ADRAF3
  EFDB    CB FC                         SET  7,H          ;H7 = A2 (RADR15)
  EFDD    F5                    ADRAF3: PUSH AF
  EFDE    E6 03                         AND  03H
  EFE0    F6 E0                         OR   PE0          ;Grundadresse der RAM-Disk
  EFE2    4F                            LD   C,A
  EFE3    7D                            LD   A,L
  EFE4    D3 E7                         OUT  (PE0+7),A    ;L-Adresse
  EFE6    7C                            LD   A,H
  EFE7    D3 E6                         OUT  (PE0+6),A    ;H-Adresse
  EFE9    F1                            POP  AF
  EFEA    CB 1F                         RR   A            ;Rotiere A rechts durch Carry
  EFEC    CB 1F                         RR   A
  EFEE    E6 07                         AND  07H          ;max. 2048K RAM-Disk
  EFF0    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse
  EFF2    06 80                         LD   B,80H
  EFF4    2A F463                       LD   HL,(DMA)
  EFF7    C9                            RET
                                ;
                                ;**********************  Ende  RAM-Disk  *********************
                                ;
                                ;*************************  LOAD-Befehl  *********************
                                ;
  EFF8    C9                    LOAD:   RET
                                ;
                                ;******************************   Ende LOAD  *****************
                                ;
  EFF9    2A F465               LEFFA:  LD   HL,(DPH)     ;zugeordneter DPH --> HL
  EFFC    22 F477                       LD   (DF515),HL
  EFFF    2E 0F                 LF000:  LD   L,0FH
  F001    D5                    LF002:  PUSH DE
  F002    11 000A                       LD   DE,000AH
  F005    62                            LD   H,D
  F006    E5                            PUSH HL
  F007    2A F477                       LD   HL,(DF515)
  F00A    19                            ADD  HL,DE
  F00B    5E                            LD   E,(HL)
  F00C    23                            INC  HL
  F00D    56                            LD   D,(HL)
  F00E    E1                            POP  HL
  F00F    19                            ADD  HL,DE
  F010    D1                            POP  DE
  F011    7E                            LD   A,(HL)
  F012    B7                            OR   A
  F013    C9                            RET
                                ;Ansprung unklar
  F014    23                    LF015:  INC  HL
  F015    CB FE                         SET  7,(HL)
  F017    2B                            DEC  HL
  F018    AF                    LF019:  XOR  A
  F019    32 F47E                       LD   (DF51C),A
  F01C    CD F023                       CALL LF024
  F01F    3A F47E                       LD   A,(DF51C)
  F022    C9                            RET
                                ;
  F023    4E                    LF024:  LD   C,(HL)
	MACRO-80 3.44	09-Dec-81	PAGE	1-26


  F024    CD EFF9                       CALL LEFFA
  F027    CA F0E0                       JP   Z,LF0E1
  F02A    79                            LD   A,C
  F02B    FE 06                         CP   06H
  F02D    3E 01                         LD   A,01H
  F02F    20 01                         JR   NZ,LF033
  F031    AF                            XOR  A
  F032    32 F47F               LF033:  LD   (DF51D),A
  F035    CD EFFF                       CALL LF000
  F038    47                            LD   B,A
  F039    2A F461                       LD   HL,(SECTOR)
  F03C    CB 3C                 LF03D:  SRL  H
  F03E    CB 1D                         RR   L
  F040    10 FA                         DJNZ LF03D
  F042    22 F47A                       LD   (DF518),HL
  F045    21 F47C                       LD   HL,DF51A
  F048    7E                            LD   A,(HL)
  F049    36 01                         LD   (HL),01H
  F04B    B7                            OR   A
  F04C    28 26                         JR   Z,LF075
  F04E    3A F45E                       LD   A,(DRIVE)
  F051    21 F467                       LD   HL,DF505
  F054    BE                            CP   (HL)
  F055    20 16                         JR   NZ,LF06E
  F057    2A F468                       LD   HL,(DF506)
  F05A    ED 5B F45F                    LD   DE,(TRACK)
  F05E    ED 52                         SBC  HL,DE
  F060    20 0B                         JR   NZ,LF06E
  F062    2A F46A                       LD   HL,(DF508)
  F065    ED 5B F47A                    LD   DE,(DF518)
  F069    ED 52                         SBC  HL,DE
  F06B    28 1F                         JR   Z,LF08D
  F06D    3A F47D               LF06E:  LD   A,(DF51B)
  F070    B7                            OR   A
  F071    C4 F0CD                       CALL NZ,LF0CE
  F074    21 F45E               LF075:  LD   HL,DRIVE
  F077    11 F467                       LD   DE,DF505
  F07A    01 0009                       LD   BC,0009H
  F07D    ED B0                         LDIR
  F07F    2A F47A                       LD   HL,(DF518)
  F082    22 F46A                       LD   (DF508),HL
  F085    CD F0D0                       CALL LF0D1
  F088    AF                            XOR  A
  F089    32 F47D                       LD   (DF51B),A
  F08C    CD EFFF               LF08D:  CALL LF000
  F08F    23                            INC  HL
  F090    3A F461                       LD   A,(SECTOR)
  F093    A6                            AND  (HL)
  F094    1F                            RRA
  F095    67                            LD   H,A
  F096    3E 00                         LD   A,00H
  F098    1F                            RRA
  F099    6F                            LD   L,A
  F09A    11 F481                       LD   DE,DISKP
  F09D    19                            ADD  HL,DE
  F09E    ED 5B F463                    LD   DE,(DMA)
  F0A2    3A F47F                       LD   A,(DF51D)
  F0A5    B7                            OR   A
  F0A6    20 05                         JR   NZ,LF0AE
  F0A8    3C                            INC  A
  F0A9    32 F47D                       LD   (DF51B),A
  F0AC    EB                            EX   DE,HL
	MACRO-80 3.44	09-Dec-81	PAGE	1-27


  F0AD    01 0080               LF0AE:  LD   BC,0080H
  F0B0    ED B0                         LDIR
  F0B2    3A F47E                       LD   A,(DF51C)
  F0B5    B7                            OR   A
  F0B6    20 10                         JR   NZ,LF0C9
  F0B8    3A F480                       LD   A,(DF51E)
  F0BB    3D                            DEC  A
  F0BC    C0                            RET  NZ
  F0BD    32 F47D                       LD   (DF51B),A
  F0C0    CD F0CD                       CALL LF0CE
  F0C3    3A F47E                       LD   A,(DF51C)
  F0C6    B7                            OR   A
  F0C7    C8                            RET  Z
  F0C8    AF                    LF0C9:  XOR  A
  F0C9    32 F47C                       LD   (DF51A),A
  F0CC    C9                            RET
                                ;
  F0CD    3E 06                 LF0CE:  LD   A,06H
  F0CF    21                            DEFB 21H          ;LD HL,043EH -> 21 3E 04
  F0D0    3E 04                 LF0D1:  LD   A,04H  
  F0D2    32 F479                       LD   (DF517),A
  F0D5    21 F481                       LD   HL,DISKP
  F0D8    22 F46C                       LD   (DF50A),HL
  F0DB    21 F467                       LD   HL,DF505
  F0DE    18 09                         JR   LF0EA
                                ;
  F0E0    3A F45D               LF0E1:  LD   A,(RWBYTE)
  F0E3    32 F479                       LD   (DF517),A
  F0E6    21 F45E                       LD   HL,DRIVE
  F0E9    11 F470               LF0EA:  LD   DE,DF50E
  F0EC    01 0009                       LD   BC,0009H
  F0EF    ED B0                         LDIR
  F0F1    3A F470                       LD   A,(DF50E)
  F0F4    17                            RLA
  F0F5    DA F30D                       JP   C,GIDERW     ;GIDE
  F0F8    3A F472                       LD   A,(DF510)
  F0FB    21 F474                       LD   HL,DF512
  F0FE    B6                            OR   (HL)
  F0FF    C2 F1C0                       JP   NZ,LF1C1
  F102    CD EFFF                       CALL LF000
  F105    32 F450                       LD   (DF4E8),A
  F108    B7                            OR   A
  F109    3E FF                         LD   A,0FFH
  F10B    28 02                         JR   Z,LF110
  F10D    3E 80                         LD   A,80H
  F10F    32 F453               LF110:  LD   (DF4EB),A
  F112    23                            INC  HL
  F113    23                            INC  HL
  F114    7E                            LD   A,(HL)
  F115    32 F451                       LD   (DF4E9),A
  F118    3A F473                       LD   A,(DF511)
  F11B    BE                            CP   (HL)
  F11C    38 04                         JR   C,LF123
  F11E    96                            SUB  (HL)
  F11F    01 0104                       LD   BC,0104H
  F122    3C                    LF123:  INC  A
  F123    32 F44F                       LD   (DF4E7),A
  F126    23                            INC  HL
  F127    7E                            LD   A,(HL)
  F128    32 F452                       LD   (DF4EA),A
  F12B    23                            INC  HL
  F12C    3A F471                       LD   A,(DF50F)
	MACRO-80 3.44	09-Dec-81	PAGE	1-28


  F12F    BE                            CP   (HL)
  F130    38 04                         JR   C,LF137
  F132    96                            SUB  (HL)
  F133    01 0104                       LD   BC,0104H
  F136    32 F44D               LF137:  LD   (DF4E5),A
  F139    23                            INC  HL
  F13A    7E                            LD   A,(HL)
  F13B    B1                            OR   C
  F13C    32 F44C                       LD   (DF4E4),A
  F13F    78                            LD   A,B
  F140    32 F44E                       LD   (DF4E6),A
  F143    23                            INC  HL
  F144    3A F479                       LD   A,(DF517)
  F147    16 05                         LD   D,05H
  F149    FE 06                         CP   06H
  F14B    28 02                         JR   Z,LF150
  F14D    16 06                         LD   D,06H
  F14F    7E                    LF150:  LD   A,(HL)
  F150    E6 40                         AND  40H
  F152    B2                            OR   D
  F153    32 F44A                       LD   (DF4E2),A
  F156    11 F454                       LD   DE,DF4EC
  F159    01 0004                       LD   BC,0004H
  F15C    ED B0                         LDIR
  F15E    0E 02                         LD   C,02H
  F160    06 02                 LF161:  LD   B,02H
  F162    C5                    LF163:  PUSH BC
  F163    CD F174                       CALL LF175
  F166    C1                            POP  BC
  F167    B7                            OR   A
  F168    C8                            RET  Z
  F169    10 F7                         DJNZ LF163
  F16B    0D                            DEC  C
  F16C    C8                            RET  Z
  F16D    C5                            PUSH BC
  F16E    CD F1D4                       CALL LF1D5
  F171    C1                            POP  BC
  F172    18 EC                         JR   LF161
                                ;
  F174    3E 03                 LF175:  LD   A,03H
  F176    06 02                         LD   B,02H
  F178    21 F456                       LD   HL,CTAB      ;FDC Befehlsbyte
  F17B    D3 41                         OUT  (DFDC),A     ;Datenport FDC
  F17D    CD F22F                       CALL LF230
  F180    CD F1E6                       CALL LF1E7
  F183    20 3B                         JR   NZ,LF1C1
  F185    21 0040                       LD   HL,0040H
  F188    3A F450                       LD   A,(DF4E8)
  F18B    3C                            INC  A
  F18C    29                    LF18D:  ADD  HL,HL
  F18D    3D                            DEC  A
  F18E    20 FC                         JR   NZ,LF18D
  F190    2B                            DEC  HL
  F191    24                            INC  H
  F192    2C                            INC  L
  F193    E5                            PUSH HL
  F194    2A F475                       LD   HL,(DF513)
  F197    E5                            PUSH HL
  F198    3A F44A                       LD   A,(DF4E2)
  F19B    4F                            LD   C,A
  F19C    06 09                         LD   B,09H
  F19E    0F                            RRCA
	MACRO-80 3.44	09-Dec-81	PAGE	1-29


  F19F    3E 51                         LD   A,51H
  F1A1    8F                            ADC  A,A
  F1A2    32 F26E                       LD   (MODE0),A    ;A2 --> INI
  F1A5    32 F274                       LD   (MODE1),A    ;A3 --> OUTI
  F1A8    F3                            DI
  F1A9    CD F226                       CALL LF227
  F1AC    E1                            POP  HL
  F1AD    D1                            POP  DE
  F1AE    43                            LD   B,E
  F1AF    0E 41                         LD   C,DFDC       ;Datenport FDC
  F1B1    CD F261                       CALL RW           ;FDC RW-Routine
  F1B4    FB                            EI
  F1B5    CD F1C7                       CALL LF1C8
  F1B8    21 F458                       LD   HL,DF4F0
  F1BB    7E                            LD   A,(HL)
  F1BC    E6 C0                         AND  0C0H
  F1BE    28 02                         JR   Z,LF1C3
  F1C0    3E FF                 LF1C1:  LD   A,0FFH
  F1C2    32 F47E               LF1C3:  LD   (DF51C),A
  F1C5    B7                            OR   A
  F1C6    C9                            RET
                                ;
  F1C7    06 07                 LF1C8:  LD   B,07H
  F1C9    21 F458                       LD   HL,DF4F0
  F1CC    CD F24A               LF1CD:  CALL LF24B
  F1CF    77                            LD   (HL),A
  F1D0    23                            INC  HL
  F1D1    10 F9                         DJNZ LF1CD
  F1D3    C9                            RET
                                ;
  F1D4    01 0207               LF1D5:  LD   BC,0207H
  F1D7    CD F226                       CALL LF227
  F1DA    CD F206                       CALL LF207
  F1DD    C8                            RET  Z
  F1DE    01 0207                       LD   BC,0207H
  F1E1    CD F226                       CALL LF227
  F1E4    18 20                         JR   LF207
                                ;
  F1E6    3A F44D               LF1E7:  LD   A,(DF4E5)
  F1E9    32 F459                       LD   (DF4F7),A
  F1EC    B7                            OR   A
  F1ED    28 E5                         JR   Z,LF1D5
  F1EF    01 030F                       LD   BC,030FH
  F1F2    21 F454                       LD   HL,DF4EC
  F1F5    CB 66                         BIT  4,(HL)
  F1F7    28 04                         JR   Z,LF1FE
  F1F9    87                            ADD  A,A
  F1FA    32 F44D                       LD   (DF4E5),A
  F1FD    CD F226               LF1FE:  CALL LF227
  F200    3A F459                       LD   A,(DF4F7)
  F203    32 F44D                       LD   (DF4E5),A
  F206    01 0108               LF207:  LD   BC,0108H
  F209    CD F226                       CALL LF227
  F20C    CD F24A                       CALL LF24B
  F20F    47                            LD   B,A
  F210    32 F458                       LD   (DF4F0),A
  F213    FE 80                         CP   80H
  F215    C4 F24A                       CALL NZ,LF24B
  F218    CB 68                         BIT  5,B
  F21A    28 EA                         JR   Z,LF207
  F21C    78                            LD   A,B
  F21D    E6 F0                         AND  0F0H
	MACRO-80 3.44	09-Dec-81	PAGE	1-30


  F21F    FE C0                         CP   0C0H
  F221    28 E3                         JR   Z,LF207
  F223    EE 20                         XOR  20H
  F225    C9                            RET
                                ;
  F226    C5                    LF227:  PUSH BC
  F227    CD F284                       CALL LF285
  F22A    C1                            POP  BC
  F22B    21 F44B               LF22C:  LD   HL,DF4E3
  F22E    71                            LD   (HL),C
  F22F    0E 41                 LF230:  LD   C,41H
  F231    D5                            PUSH DE
  F232    11 1FFF               LF233:  LD   DE,1FFFH
  F235    7B                    LF236:  LD   A,E
  F236    B2                            OR   D
  F237    28 0D                         JR   Z,LF247      ;Abbruch nach 8192 Versuchen
  F239    DB 40                         IN   A,(CFDC)     ;Lese Hauptstatusregister
  F23B    E6 C0                         AND  0C0H
  F23D    FE 80                         CP   80H          ;FDC bereit zum Schreiben?
  F23F    1B                            DEC  DE
  F240    20 F3                         JR   NZ,LF236     ;noch nicht bereit
  F242    ED A3                         OUTI              ;1 Byte --> FDC
  F244    20 EC                         JR   NZ,LF233     ;Wdhlg., bis B=0
  F246    06 00                 LF247:  LD   B,00H
  F248    D1                            POP  DE
  F249    C9                            RET
                                ;
  F24A    E5                    LF24B:  PUSH HL
  F24B    21 1FFF                       LD   HL,1FFFH
  F24E    7D                    LF24F:  LD   A,L
  F24F    B4                            OR   H
  F250    3E C0                         LD   A,0C0H
  F252    28 0B                         JR   Z,LF260      ;Abbruch nach 8192 Versuchen
  F254    DB 40                         IN   A,(CFDC)     ;Lese Hauptstatusregister
  F256    E6 C0                         AND  0C0H
  F258    FE C0                         CP   0C0H         ;FDC bereit zum Lesen?
  F25A    2B                            DEC  HL
  F25B    20 F1                         JR   NZ,LF24F     ;noch nicht bereit
  F25D    DB 41                         IN   A,(DFDC)     ;1 Byte vom FDC lesen --> A
  F25F    E1                    LF260:  POP  HL
  F260    C9                            RET
                                ;
                                ;
                                ;       FDC READ/WRITE Routine
                                ;       ----------------------
                                ;
  F261    3A F45C               RW:     LD   A,(LATPU)
  F264    CB CF                         SET  1,A
  F266    D3 45                         OUT  (LATCH),A    ;WAIT-Freigabe
  F268    DB 40                 RW01:   IN   A,(CFDC)     ;Lese Hauptstatusregister
  F26A    07                            RLCA
  F26B    30 FB                         JR   NC,RW01      ;FDC noch nicht bereit
  F26D    ED                            DEFB 0EDH         ;ED A2 = INI
  F26E    A2                    MODE0:  DEFB 0A2H         ;ED A3 = OUTI
  F26F    00                            NOP
  F270    D3 43                 RW02:   OUT  (WAIT),A     ;WAIT bis Interrupt FDC
  F272    00                            NOP
  F273    ED                            DEFB 0EDH         ;ED A2 = INI
  F274    A2                    MODE1:  DEFB 0A2H         ;ED A3 = OUTI
  F275    C2 F270                       JP   NZ,RW02
  F278    15                            DEC  D
  F279    C2 F270                       JP   NZ,RW02
	MACRO-80 3.44	09-Dec-81	PAGE	1-31


  F27C    3A F45C                       LD   A,(LATPU)
  F27F    CB E7                         SET  4,A          ;Terminal Count
  F281    D3 45                         OUT  (LATCH),A    ;TC + WAIT-Sperrung
  F283    C9                            RET
                                ;
  F284    21 F45A               LF285:  LD   HL,DF4F8
  F287    3A F44C                       LD   A,(DF4E4)
  F28A    E6 03                         AND  03H
  F28C    BE                            CP   (HL)
  F28D    77                            LD   (HL),A
  F28E    23                            INC  HL
  F28F    4E                            LD   C,(HL)
  F290    36 48                         LD   (HL),48H
  F292    F5                            PUSH AF
  F293    E5                            PUSH HL
  F294    21 F45C                       LD   HL,LATPU
  F297    3A F44C                       LD   A,(DF4E4)
  F29A    E6 03                         AND  03H
  F29C    28 08                         JR   Z,LF2A7
  F29E    FE 02                         CP   02H
  F2A0    28 04                         JR   Z,LF2A7
  F2A2    CB DE                         SET  3,(HL)       ;Floppy-LW 1: Motor an
  F2A4    18 02                         JR   LF2A9
                                ;
  F2A6    CB C6                 LF2A7:  SET  0,(HL)       ;Floppy-LW 0: Motor an
  F2A8    7E                    LF2A9:  LD   A,(HL)
  F2A9    D3 45                         OUT  (LATCH),A
  F2AB    E1                            POP  HL
  F2AC    F1                            POP  AF
  F2AD    20 04                         JR   NZ,LF2B4
  F2AF    79                            LD   A,C
  F2B0    A7                            AND  A
  F2B1    20 09                         JR   NZ,LF2BD
  F2B3    3E 48                 LF2B4:  LD   A,48H
  F2B5    CB 3F                         SRL  A
  F2B7    CB 3F                         SRL  A
  F2B9    BE                            CP   (HL)
  F2BA    38 F7                         JR   C,LF2B4
  F2BC    7E                    LF2BD:  LD   A,(HL)
  F2BD    A7                            AND  A
  F2BE    20 08                         JR   NZ,LF2C9
  F2C0    E5                            PUSH HL
  F2C1    21 F2DC                       LD   HL,DISCTX
  F2C4    CD EA47                       CALL OUTTXT
  F2C7    E1                            POP  HL
  F2C8    C5                    LF2C9:  PUSH BC
  F2C9    E5                            PUSH HL
  F2CA    01 0204                       LD   BC,0204H
  F2CD    CD F22B                       CALL LF22C
  F2D0    CD F24A                       CALL LF24B
  F2D3    E1                            POP  HL
  F2D4    C1                            POP  BC
  F2D5    CB 6F                         BIT  5,A
  F2D7    28 E3                         JR   Z,LF2BD
  F2D9    36 90                         LD   (HL),90H
  F2DB    C9                            RET
                                ;
  F2DC    20 44 49 53           DISCTX: DEFM ' DISC?'
  F2E0    43 3F                 
  F2E2    08 08 08 08                   DEFB 8,8,8,8,8,8
  F2E6    08 08                 
  F2E8    00                            NOP
	MACRO-80 3.44	09-Dec-81	PAGE	1-32


                                ;
                                ;
                                ; Interrupteinsprung von CTC Kanal 3
                                ;
  F2E9    F3                    ISRCTC: DI                ;DI hat gefehlt, wurde ergaenzt
  F2EA    F5                            PUSH AF
  F2EB    3A F45B                       LD   A,(CTCCNT)   ;CTC-Zusatzzaehler lesen
  F2EE    A7                            AND  A
  F2EF    28 12                         JR   Z,ISRCTE     ;bei "0", die Fkt. beenden
                                        ;Beim Start von HRCPM wird CNTCNT per Interrupt von 255 auf 0 heruntergezaehlt.
                                        ;Das sieht nach einer verzoegerten Steuerung von LATPU und LATCH aus.
  F2F1    3D                            DEC  A
  F2F2    32 F45B                       LD   (CTCCNT),A
  F2F5    20 0C                         JR   NZ,ISRCTE
  F2F7    E5                            PUSH HL           ;Bei 2 MHz CPU-Takt wird nach 8 Sekunden diese Stelle erreicht
  F2F8    21 F45C                       LD   HL,LATPU
  F2FB    CB 86                         RES  0,(HL)       ;Floppy-LW 0: Motor aus
  F2FD    CB 9E                         RES  3,(HL)       ;Floppy-LW 1: Motor aus
  F2FF    7E                            LD   A,(HL)
  F300    D3 45                         OUT  (LATCH),A    ;Latch auf dem Floppy-Controller ruecksetzen
  F302    E1                            POP  HL
  F303    F1                    ISRCTE: POP  AF
  F304    FB                    INTEND: EI                ;ist zusaetzlich Einsprungpunkt fuer nicht genutzte Interrupts
  F305    ED 4D                         RETI
                                ;
                                ;-------------  R/W GIDE HW  -----------------------------------------------------------
                                
  F307    DB 8F                 WAIRDY: IN   A,(P8F)      ;Command / Status
  F309    17                            RLA               ;Bit 0 = CY
  F30A    38 FB                         JR   C,WAIRDY     ;wait for hard disk ready (non-busy)
  F30C    C9                            RET
                                
  F30D    CD F307               GIDERW: CALL WAIRDY
  F310    2E 19                         LD   L,19H
  F312    CD F001                       CALL LF002
  F315    4F                            LD   C,A
  F316    2A F473                       LD   HL,(DF511)
  F319    23                            INC  HL
  F31A    AF                            XOR  A
  F31B    47                            LD   B,A
  F31C    3C                    LF318:  INC  A
  F31D    ED 42                         SBC  HL,BC
  F31F    28 02                         JR   Z,LF31F
  F321    30 F9                         JR   NC,LF318
  F323    09                    LF31F:  ADD  HL,BC
  F324    3D                            DEC  A
  F325    57                            LD   D,A
  F326    5D                            LD   E,L
  F327    2E 11                         LD   L,11H
  F329    CD F001                       CALL LF002
  F32C    B2                            OR   D
  F32D    D3 8E                         OUT  (P8E),A      ;Drive and Head
  F32F    7B                            LD   A,E
  F330    D3 8B                         OUT  (P8B),A      ;Sector Number
  F332    23                            INC  HL
  F333    5E                            LD   E,(HL)
  F334    23                            INC  HL
  F335    56                            LD   D,(HL)
  F336    2A F471                       LD   HL,(DF50F)
  F339    19                            ADD  HL,DE
  F33A    7D                            LD   A,L
  F33B    D3 8C                         OUT  (P8C),A      ;Cylinder Low
	MACRO-80 3.44	09-Dec-81	PAGE	1-33


  F33D    7C                            LD   A,H
  F33E    D3 8D                         OUT  (P8D),A      ;Cylinder High
  F340    3E 01                         LD   A,01H
  F342    D3 8A                         OUT  (P8A),A      ;Sector Count
  F344    3A F479                       LD   A,(DF517)
  F347    FE 06                         CP   06H
  F349    28 16                         JR   Z,LF35D      ;6 = schreiben
                                ;
                                ;  GIDE lesen 1 Sektor = 512 Bytes nach Puffer
                                ;
  F34B    3E 20                         LD   A,20H        ;Read Sector
  F34D    D3 8F                         OUT  (P8F),A      ;Command / Status
  F34F    DB 8F                 LF34B:  IN   A,(P8F)      ;Command / Status
  F351    CB 5F                         BIT  3,A
  F353    28 FA                         JR   Z,LF34B      ;wait resp. DRQ active.
  F355    2A F475                       LD   HL,(DF513)
  F358    01 0088                       LD   BC,0088H     ;B = 0 (counter), C = I/O address (Data Register)
  F35B    ED B2                         INIR
  F35D    ED B2                         INIR              ;512 bytes gesamt lesen
  F35F    18 17                         JR   LF376
                                ;
                                ;  GIDE schreiben 1 Sektor = 512 Bytes von Puffer
                                ;
  F361    3E 30                 LF35D:  LD   A,30H        ;Write Sector
  F363    D3 8F                         OUT  (P8F),A      ;Command / Status
  F365    CD F307               LF361:  CALL WAIRDY
  F368    DB 8F                 LF366:  IN   A,(P8F)      ;Command / Status
  F36A    CB 5F                         BIT  3,A
  F36C    28 FA                         JR   Z,LF366      ;wait resp. DRQ active.
  F36E    2A F475                       LD   HL,(DF513)
  F371    01 0088                       LD   BC,0088H     ;B = 0 (counter), C = I/O address (Data Register)
  F374    ED B3                         OTIR             
  F376    ED B3                         OTIR              ;512 bytes gesamt schreiben 
                                ;        
  F378    CD F307               LF376:  CALL WAIRDY
  F37B    DB 8F                         IN   A,(P8F)      ;Command / Status
  F37D    E6 89                         AND  89H          ;10001001b - busy, DRQ, or error?
  F37F    C8                            RET  Z            ;no: all is fine, mit A=0
  F380    3E FF                         LD   A,0FFH
  F382    32 F47E                       LD   (DF51C),A
  F385    C9                            RET               ;on errors, return with A=FFh
                                ;
                                ;-----------------  ENDE GIDE HW  ------------------------------------------
                                ;
  F386    43 4F 4E 49                   DEFM "CONIN-ZBIOS-STACK==26BYTES"
  F38A    4E 2D 5A 42           
  F38E    49 4F 53 2D           
  F392    53 54 41 43           
  F396    4B 3D 3D 32           
  F39A    36 42 59 54           
  F39E    45 53                 
  F3A0    43 4F 4E 49                   DEFM "CONIN-ZBIOS-STACK==26BYTES"
  F3A4    4E 2D 5A 42           
  F3A8    49 4F 53 2D           
  F3AC    53 54 41 43           
  F3B0    4B 3D 3D 32           
  F3B4    36 42 59 54           
  F3B8    45 53                 
  F3BA    43 4F 4E 4F           CINSP:  DEFM "CONOUT-STACK_CONOUT-STACK_CONOUT-STACK"
  F3BE    55 54 2D 53           
  F3C2    54 41 43 4B           
  F3C6    5F 43 4F 4E           
	MACRO-80 3.44	09-Dec-81	PAGE	1-34


  F3CA    4F 55 54 2D           
  F3CE    53 54 41 43           
  F3D2    4B 5F 43 4F           
  F3D6    4E 4F 55 54           
  F3DA    2D 53 54 41           
  F3DE    43 4B                 
  F3E0    4C 4F 41 44           COUTSP: DEFM "LOAD-ZBIOS-STACK=48BYTES"
  F3E4    2D 5A 42 49           
  F3E8    4F 53 2D 53           
  F3EC    54 41 43 4B           
  F3F0    3D 34 38 42           
  F3F4    59 54 45 53           
  F3F8    4C 4F 41 44                   DEFM "LOAD-ZBIOS-STACK=48BYTES"
  F3FC    2D 5A 42 49           
  F400    4F 53 2D 53           
  F404    54 41 43 4B           
  F408    3D 34 38 42           
  F40C    59 54 45 53           
  F410    5A 42 49 4F                   DEFM "ZBIOS(C)ML-SOFT 2003 & AC1-BIOS(C)HR 2011"
  F414    53 28 43 29           
  F418    4D 4C 2D 53           
  F41C    4F 46 54 20           
  F420    32 30 30 33           
  F424    20 26 20 41           
  F428    43 31 2D 42           
  F42C    49 4F 53 28           
  F430    43 29 48 52           
  F434    20 32 30 31           
  F438    31                    
  F439    00                    CPMSTK: NOP
                                ;
                                ;****************  Ende CP/M StackBereich  *******************
                                ;
  F43A    00                    COLOR:  DEFB 0            ;Merkzelle aktuelle BWS-Farbe (0=Monochrom)
  F43B    00                    COLO1:  DEFB 0            ;aktuelle Farbe ohne invers und intensiv
  F43C    00                    COLO2:  DEFB 0            ;Farbe fuer Monitor und CP/M Warmstart
                                ;
  F43D    00                    RAFTRK: DEFB 0            ;RAFTRK EQU 0F4C2H
  F43E    00                    RAFSEC: DEFB 0
                                ;
  F43F    01                    CUFLAG: DEFB 1            ;CUON/CUOFF  KursorFlag  F4CDh
  F440    00                    STZ00:  DEFB 0            ;Merkzelle Anz. BS-Steuerzeichen  F4CFh
  F441    00                    STZ01:  DEFB 0            ;Merkzelle fuer 1. ESC-Steuerzeichen
  F442    00                    STZ02:  DEFB 0            ;Merkzelle fuer 2. ESC-Steuerzeichen
                                ;
  F443    00                    CHAR:   DEFB 0            ;Merkzelle Zeichen <> Cursor  F4D2h
                                ;
  F444    0000                  SPCIN:  DEFW 0            ;F4D8
  F446    0000                  SPCOUT: DEFW 0
  F448    0000                  OLDNMI: DEFW 0            ;2 Bytes fuer alten NMI
                                ;
  F44A    00                    DF4E2:  NOP
  F44B    00                    DF4E3:  NOP               ;Merkzelle
  F44C    00                    DF4E4:  NOP
  F44D    00                    DF4E5:  NOP
  F44E    00                    DF4E6:  NOP
  F44F    00                    DF4E7:  NOP
  F450    00                    DF4E8:  NOP
  F451    00                    DF4E9:  NOP
  F452    00                    DF4EA:  NOP
  F453    00                    DF4EB:  NOP
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-35


  F454    00                    DF4EC:  NOP               ;4 Merkzellen  
  F455    00                            NOP
  F456    00                    CTAB:   NOP               ;FDC Befehlsbyte
  F457    00                            NOP               ;4 Merkzellen Ende
                                ;
  F458    00                    DF4F0:  NOP
  F459    00                    DF4F7:  NOP
  F45A    00                    DF4F8:  NOP
  F45B    00                    CTCCNT: NOP               ;CTC-Counter - Zusatzzaehler fuer CTC-Interrupt
  F45C    00                    LATPU:  NOP               ;Latch fuer den Floppy-Controler
                                ;
                                ;hier beginnt eine Bytefolge fuer Read/Write Operationen
                                ;
  F45D    04                    RWBYTE: DEFB 4            ;4 = READ, 6 = WRITE
  F45E    00                    DRIVE:  DEFB 0            ;LW-Nr.
  F45F    0000                  TRACK:  DEFW 0            ;akt. Track
  F461    0000                  SECTOR: DEFW 0            ;akt. Sektor
  F463    0000                  DMA:    DEFW 0            ;DMA-Adresse
  F465    0000                  DPH:    DEFW 0
                                ;
  F467    00                    DF505:  DEFB 0            ;9 Bytes Kopie ab DRIVE:
  F468    0000                  DF506:  DEFW 0
  F46A    0000                  DF508:  DEFW 0
  F46C    0000                  DF50A:  DEFW 0
  F46E    0000                          DEFW 0            ;Ende 9 Bytes
                                ;
  F470    00                    DF50E:  NOP               ;9 Bytes Kopie ab DRIVE: bzw. DF505:
  F471    00                    DF50F:  NOP
  F472    00                    DF510:  NOP
  F473    00                    DF511:  DEFB 0
  F474    00                    DF512:  DEFB 0
  F475    0000                  DF513:  DEFW 0            ;Adresse akt. DISKPuffer
  F477    0000                  DF515:  DEFW 0            ;zugeordneter DPH - Ende 9 Bytes
                                ;
  F479    04                    DF517:  DEFB 4            ;4 = READ, 6 = WRITE
  F47A    0000                  DF518:  DEFW 0
  F47C    00                    DF51A:  DEFB 0
  F47D    00                    DF51B:  NOP
  F47E    00                    DF51C:  NOP
  F47F    00                    DF51D:  NOP
  F480    00                    DF51E:  NOP
                                ;
  F481                          DISKP:  DEFS 1024,0       ;HW-Sektor Puffer aller LW (1k max. fuer FDD)
  F881                          DIRBF:  DEFS 128,0        ;1 REC Puffer fuer Direktory
  F901                          ALL00:  DEFS 128,0        ;2048k(max.) / 2k / 8 = 128
  F981                          ALL01:  DEFS 50,0         ;0F99FH
  F9B3                          ALL02:  DEFS 504,0        ;0F9D1H
  FBAB                          ALL03:  DEFS 256,0        ;0FBC9H
  FCAB                          ALL04:  DEFS 256,0        ;0FCC9H
  FDAB                          ALL05:  DEFS 50,0         ;0FDC9H
  FDDD                          ALL06:  DEFS 50,0         ;0FDFBH
  FE0F                          CHK01:  DEFS 32,0         ;0FE2DH
  FE2F                          CHK05:  DEFS 32,0         ;0FE4DH
  FE4F                          CHK06:  DEFS 32,0         ;0FE6DH
                                ;
  FE6F    42 49 4F 53                   DEFM "BIOS-Ende"  ;nur fuer Frieder zur Info
  FE73    2D 45 6E 64           
  FE77    65                    
                                ;
                                ;
  FF80                          DFF80   EQU  0FF80H       ;Interrupt-Einsprungpunkt CTC Kanal 0
  FF82                          DFF82   EQU  0FF82H       ;Interrupt-Einsprungpunkt CTC Kanal 1
	MACRO-80 3.44	09-Dec-81	PAGE	1-36


  FF84                          DFF84   EQU  0FF84H       ;Interrupt-Einsprungpunkt CTC Kanal 2
  FF86                          DFF86   EQU  0FF86H       ;Interrupt-Einsprungpunkt CTC Kanal 3
  FF88                          DFF88   EQU  0FF88H       ;Interrupt-Einsprungpunkt Nr.1 PIO1A
  FF8A                          DFF8A   EQU  0FF8AH       ;Interrupt-Einsprungpunkt Nr.2 PIO1A
                                ;
                                ;#############################   PortAdressen   ##############
                                ;
  0000                          P00     EQU  00H          ;CTC Kanal 0
  0001                          P01     EQU  01H          ;CTC Kanal 1
  0002                          P02     EQU  02H          ;CTC Kanal 2
  0003                          P03     EQU  03H          ;CTC Kanal 3
                                ;
  0004                          P04     EQU  04H          ;PIO_A-Daten
  0005                          P05     EQU  05H          ;PIO_B-Daten
  0006                          P06     EQU  06H          ;PIO_A-Control
                                ;
  0011                          P11     EQU  11H          ;Modul_1 - ggf. EPROMs ausblenden
                                ;
  001E                          P1E     EQU  1EH          ;CP/M - Umschalter
                                ;
  008A                          P8A     EQU  8AH          ;GIDE Sector Count
  008B                          P8B     EQU  8BH          ;GIDE Sector Number
  008C                          P8C     EQU  8CH          ;GIDE Cylinder Low
  008D                          P8D     EQU  8DH          ;GIDE Cylinder High
  008E                          P8E     EQU  8EH          ;GIDE Drive and Head
  008F                          P8F     EQU  8FH          ;GIDE Command/Status
                                ;
                                        .DEPHASE
                                        END
	MACRO-80 3.44	09-Dec-81	PAGE	S


Macros:

Symbols:
E9B2 	AC1MOD          EFD1 	ADRAF1          EFD7 	ADRAF2          
EFDD 	ADRAF3          EFBE 	ADRRAF          F901 	ALL00           
F981 	ALL01           F9B3 	ALL02           FBAB 	ALL03           
FCAB 	ALL04           FDAB 	ALL05           FDDD 	ALL06           
185B 	ARG1            185D 	ARG2            EBC2 	BCL1            
EB96 	BCLS            D806 	BDOS            0005 	BDOSF           
EA14 	BEEP1           EA15 	BEEP2           ECF5 	BINTE           
ECE6 	BINVN           ED02 	BIVIN           ECD8 	BNORM           
E86C 	BOOT            E989 	BOOT1           E901 	BOOT2           
E909 	BOOT3           E91A 	BOOT4           1818 	BREAK           
EDA5 	BWSCOL          EDB4 	BWSINI          EDAF 	BWSZ1           
EDAB 	BWSZEI          EBDB 	CBLO1           EBF0 	CBLO2           
EBD8 	CBLOE           181F 	CBWSB           EC6F 	CCHA1           
EC5F 	CCHAR           D000 	CCP             EBD1 	CCRET           
0040 	CFDC            F443 	CHAR            FE0F 	CHK01           
FE2F 	CHK05           FE4F 	CHK06           EC4F 	CHOCH           
EC53 	CHOLI           EB8D 	CHOME           F3BA 	CINSP           
EBB5 	CLEFT           EBB9 	CLF             EB13 	COEN1           
F43B 	COLO1           F43C 	COLO2           F43A 	COLOR           
D007 	COMLEN          EA5F 	CONIN           EA6D 	CONIN1          
EA8F 	CONIN3          EA95 	CONIN4          EAD7 	CONOUT          
EA57 	CONST           F3E0 	COUTSP          E96F 	CPMERR          
E9AD 	CPMMOD          F439 	CPMSTK          EBFB 	CRIGH           
F456 	CTAB            F45B 	CTCCNT          F43F 	CUFLAG          
ED1B 	CUOFF           ED13 	CUON            1800 	CUPOS           
000F 	CUZEI           EC31 	CZLC1           EC45 	CZLC2           
EC26 	CZLCR           EC05 	CZLO1           EC1C 	CZLO2           
EBFF 	CZLOE           F44A 	DF4E2           F44B 	DF4E3           
F44C 	DF4E4           F44D 	DF4E5           F44E 	DF4E6           
F44F 	DF4E7           F450 	DF4E8           F451 	DF4E9           
F452 	DF4EA           F453 	DF4EB           F454 	DF4EC           
F458 	DF4F0           F459 	DF4F7           F45A 	DF4F8           
F467 	DF505           F468 	DF506           F46A 	DF508           
F46C 	DF50A           F470 	DF50E           F471 	DF50F           
F472 	DF510           F473 	DF511           F474 	DF512           
F475 	DF513           F477 	DF515           F479 	DF517           
F47A 	DF518           F47C 	DF51A           F47D 	DF51B           
F47E 	DF51C           F47F 	DF51D           F480 	DF51E           
0041 	DFDC            FF80 	DFF80           FF82 	DFF82           
FF84 	DFF84           FF86 	DFF86           FF88 	DFF88           
FF8A 	DFF8A           F881 	DIRBF           F2DC 	DISCTX          
F481 	DISKP           F463 	DMA             E77B 	DP1024          
E78A 	DP2048          E6C4 	DPB0            E6D5 	DPB1            
E6F1 	DPB2            E70D 	DPB3            E729 	DPB4            
E745 	DPB5            E761 	DPB6            F465 	DPH             
E652 	DPH0            E662 	DPH1            E672 	DPH2            
E682 	DPH3            E692 	DPH4            E6A2 	DPH5            
E6B2 	DPH6            E642 	DPHX            E644 	DPHY            
F45E 	DRIVE           E9B8 	EXIT            E9BC 	EXIT1           
F30D 	GIDERW          EE0C 	HOME            C000 	HPRDSK          
F304 	INTEND          0003 	IOBYTE          F2E9 	ISRCTC          
F303 	ISRCTE          EA2C 	ISREND          EA32 	ISRPA           
E9DF 	ISRTAS          ED22 	KONV10          ED35 	KONV20          
ED53 	KONV21          ED74 	KONV22          ED80 	KONV24          
EB2B 	KONVT1          EB04 	KONVT9          EB20 	KONVTB          
0045 	LATCH           F45C 	LATPU           EE51 	LEDEC           
EFF9 	LEFFA           EAC4 	LEND1           EFFF 	LF000           
F001 	LF002           F014 	LF015           F018 	LF019           
	MACRO-80 3.44	09-Dec-81	PAGE	S-1


F023 	LF024           F032 	LF033           F03C 	LF03D           
F06D 	LF06E           F074 	LF075           F08C 	LF08D           
F0AD 	LF0AE           F0C8 	LF0C9           F0CD 	LF0CE           
F0D0 	LF0D1           F0E0 	LF0E1           F0E9 	LF0EA           
F10F 	LF110           F122 	LF123           F136 	LF137           
F14F 	LF150           F160 	LF161           F162 	LF163           
F174 	LF175           F18C 	LF18D           F1C0 	LF1C1           
F1C2 	LF1C3           F1C7 	LF1C8           F1CC 	LF1CD           
F1D4 	LF1D5           F1E6 	LF1E7           F1FD 	LF1FE           
F206 	LF207           F226 	LF227           F22B 	LF22C           
F22F 	LF230           F232 	LF233           F235 	LF236           
F246 	LF247           F24A 	LF24B           F24E 	LF24F           
F25F 	LF260           F284 	LF285           F2A6 	LF2A7           
F2A8 	LF2A9           F2B3 	LF2B4           F2BC 	LF2BD           
F2C8 	LF2C9           F31C 	LF318           F323 	LF31F           
F34F 	LF34B           F361 	LF35D           F365 	LF361           
F368 	LF366           F378 	LF376           EAAE 	LIST            
EDEA 	LISTST          EFF8 	LOAD            0004 	LWBYTE          
ECB1 	MBEEP           ECB4 	MBEEP1          E9B4 	MOD1            
F26E 	MODE0           F274 	MODE1           0DF9 	MV24A           
E641 	NDISK           0066 	NMI             F448 	OLDNMI          
07F1 	OUTHL           EA47 	OUTTXT          0000 	P00             
0001 	P01             0002 	P02             0003 	P03             
0004 	P04             0005 	P05             0006 	P06             
0011 	P11             001E 	P1E             008A 	P8A             
008B 	P8B             008C 	P8C             008D 	P8D             
008E 	P8E             008F 	P8F             00E0 	PE0             
00F0 	PF0             EA40 	PIO1TAB         EA45 	PIO2TAB         
E9EC 	PRELL1          EA27 	PRELL2          EACA 	PUNCH           
F43E 	RAFSEC          F43D 	RAFTRK          EE94 	RDERR           
EFB5 	RDERRO          EF54 	RDFOR1          EF61 	RDFOR2          
EF14 	RDFORM          EF10 	RDMERK          EF13 	RDSIZE          
EE56 	RDSKRW          EE86 	RDSKWR          EEBB 	RDTEST          
EEC7 	RDTST1          EEE0 	RDTST2          EEF3 	RDTST3          
EF00 	RDTST4          EE2A 	READ            05CE 	REGIST          
01A5 	RSA             0038 	RST38           F261 	RW              
F268 	RW01            F270 	RW02            F45D 	RWBYTE          
EC9A 	SCR11           ECAC 	SCR12           EC70 	SCROL           
F461 	SECTOR          EE1E 	SECTRN          EDED 	SELDSK          
EE19 	SETDMA          EE14 	SETSEC          EE0F 	SETTRK          
F444 	SPCIN           F446 	SPCOUT          F440 	STZ00           
F441 	STZ01           F442 	STZ02           EA49 	TEXT1           
EA54 	TEXT2           F45F 	TRACK           E799 	TXT01           
E848 	TXT01A          E84D 	TXT01B          E853 	TXT01C          
E859 	TXT02           EEA4 	TXTRDE          EE97 	TXTRDI          
EEA1 	TXTRDO          ECC8 	UPTON           ECC9 	UPTON1          
ECD1 	UPTON2          F307 	WAIRDY          0043 	WAIT            
0000 	WARMBT          E930 	WBOOT           E952 	WBOOT1          
E603 	WBOOTB          EF86 	WRCCP           EF97 	WRCCP1          
EFA0 	WRCCP2          EE2F 	WRITE           FF00 	ZEIPUF          



No Fatal error(s)


