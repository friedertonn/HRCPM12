	MACRO-80 3.44	09-Dec-81	PAGE	1


                                ; ***********************************************************
                                ; *                                                         *
                                ; *  HRCPM12-BIOS fuer den AC1      Version vom 09.08.2023  *
                                ; *                                                         *
                                ; *                                                  V.137  *
                                ; *                                                         *
                                ; ***********************************************************
                                ;
                                ; Korrekturen/Fehlerbehebungen am HRCPM12:
                                ; - alle nicht genutzten Programmteile (HRDOS?) entfernt
                                ; - LOAD(Turbo) entfernt
                                ; - BWS(Farb)Init geaendert
                                ; - ^G BEEP + PUNCH:=V24out + LIST:=V24out zugefuegt
                                ; - keine Pruefsumme, kein Vergleichslesen v. RAM-Disk (entfernt)
                                ; - fehlerhafte Maskierung USER in WBOOT entfernt
                                ; - Kursorblinken im Texteditor
                                ; - Consolenkommandos Kursor-ON / Kursor-OFF
                                ; - RAM-Disk mit 64 REC/TRK, Systemspur 16k -> 8k, dadurch 8k mehr f. Daten
                                ; - GIDE-Laufwerke (C:, D:, E:) auf 8MB, da nicht alle BDOS'se mit mehr
                                ;   als 16 Bit fuer REC-NR. zurechtkommen.
                                ; - Formatierung RAM-Disk: letzter Sektor wurde nicht formatiert
                                ; - falsche I/O-Adresse von Modul1
                                ;
                                ; Neu hinzugekommen:
                                ; - EXIT loescht CCPPUFLEN (V.132)
                                ; - WBOOT loescht CCPPUFLEN, weil in Systemspur "aktiver Befehl" (V.133)
                                ; - Eintragen von NMI auf 066h in BOOT1 entfernt (CPM Page-Zero) (V.133)
                                ; - Tastaturpuffer von FFD0h -> FF00h , "d"-Befehl ueberschrieben (V.134)
                                ; - nicht benutzte "Arbeitszellen" am Ende auskommentiert (V.135)
                                ; - automatische Erkennung der RAM-Disk Groesse 256k/1024k/2048k (V.136)
                                ;
                                        IF1
                                        .PRINTX 'PASS 1'
                                        ENDIF
                                ;
                                        IF2
                                        .PRINTX 'PASS 2'
                                        ENDIF
                                ;
                                        .CREF
                                        .Z80
                                ;
                                        .PHASE 0E600H
                                ;
                                ;
  07F1                          OUTHL   EQU  07F1H
  01A5                          RSA     EQU  01A5H        ;CPU-Register nach RSA - nicht Monitor 11 !
  05CE                          REGIST  EQU  05CEH        ;Registeranzeige - nicht Monitor 11 !
  0DF9                          MV24A   EQU  0DF9H        ;MO-UP V24-Out
                                ;
                                ;
  1800                          CUPOS   EQU  1800H
  1818                          BREAK   EQU  1818H        ;NMI Sprungziel
  181F                          CBWSB   EQU  181FH        ;Merkzelle fuer das Farbbyte im AC1-Monitor 
                                ;                         ;0=kein Color-BWS, sonst der eingestellte Farbwert
  185B                          ARG1    EQU  185BH
  185D                          ARG2    EQU  185DH
                                ;
                                ;
  0000                          WARMBT  EQU  0000H        ;WBOOT der Grundseite
  0005                          BDOSF   EQU  0005H        ;BDOS-Aufruf + TPA-MAX
  0038                          RST38   EQU  0038H        ;CP/M-Break
	MACRO-80 3.44	09-Dec-81	PAGE	1-1


  0066                          NMI     EQU  0066H
                                ;
                                ;
  0003                          IOBYTE  EQU  0003H
  0004                          LWBYTE  EQU  0004H        ;LW (Bit0-3) + USER Nr.(Bit4-7)
                                ;
  FF00                          ZEIPUF  EQU  0FF00H       ;1 + 32 Byte Puffer fuer Tastatur
                                ;                          --> war urspruenlich auf 0FFD0H
                                ;                          --> ueberschreibt den "d"-Befehl
                                ;
  D806                          BDOS    EQU  0D806H       ;BDOS-EinsprungAdresse
  E603                          WBOOTB  EQU  0E603H       ;BIOS-Eisprung WBOOT
                                ;
                                ;
  C000                          HPRDSK  EQU  0C000H       ;Hilfsprogramm: Format RAM-Disk
  D000                          CCP     EQU  0D000H       ;Start CCP
  D007                          COMLEN  EQU  CCP+07       ;CCP-Kommandopuffer-Laenge
                                ;
  00E0                          PE0     EQU  0E0H         ;Grundadresse der RAM-Disk
  00F0                          PF0     EQU  0F0H         ;BWS-CPLD-(Steuer)Port
                                ;
  0040                          CFDC    EQU  40H          ;Hauptstatusregister FDC
  0041                          DFDC    EQU  41H          ;Datenport FDC
  0043                          WAIT    EQU  43H          ;IO-Adr. /WAIT Monoflop
  0045                          LATCH   EQU  45H          ;IO-Adr. Latch 74LS175
                                ;
  000F                          CUZEI   EQU  0FH          ;KursorSymbol
                                ;
                                ;============================================================================
                                ;
  E600    C3 E864                       JP   BOOT
  E603    C3 E928                       JP   WBOOT
  E606    C3 EA4F                       JP   CONST
  E609    C3 EA57                       JP   CONIN
  E60C    C3 EACF                       JP   CONOUT
  E60F    C3 EAA6                       JP   LIST
  E612    C3 EAC2                       JP   PUNCH
  E615    C3 EA57                       JP   CONIN        ;eigentlich JP READER
  E618    C3 EE04                       JP   HOME
  E61B    C3 EDE5                       JP   SELDSK
  E61E    C3 EE07                       JP   SETTRK
  E621    C3 EE0C                       JP   SETSEC
  E624    C3 EE11                       JP   SETDMA
  E627    C3 EE22                       JP   READ
  E62A    C3 EE27                       JP   WRITE
  E62D    C3 EDE2                       JP   LISTST
  E630    C3 EE16                       JP   SECTRN
                                ;
  E633    43 38 35 41                   DEFM 'C85AC'      ;fuer PC/BC Progr.
  E637    43                    
  E638    C3 E9B0                       JP   EXIT         ;User-Kommando EXIT
  E63B    C3 EFE6                       JP   LOAD         ;User-Kommando LOAD
  E63E    C3 0000                       JP   0000H
                                ;
  E641    07                    NDISK:  DEFB 7            ;Anzahl der LW = 7
                                ;
  E642    E644                  DPHX:   DEFW DPHY         ;Zeiger auf den 1. Block?
  E644    E652                  DPHY:   DEFW DPH0         ;DPH von LW A:
  E646    E662                          DEFW DPH1         ;DPH von LW B:
  E648    E672                          DEFW DPH2         ;DPH von LW C:
  E64A    E682                          DEFW DPH3         ;DPH von LW D:
  E64C    E692                          DEFW DPH4         ;DPH von LW E:
	MACRO-80 3.44	09-Dec-81	PAGE	1-2


  E64E    E6A2                          DEFW DPH5         ;DPH von LW F:
  E650    E6B2                          DEFW DPH6         ;DPH von LW G:
                                ;
  E652    0000                  DPH0:   DEFW 0            ;RAM-Disk A:
  E654    0000                          DEFW 0
  E656    0000                          DEFW 0
  E658    0000                          DEFW 0
  E65A    F83F                          DEFW DIRBF
  E65C    E6C4                          DEFW DPB0
  E65E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E660    F8BF                          DEFW ALL00
                                ;
  E662    0000                  DPH1:   DEFW 0            ;Floppy B:
  E664    0000                          DEFW 0
  E666    0000                          DEFW 0
  E668    0000                          DEFW 0
  E66A    F83F                          DEFW DIRBF
  E66C    E6D5                          DEFW DPB1
  E66E    FDCD                          DEFW CHK01
  E670    F93F                          DEFW ALL01
                                ;
  E672    0000                  DPH2:   DEFW 0            ;GIDE C:
  E674    0000                          DEFW 0
  E676    0000                          DEFW 0
  E678    0000                          DEFW 0
  E67A    F83F                          DEFW DIRBF
  E67C    E6F1                          DEFW DPB2
  E67E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E680    F971                          DEFW ALL02
                                ;
  E682    0000                  DPH3:   DEFW 0            ;GIDE D:
  E684    0000                          DEFW 0
  E686    0000                          DEFW 0
  E688    0000                          DEFW 0
  E68A    F83F                          DEFW DIRBF
  E68C    E70D                          DEFW DPB3
  E68E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E690    FB69                          DEFW ALL03
                                ;
  E692    0000                  DPH4:   DEFW 0            ;GIDE E:
  E694    0000                          DEFW 0
  E696    0000                          DEFW 0
  E698    0000                          DEFW 0
  E69A    F83F                          DEFW DIRBF
  E69C    E729                          DEFW DPB4
  E69E    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E6A0    FC69                          DEFW ALL04
                                ;
  E6A2    0000                  DPH5:   DEFW 0            ;Floppy F:
  E6A4    0000                          DEFW 0
  E6A6    0000                          DEFW 0
  E6A8    0000                          DEFW 0
  E6AA    F83F                          DEFW DIRBF
  E6AC    E745                          DEFW DPB5
  E6AE    FDED                          DEFW CHK05
  E6B0    FD69                          DEFW ALL05
                                ;
  E6B2    0000                  DPH6:   DEFW 0            ;Floppy G:
  E6B4    0000                          DEFW 0
  E6B6    0000                          DEFW 0
  E6B8    0000                          DEFW 0
  E6BA    F83F                          DEFW DIRBF
	MACRO-80 3.44	09-Dec-81	PAGE	1-3


  E6BC    E761                          DEFW DPB6
  E6BE    FE0D                          DEFW CHK06
  E6C0    FD9B                          DEFW ALL06
                                ;
                                ; https://hc-ddr.hucki.net/wiki/doku.php/cpm/write_a_bios/teil_1
                                ;
  E6C2    EE4E                          DEFW RDSKRW       ;Routine zum Lesen/Schreiben der RAM-Disk
                                ;
                                ;RAM-Disk 256 KByte
  E6C4    0040                  DPB0:   DEFW 64           ;64 Sectoren/Track (Rec/Trk) = 8 Kbyte/Track
  E6C6    03                            DEFB 3            ;Blockgroesse = 1 Kbyte
  E6C7    07                            DEFB 7
  E6C8    00                            DEFB 0            ;8-Bit Blockadressen im FCB/DIR, da weniger als 255 Bloecke
  E6C9    00F7                          DEFW 247          ;248 * 1 Kbyte-Bloecke  -> 256k-8k(System)=248k(CP/M) ( - 2k(DIR) -> 246k (NETTO f. Daten))
  E6CB    003F                          DEFW 63           ;64 DIR - Eintaege
  E6CD    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E6CF    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E6D1    0001                          DEFW 1            ;8 Kbyte System / Track-Offset
                                ;
  E6D3    F006                          DEFW LF019        ;? Blocking / Deblocking
                                ;
                                ;Floppy 780 KByte
  E6D5    0050                  DPB1:   DEFW 80           ;80 Sectoren/Track
  E6D7    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E6D8    0F                            DEFB 15
  E6D9    00                            DEFB 0
  E6DA    0185                          DEFW 389          ;390 * 2 Kbyte - Bloecke
  E6DC    007F                          DEFW 127          ;128 DIR - Eintraege
  E6DE    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E6E0    0020                          DEFW 32
  E6E2    0002                          DEFW 2            ;20 Kbyte System
                                ;
  E6E4    03 07 05 25                   DEFB 3,7,5,25H
  E6E8    50 00 43 FF                   DEFB 50H,0,43H,0FFH
  E6EC    E1 33 FF                      DEFB 0E1H,33H,0FFH
                                ;
  E6EF    F002                          DEFW LF015        ;? Blocking / Deblocking
                                ;
                                ;GIDE 8 MByte
  E6F1    0800                  DPB2:   DEFW 2048         ;2048 Records/Track = 256k/Trk
  E6F3    05                            DEFB 5
  E6F4    1F                            DEFB 31           ;4k Bloecke
  E6F5    01                            DEFB 1            ;16-Bit Blockadressen im FCB/DIR
  E6F6    07BF                          DEFW 1983         ;1984 * 4k-Bloecke = 7936k
  E6F8    07FF                          DEFW 2047         ;2048 DIR-Eintraege
  E6FA    FFFF                          DEFW 0FFFFH       ;16 DIR-Bloecke = 64 k
  E6FC    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E6FE    0001                          DEFW 1            ;1 Trk = 256k System
                                ;
  E700    02 03 A0                      DEFB 2,3,0A0H     ;?,?, add constant bits fuer Kopf-Register ?
  E703    000A                          DEFW 000AH        ;10 = 1. Zylinder-Nr. phys. LW, wo BDOS-LW beginnt
  E705    0040                          DEFW 0040H        ;64 Zyl. f. 16 MB LW-Groesse
  E707    03D8                          DEFW 03D8H        ;984 Zylinder HDD
  E709    10                            DEFB 10H          ;16 Koepfe HDD
  E70A    20                            DEFB 20H          ;32 Sektoren/Spur HDD
                                ;
  E70B    F002                          DEFW LF015        ;? Blocking / Deblocking
                                ;
                                ;GIDE 8 MByte
  E70D    0800                  DPB3:   DEFW 2048         ;2048 Records/Track = 256k/Trk
  E70F    06                            DEFB 6
  E710    3F                            DEFB 63           ;8k Bloecke
	MACRO-80 3.44	09-Dec-81	PAGE	1-4


  E711    03                            DEFB 3            ;16Bit Blockadressen im FCB/DIR
  E712    03FF                          DEFW 1023         ;1024 * 8k-Bloecke = 8192k = 8M
  E714    0FFF                          DEFW 4095         ;4096 DIR-Eintraege
  E716    FFFF                          DEFW 0FFFFH       ;16 DIR-Bloecke
  E718    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E71A    0000                          DEFW 0            ;kein System-Track
                                ;
  E71C    02 03 A0                      DEFB 2,3,0A0H     ;?,?, add constant bits fuer Kopf-Register ?
  E71F    0096                          DEFW 0096H        ;150 = 1. Zylinder-Nr. phys. LW, wo BDOS-LW beginnt
  E721    0040                          DEFW 0040H        ;64 Zyl. f. 16 MB LW-Groesse
  E723    03D8                          DEFW 03D8H        ;984 Zylinder HDD
  E725    10                            DEFB 10H          ;16 Koepfe HDD
  E726    20                            DEFB 20H          ;32 Sektoren/Spur HDD
                                ;
  E727    F002                          DEFW LF015        ;? Blocking / Deblocking
                                ;
                                ;GIDE 8 MByte
  E729    0800                  DPB4:   DEFW 2048         ;2048 Records/Track = 256k/Trk
  E72B    06                            DEFB 6
  E72C    3F                            DEFB 63           ;8k Bloecke
  E72D    03                            DEFB 3            ;16Bit Blockadressen im FCB/DIR
  E72E    03FF                          DEFW 1023         ;1024 * 8k-Bloecke = 8192k = 8M
  E730    0FFF                          DEFW 4095         ;4096 DIR-Eintraege
  E732    FFFF                          DEFW 0FFFFH       ;16 DIR-Bloecke
  E734    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E736    0000                          DEFW 0            ;kein System-Track
                                ;
  E738    02 03 A0                      DEFB 2,3,0A0H     ;?,?, add constant bits fuer Kopf-Register ?
  E73B    012C                          DEFW 012CH        ;300 = 1. Zylinder-Nr. phys. LW, wo BDOS-LW beginnt
  E73D    0040                          DEFW 0040H        ;64 Zyl. f. 16 MB LW-Groesse
  E73F    03D8                          DEFW 03D8H        ;984 Zylinder HDD
  E741    10                            DEFB 10H          ;16 Koepfe HDD
  E742    20                            DEFB 20H          ;32 Sektoren/Spur HDD
                                ;
  E743    F006                          DEFW LF019        ;? Blocking / Deblocking
                                ;
                                ;Floppy 640 KByte
  E745    0040                  DPB5:   DEFW 64           ;64 Sectoren/Track
  E747    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E748    0F                            DEFB 15
  E749    00                            DEFB 0
  E74A    013F                          DEFW 319          ;320 * 2 Kbyte - Bloecke
  E74C    007F                          DEFW 127          ;128 DIR - Eintraege
  E74E    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E750    0020                          DEFW 32
  E752    0000                          DEFW 0            ;kein System-Track
                                ;
  E754    01 01 10 14                   DEFB 1,1,10H,14H
  E758    50 00 43 FF                   DEFB 50H,0,43H,0FFH
  E75C    E1 33 FF                      DEFB 0E1H,33H,0FFH
                                ;
  E75F    F006                          DEFW LF019        ;? Blocking / Deblocking
                                ;
                                ;Floppy 800 KByte
  E761    0050                  DPB6:   DEFW 80           ;80 Sectoren/Track
  E763    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E764    0F                            DEFB 15
  E765    00                            DEFB 0
  E766    018F                          DEFW 399          ;400 * 2 Kbyte - Bloecke
  E768    007F                          DEFW 127          ;128 DIR - Eintraege
  E76A    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E76C    0020                          DEFW 32
	MACRO-80 3.44	09-Dec-81	PAGE	1-5


  E76E    0000                          DEFW 0            ;kein System-Track
                                ;
  E770    03 07 05 25                   DEFB 3,7,5,25H
  E774    50 01 43 FF                   DEFB 50H,1,43H,0FFH
  E778    E1 33 FF                      DEFB 0E1H,33H,0FFH
                                ;
                                ;RAM-Disk 1024 KByte
  E77B    0040                  DP1024: DEFW 64           ;64 Sectoren/Track (Rec/Trk) = 8 Kbyte/Track
  E77D    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E77E    0F                            DEFB 15
  E77F    00                            DEFB 0            ;16-Bit Blockadressen im FCB/DIR, da mehr als 255 Bloecke
  E780    01FB                          DEFW 507          ;508 * 2 Kbyte-Bloecke  -> 1024k-8k(System)=1016k(CP/M) ( - 4k(DIR) -> 1012k (NETTO f. Daten))
  E782    007F                          DEFW 127          ;128 DIR - Eintraege -> bei 64 DIR-Eintraegen bekommt man die RAM-Disk nicht voll
  E784    00C0                          DEFW 0C0H         ;2 DIR-Bloecke
  E786    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E788    0001                          DEFW 1            ;8 Kbyte System / Track-Offset
                                ;
                                ;RAM-Disk 2048 KByte
  E78A    0040                  DP2048: DEFW 64           ;64 Sectoren/Track (Rec/Trk) = 8 Kbyte/Track
  E78C    04                            DEFB 4            ;Blockgroesse = 2 Kbyte
  E78D    0F                            DEFB 15
  E78E    00                            DEFB 0            ;16-Bit Blockadressen im FCB/DIR, da mehr als 255 Bloecke
  E78F    03FB                          DEFW 1019         ;1020 * 2 Kbyte-Bloecke  -> 2048k-8k(System)=2040k(CP/M) ( - 8k(DIR) -> 2032k (NETTO f. Daten))
  E791    00FF                          DEFW 255          ;256 DIR - Eintraege
  E793    00F0                          DEFW 0F0H         ;4 DIR-Bloecke
  E795    0000                          DEFW 0            ;weil nichtwechselbares Medium
  E797    0001                          DEFW 1            ;8 Kbyte System / Track-Offset
                                ;
  E799    0C                    TXT01:  DEFB 0CH
  E79A    48 52 43 50                   DEFM "HRCPM AC1 V1.2 CPA "
  E79E    4D 20 41 43           
  E7A2    31 20 56 31           
  E7A6    2E 32 20 43           
  E7AA    50 41 20              
  E7AD    31 31 2E 30                   DEFM "11.01.89 FA-MODE "
  E7B1    31 2E 38 39           
  E7B5    20 46 41 2D           
  E7B9    4D 4F 44 45           
  E7BD    20                    
  E7BE    76 6F 6D 20                   DEFM "vom 09.08.2023 V.137"
  E7C2    30 39 2E 30           
  E7C6    38 2E 32 30           
  E7CA    32 33 20 56           
  E7CE    2E 31 33 37           
  E7D2    0D 0A 0D 0A                   DEFB 0DH,0AH,0DH,0AH
  E7D6    47 49 44 45                   DEFM "GIDE(80H) C0:8MB,"
  E7DA    28 38 30 48           
  E7DE    29 20 43 30           
  E7E2    3A 38 4D 42           
  E7E6    2C                    
  E7E7    20 20 20 44                   DEFM "   D0: 8MB   E0: 8MB"
  E7EB    30 3A 20 38           
  E7EF    4D 42 20 20           
  E7F3    20 45 30 3A           
  E7F7    20 38 4D 42           
  E7FB    0D 0A                         DEFB 0DH,0AH
  E7FD    46 44 43 20                   DEFM "FDC (45H) B0:5*1024"   ;B0 --> Floppy-Drive 0,
  E801    28 34 35 48           
  E805    29 20 42 30           
  E809    3A 35 2A 31           
  E80D    30 32 34              
  E810    20 46 30 3A                   DEFM " F0:16*256 G1:5*1024"  ;F0 --> Floppy-Drive 0, G1 --> Floppy-Drive 1
	MACRO-80 3.44	09-Dec-81	PAGE	1-6


  E814    31 36 2A 32           
  E818    35 36 20 47           
  E81C    31 3A 35 2A           
  E820    31 30 32 34           
  E824    0D 0A 0D 0A                   DEFB 0DH,0AH,0DH,0AH
  E828    52 46 4C 20                   DEFM "RFL Praeci.Port E0H"
  E82C    50 72 61 65           
  E830    63 69 2E 50           
  E834    6F 72 74 20           
  E838    45 30 48              
  E83B    20 41 3A 20                   DEFM " A: "
  E83F    00                            DEFB 0
  E840    32 35 36 6B           TXT01A: DEFM "256k"
  E844    00                            DEFB 0
  E845    31 30 32 34           TXT01B: DEFM "1024k"
  E849    6B                    
  E84A    00                            DEFB 0
  E84B    32 30 34 38           TXT01C: DEFM "2048k"
  E84F    6B                    
  E850    00                            DEFB 0
  E851    20 2D 2D 3E           TXT02:  DEFM " --> Format A:(J)?"
  E855    20 46 6F 72           
  E859    6D 61 74 20           
  E85D    41 3A 28 4A           
  E861    29 3F                 
  E863    00                            DEFB 0
                                ;
                                ;******************************   BOOT   *******************************
                                ;
  E864    F3                    BOOT:   DI
  E865    31 F3F7                       LD   SP,CPMSTK
  E868    AF                            XOR  A
  E869    D3 1E                         OUT  (P1E),A      ;zwingend AC1-Mode !!
  E86B    32 F41A                       LD   (LATPU),A    ;FDC-Latch zuruecksetzen
  E86E    CD EDAC                       CALL BWSINI
  E871    DB 05                         IN   A,(P05)
  E873    CB 9F                         RES  3,A          ;BildInvers (PIO1B) Bit3 aus
  E875    D3 05                         OUT  (P05),A
  E877    2A 1818                       LD   HL,(BREAK)   ;Sprungtabelle NMI MONITOR
  E87A    22 F406                       LD   (OLDNMI),HL  ;sichern
  E87D    21 E603                       LD   HL,WBOOTB    ;CP/M-Warmstart-Einsprungadresse
  E880    22 1818                       LD   (BREAK),HL
  E883    CD E9A5                       CALL CPMMOD
  E886    AF                            XOR  A
  E887    32 F43A                       LD   (DF51A),A
  E88A    32 0003                       LD   (IOBYTE),A
  E88D    32 0004                       LD   (LWBYTE),A
  E890    32 FF00                       LD   (ZEIPUF),A
  E893    CD E981                       CALL BOOT1        ;CP/M "Grundseite" INIT
                                ;
  E896    3E 03                         LD   A,03H        ;CTC init. + Interrupt abgeschaltet
  E898    D3 00                         OUT  (P00),A
  E89A    D3 01                         OUT  (P01),A
  E89C    D3 02                         OUT  (P02),A
  E89E    D3 03                         OUT  (P03),A
  E8A0    3E FF                         LD   A,0FFH       ;HWT vom Interruptvektor 0FF80h ff.
  E8A2    ED 47                         LD   I,A
  E8A4    ED 5E                         IM   2            ;Interrupt freigeben
  E8A6    21 F2F2                       LD   HL,INTEND    ;Adresse Einsprungpunkt fuer nicht verwendete Interrupts
  E8A9    22 FF80                       LD   (DFF80),HL   ;Prog. Einsprung IV fuer CTC-Kanal 0
  E8AC    22 FF82                       LD   (DFF82),HL   ;Prog. Einsprung IV fuer CTC-Kanal 1
  E8AF    22 FF84                       LD   (DFF84),HL   ;Prog. Einsprung IV fuer CTC-Kanal 2
	MACRO-80 3.44	09-Dec-81	PAGE	1-7


  E8B2    21 F2D7                       LD   HL,ISRCTC    ;Einsprungpunkt CTC-Interrupt - Steuerung Nachlauf Floppy-LW
  E8B5    22 FF86                       LD   (DFF86),HL   ;Prog. Einsprung IV fuer CTC-Kanal 3
  E8B8    3E 80                         LD   A,80H
  E8BA    D3 00                         OUT  (P00),A      ;CTC-Interruptadresse NWT (= 80h) eintragen
  E8BC    3E FF                         LD   A,0FFH
  E8BE    32 F419                       LD   (CTCCNT),A   ;Init. CTC-Counter = 255 --> Zusatzzaehler fuer CTC-Interrupt
  E8C1    3E A7                         LD   A,0A7H
  E8C3    D3 03                         OUT  (P03),A      ;Programmierung der CTC K3 als Zeitgeber mit Interrupt, Vorteiler 256
  E8C5    AF                            XOR  A
  E8C6    D3 03                         OUT  (P03),A      ;Programmierung der CTC K3 - Hauptteiler = 256
                                                          ;d.h. bei 2 MHz CPU-Takt wird alle 33ms ein CTC-Interrupt ausgeloest
                                ;
  E8C8    21 E9D7                       LD   HL,ISRTAS    ;1. Einsprungpunkt PIO-Interrupt --> Taste in Tastaturpuffer schreiben
  E8CB    22 FF88                       LD   (DFF88),HL   ;auf 0FF88h eintragen
  E8CE    21 EA2A                       LD   HL,ISRPA     ;2. Einsprungpunkt PIO-Interrupt --> weitere PIO_1A-Interrupts "ignorieren"
  E8D1    22 FF8A                       LD   (DFF8A),HL   ;auf 0FF8Ah eintragen
  E8D4    01 0506                       LD   BC,0506H     ;5 Bytes auf Controlkanal PIO1 A
  E8D7    21 EA38                       LD   HL,PIO1TAB
  E8DA    ED B3                         OTIR              ;PIO1_A Init. fuer 1. Einsprungpunkt
                                ;
  E8DC    21 E799                       LD   HL,TXT01     ;Begruessungstext
  E8DF    CD EA3F                       CALL OUTTXT
                                ;
  E8E2    CD EEA9                       CALL RDTEST       ;Kapazitaet der RAM-Disk bestimmen
  E8E5    21 EF01                       LD   HL,RDSIZE    ;RD-Size: 0=256K 1=1024K 2=2048K
  E8E8    7E                            LD   A,(HL)
  E8E9    21 E78A                       LD   HL,DP2048    ;DPB 2048K RAM-Disk
  E8EC    FE 02                         CP   2
  E8EE    28 09                         JR   Z,BOOT2
  E8F0    21 E77B                       LD   HL,DP1024    ;DPB 1024K RAM-Disk
  E8F3    FE 01                         CP   1
  E8F5    28 02                         JR   Z,BOOT2
  E8F7    18 08                         JR   BOOT3        ;256K RAM-Disk, nichts kopieren
                                ;        
  E8F9    11 E6C4               BOOT2:  LD   DE,DPB0
  E8FC    01 000F                       LD   BC,15
  E8FF    ED B0                         LDIR
  E901    21 E840               BOOT3:  LD   HL,TXT01A    ;256k
  E904    FE 00                         CP   0
  E906    28 0A                         JR   Z,BOOT4
  E908    21 E845                       LD   HL,TXT01B    ;1024k
  E90B    FE 01                         CP   1
  E90D    28 03                         JR   Z,BOOT4
  E90F    21 E84B                       LD   HL,TXT01C    ;2048k
  E912    CD EA3F               BOOT4:  CALL OUTTXT
  E915    21 E851                       LD   HL,TXT02     ;Formatieren? (J)
  E918    CD EA3F                       CALL OUTTXT
  E91B    FB                            EI
  E91C    CD EA57                       CALL CONIN
  E91F    CB AF                         RES  5,A          ;Grossbuchstaben
  E921    FE 4A                         CP   4AH          ;J --> RAM-Disk formatieren
  E923    CC EF02                       CALL Z,RDFORM
  E926    18 22                         JR   WBOOT1
                                ;
                                ;*******************************   WBOOT   *****************************
                                ;
  E928    31 F3F7               WBOOT:  LD   SP,CPMSTK
  E92B    CD E9A5                       CALL CPMMOD
  E92E    3A F43B                       LD   A,(DF51B)
  E931    B7                            OR   A
  E932    C4 F0BB                       CALL NZ,LF0CE
  E935    06 2C                         LD   B,2CH        ;44 Records CCP+BDOS
	MACRO-80 3.44	09-Dec-81	PAGE	1-8


  E937    21 EE22                       LD   HL,READ
  E93A    22 EF8E                       LD   (WRCCP2),HL
  E93D    CD EF74                       CALL WRCCP        ;wirklich READCCP !
  E940    21 EE27                       LD   HL,WRITE
  E943    22 EF8E                       LD   (WRCCP2),HL
  E946    AF                            XOR  A
  E947    32 D007                       LD   (COMLEN),A   ;auf Laenge=0 setzen
                                ;
  E94A    CD E981               WBOOT1: CALL BOOT1        ;CP/M "Grundseite" INIT
  E94D    3E 01                         LD   A,01H        ;Kursor einschalten
  E94F    32 F3FD                       LD   (CUFLAG),A
  E952    3A F3FA                       LD   A,(COLO2)
  E955    32 F3F8                       LD   (COLOR),A    ;Arbeitszelle Farbbyte
  E958    E6 77                         AND  77H          ;Intensivdarstellung maskieren
  E95A    32 F3F9                       LD   (COLO1),A    ;Arbeitszelle "Normaldarstellung"
  E95D    3A 0004                       LD   A,(LWBYTE)
  E960    4F                            LD   C,A
  E961    CD EDE5                       CALL SELDSK
  E964    C3 D000                       JP   CCP          ;JP CCP
                                ;
                                ;
  E967    F5                    CPMERR: PUSH AF           ;CP/M-Fehler - zurueck z. MONITOR
  E968    E5                            PUSH HL
  E969    CD E9B4                       CALL EXIT1
  E96C    DF                            RST  18H
  E96D    20 43 50                      DEFM " CP"
  E970    CD                            DEFB 4DH+80H      ;"M+80H
  E971    E1                            POP  HL
  E972    F1                            POP  AF
  E973    CD 01A5                       CALL RSA
  E976    E1                            POP  HL
  E977    2B                            DEC  HL
  E978    CD 07F1                       CALL OUTHL
  E97B    DF                            RST  18H
  E97C    8D                            DEFB 0DH+80H
  E97D    CD 05CE                       CALL REGIST       ;MONI - Registeranzeige - nicht Monitor 11 !
  E980    FF                            RST  38H          ;zurueck zum MONI
                                ;
                                ;
  E981    3E C3                 BOOT1:  LD   A,0C3H       ;CP/M "Grundseite" INIT
  E983    32 0000                       LD   (WARMBT),A
  E986    32 0005                       LD   (BDOSF),A
  E989    32 0038                       LD   (RST38),A
  E98C    21 E603                       LD   HL,WBOOTB
  E98F    22 0001                       LD   (WARMBT+1),HL
  E992    21 D806                       LD   HL,BDOS
  E995    22 0006                       LD   (BDOSF+1),HL
  E998    21 E967                       LD   HL,CPMERR
  E99B    22 0039                       LD   (RST38+1),HL
  E99E    21 0080                       LD   HL,0080H
  E9A1    22 F421                       LD   (DMA),HL
  E9A4    C9                            RET
                                ;
                                ;+++++++++++++++++++++++++++++++++   Ende BOOT / WBOOT   +++++++++++++++++
                                ;
  E9A5    F5                    CPMMOD: PUSH AF           ;CP/M EIN
  E9A6    3E 01                         LD   A,01H
  E9A8    18 02                         JR   MOD1
                                ;
  E9AA    F5                    AC1MOD: PUSH AF           ;CP/M AUS (AC1-Mode)
  E9AB    AF                            XOR  A
  E9AC    D3 1E                 MOD1:   OUT  (P1E),A
	MACRO-80 3.44	09-Dec-81	PAGE	1-9


  E9AE    F1                            POP  AF
  E9AF    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
                                ;EXIT - Routine
                                ;
  E9B0    21 0000               EXIT:   LD   HL,0000H     ;Ruecksprungadresse fuer RET
  E9B3    E5                            PUSH HL
  E9B4    AF                    EXIT1:  XOR  A
  E9B5    32 D007                       LD   (COMLEN),A   ;auf Laenge=0 setzen
  E9B8    D3 1E                         OUT  (P1E),A      ;AC1-Mode
  E9BA    D3 14                         OUT  (P14),A      ;Modul_1 - ggf. EPROMs ausblenden
  E9BC    2A F406                       LD   HL,(OLDNMI)
  E9BF    22 1818                       LD   (BREAK),HL   ;alten NMI wiederherstellen
  E9C2    3E 03                         LD   A,03H
  E9C4    D3 00                         OUT  (P00),A      ;CTC: Interrupts ausschalten
  E9C6    D3 01                         OUT  (P01),A
  E9C8    D3 02                         OUT  (P02),A
  E9CA    D3 03                         OUT  (P03),A
  E9CC    D3 06                         OUT  (P06),A      ;PIO1 A: Interrupt auschalten
  E9CE    3E CF                         LD   A,0CFH
  E9D0    D3 06                         OUT  (P06),A      ;PIO1 A: "Mode 3" + "Set Mode"
  E9D2    3E FF                         LD   A,0FFH
  E9D4    D3 06                         OUT  (P06),A      ;PIO1 A: PA0 bis PA7 sind Eingaenge
  E9D6    C9                            RET               ;zurueck zum MONITOR, normal
                                ;
                                ;
                                ;Interrupt-Einsprung fuer die Tastatur
                                ;
  E9D7    F3                    ISRTAS: DI
  E9D8    F5                            PUSH AF
  E9D9    C5                            PUSH BC
  E9DA    E5                            PUSH HL
  E9DB    DB 04                         IN   A,(P04)      ;PIO_A abfragen
  E9DD    CB 7F                         BIT  7,A          ;Taste gedrueckt?
  E9DF    28 43                         JR   Z,ISREND     ;nein, ISR beenden
  E9E1    4F                            LD   C,A
                                ;
  E9E2    06 1E                         LD   B,1EH        ;Tastaturentprellung
  E9E4    DB 04                 PRELL1: IN   A,(P04)
  E9E6    B9                            CP   C
  E9E7    20 3B                         JR   NZ,ISREND
  E9E9    10 F9                         DJNZ PRELL1       ;30 Durchlaeufe
                                ;
  E9EB    FE 80                         CP   80H
  E9ED    28 35                         JR   Z,ISREND     ;das war eine NULL-Eingabe
  E9EF    21 EA3D                       LD   HL,PIO2TAB
  E9F2    01 0206                       LD   BC,0206H     ;PIO_A-Control, 2 Bytes
  E9F5    ED B3                         OTIR              ;weitere Interrupts "ignorieren"
                                ;
  E9F7    4F                            LD   C,A
  E9F8    21 FF00                       LD   HL,ZEIPUF
  E9FB    7E                            LD   A,(HL)       ;Fuellstand Zeichenpuffer
  E9FC    3C                            INC  A
  E9FD    FE 1F                         CP   1FH          ;Puffer voll?
  E9FF    28 23                         JR   Z,ISREND
  EA01    77                            LD   (HL),A       ;Anzahl der Zeichen im Puffer
  EA02    C5                            PUSH BC
  EA03    4F                            LD   C,A
  EA04    09                            ADD  HL,BC        ;HL = Position im Zeichenpuffer
  EA05    C1                            POP  BC
	MACRO-80 3.44	09-Dec-81	PAGE	1-10


  EA06    CB B9                         RES  7,C          ;7. Bit loeschen und
  EA08    71                            LD   (HL),C       ;Taste in Zeichenpuffer eintragen
                                ;
                                ;       LD   BC,8034H     ;Initialisierung Tastenpiep --> 2 MHz
  EA09    01 8068                       LD   BC,8068H     ;Initialisierung Tastenpiep --> 4 MHz
  EA0C    79                    BEEP1:  LD   A,C
  EA0D    3D                    BEEP2:  DEC  A
  EA0E    20 FD                         JR   NZ,BEEP2
  EA10    DB 05                         IN   A,(P05)      ;PIO_B-Daten
  EA12    EE 01                         XOR  01H          ;Tastenpiep
  EA14    D3 05                         OUT  (P05),A
  EA16    10 F4                         DJNZ BEEP1
  EA18    E6 FE                         AND  0FEH
  EA1A    D3 05                         OUT  (P05),A
                                ;
  EA1C    01 0200                       LD   BC,0200H     ;Warteschleife - Entprellung
  EA1F    0B                    PRELL2: DEC  BC
  EA20    78                            LD   A,B
  EA21    B1                            OR   C
  EA22    20 FB                         JR   NZ,PRELL2
                                ;
  EA24    E1                    ISREND: POP  HL
  EA25    C1                            POP  BC
  EA26    F1                            POP  AF
  EA27    FB                            EI
  EA28    ED 4D                         RETI
                                ;
                                ;
                                ;2. Interrupt-Einsprung fuer PIO1 Kanal A - Neuinitialisierung der PIO
                                ;
  EA2A    F3                    ISRPA:  DI
  EA2B    F5                            PUSH AF
  EA2C    C5                            PUSH BC
  EA2D    E5                            PUSH HL
  EA2E    21 EA38                       LD   HL,PIO1TAB
  EA31    01 0506                       LD   BC,0506H     ;5 Bytes f. PIO_A-Control
  EA34    ED B3                         OTIR
  EA36    18 EC                         JR   ISREND
                                ;
  EA38    88 CF FF B7           PIO1TAB: DEFB 88H,0CFH,0FFH,0B7H,7FH  ;PIO 1A: Init.-Tabelle
  EA3C    7F                    
                                ;  88H --> NWT Interruptvektor --> 0FF88H
                                ; 0CFH --> "Mode 3" + "Set Mode" (kein Handshaking, next Byte = I/O-Zuordnung)
                                ; 0FFH --> PA0 bis PA7 sind Eingaenge
                                ; 0B7H --> Setting Interrupt Control Word --> mit nachfolgender Maskierung
                                ;  7FH --> Bit7=Low --> nur PA7 erzeugt Interrupts
                                ;
  EA3D    8A 87                 PIO2TAB: DEFB 8AH,87H     ;PIO 1A: "Ignorieren" weiterer Interrupts
                                ;  8AH --> "Verbiegen" NWT Interruptvektor --> 0FF8A
                                ;  87H --> Setting Interrupt Control Word --> ohne nachfolgende Maskierung
                                ;
                                ;
  EA3F    C5                    OUTTXT: PUSH BC
  EA40    F5                            PUSH AF
  EA41    4E                    TEXT1:  LD   C,(HL)
  EA42    79                            LD   A,C
  EA43    B7                            OR   A
  EA44    28 06                         JR   Z,TEXT2
  EA46    CD EACF                       CALL CONOUT
  EA49    23                            INC  HL
  EA4A    18 F5                         JR   TEXT1
  EA4C    F1                    TEXT2:  POP  AF
	MACRO-80 3.44	09-Dec-81	PAGE	1-11


  EA4D    C1                            POP  BC
  EA4E    C9                            RET
                                ;
                                ;************************   CONST   *************************
                                ;
  EA4F    3A FF00               CONST:  LD   A,(ZEIPUF)
  EA52    B7                            OR   A
  EA53    C8                            RET  Z
  EA54    3E FF                         LD   A,0FFH
  EA56    C9                            RET
                                ;
                                ;***************************   CONIN   ***********************
                                ;
  EA57    F3                    CONIN:  DI
  EA58    ED 73 F402                    LD   (SPCIN),SP
  EA5C    31 F3A8                       LD   SP,CINSP
  EA5F    C5                            PUSH BC
  EA60    D5                            PUSH DE
  EA61    E5                            PUSH HL
  EA62    01 017F                       LD   BC,017FH     ;Kursor-Blinker ruecksetzen
  EA65    AF                    CONIN1: XOR  A
  EA66    F3                            DI
  EA67    2A FF00                       LD   HL,(ZEIPUF)  ;L = Anz. der Zeichen, H = 1. Zeichen
  EA6A    B5                            OR   L
  EA6B    20 20                         JR   NZ,CONIN4    ;Zeichen im Tastaturpuffer vorhanden
  EA6D    FB                            EI
  EA6E    10 F5                         DJNZ CONIN1       ;256*LOOP: warte auf ein Zeichen
  EA70    3A F3FD                       LD   A,(CUFLAG)
  EA73    B7                            OR   A
  EA74    28 EF                         JR   Z,CONIN1     ;kein "Kursor-Blinken"
  EA76    F3                            DI
  EA77    CD E9AA                       CALL AC1MOD       ;AC1 Mode
  EA7A    2A 1800                       LD   HL,(CUPOS)
  EA7D    0C                            INC  C
  EA7E    CB 79                         BIT  7,C          ;hier wird die Cursor-Blinkfrequenz festgelegt
  EA80    3A F401                       LD   A,(CHAR)     ;bisheriges Zeichen auf der Kursorposition
  EA83    28 02                         JR   Z,CONIN3
  EA85    3E 0F                         LD   A,CUZEI      ;Kursor = 0FH
  EA87    77                    CONIN3: LD   (HL),A       ;"Kursor-Blinken" - Bildschirm-Ausgabe
  EA88    CD E9A5                       CALL CPMMOD       ;CP/M Mode
  EA8B    18 D8                         JR   CONIN1
                                ;
  EA8D    3D                    CONIN4: DEC  A            ;DEC Anzahl_der_Zeichen_im_Tastaturpuffer
  EA8E    32 FF00                       LD   (ZEIPUF),A
  EA91    7C                            LD   A,H          ;1. Zeichen aus dem Tastaturpuffer --> A
  EA92    21 FF02                       LD   HL,ZEIPUF+2
  EA95    11 FF01                       LD   DE,ZEIPUF+1
  EA98    01 001F                       LD   BC,001FH
  EA9B    ED B0                         LDIR              ;alle Zeichen im Puffer rC<cken 1 Pos. n. links
  EA9D    E1                            POP  HL
  EA9E    D1                            POP  DE
  EA9F    C1                            POP  BC
  EAA0    ED 7B F402                    LD   SP,(SPCIN)
  EAA4    FB                            EI
  EAA5    C9                            RET
                                ;
                                ;***************************   LIST   ************************
                                ;
  EAA6    F3                    LIST:   DI
  EAA7    CD E9AA                       CALL AC1MOD
  EAAA    F5                            PUSH AF      
  EAAB    79                            LD   A,C
	MACRO-80 3.44	09-Dec-81	PAGE	1-12


  EAAC    FE 0A                         CP   0AH  
  EAAE    28 0C                         JR   Z,LEND1  
  EAB0    CD 0DF9                       CALL MV24A        ;MONI V24 Ausgabe Akku
  EAB3    FE 0D                         CP   0DH     
  EAB5    20 05                         JR   NZ,LEND1 
  EAB7    3E 0A                         LD   A,0AH   
  EAB9    CD 0DF9                       CALL MV24A        ;MONI V24 Ausgabe Akku
  EABC    F1                    LEND1:  POP  AF      
  EABD    CD E9A5                       CALL CPMMOD
  EAC0    FB                            EI
  EAC1    C9                            RET
                                ;
                                ;***************************   PUNCH   ***********************
                                ;
  EAC2    F3                    PUNCH:  DI                ;Ausgabe C nach V24
  EAC3    79                            LD   A,C
  EAC4    CD E9AA                       CALL AC1MOD
  EAC7    CD 0DF9                       CALL MV24A        ;MONI V24 Ausgabe Akku
  EACA    CD E9A5                       CALL CPMMOD
  EACD    FB                            EI
  EACE    C9                            RET
                                ;
                                ;******************************* CONOUT  *********************
                                ;
                                ;       Ausgabe eines Zeichens,   IN: Zeichen in C
                                ;
  EACF    F3                    CONOUT: DI
  EAD0    ED 73 F404                    LD   (SPCOUT),SP  ;Stack bei MON-Aufruf retten
  EAD4    31 F3CE                       LD   SP,COUTSP
  EAD7    F5                            PUSH AF
  EAD8    C5                            PUSH BC
  EAD9    D5                            PUSH DE
  EADA    E5                            PUSH HL
  EADB    CD E9AA                       CALL AC1MOD
  EADE    E5                            PUSH HL
  EADF    2A 1800                       LD   HL,(CUPOS)   ;Cursorposition
  EAE2    3A F401                       LD   A,(CHAR)
  EAE5    77                            LD   (HL),A       ;altes Zeichen auf Position
  EAE6    3A F3FE                       LD   A,(STZ00)    ;Durchlauf bei Steuerzeichen?
  EAE9    A7                            AND  A
  EAEA    C2 ED1A                       JP   NZ,KONV10    ;NZ= Steuerzeichen 2. oder 3. Durchlauf
  EAED    79                            LD   A,C          ;Byte
  EAEE    FE 20                         CP   20H          ;kleinstes Zeichen
  EAF0    38 26                         JR   C,KONVTB
  EAF2    FE 7F                         CP   7FH          ;groesstes Zeichen
  EAF4    30 22                         JR   NC,KONVTB
  EAF6    2A 1800                       LD   HL,(CUPOS)
  EAF9    C3 EC57                       JP   CCHAR        ;Ausgabe einzelnes Zeichen
                                ;
  EAFC    2A 1800               KONVT9: LD   HL,(CUPOS)
  EAFF    7E                            LD   A,(HL)
  EB00    32 F401                       LD   (CHAR),A
  EB03    3A F3FD                       LD   A,(CUFLAG)
  EB06    B7                            OR   A
  EB07    28 02                         JR   Z,COEN1      ;Kursor nicht darstellen
  EB09    36 0F                         LD   (HL),CUZEI
  EB0B    CD E9A5               COEN1:  CALL CPMMOD
  EB0E    E1                            POP  HL
  EB0F    D1                            POP  DE
  EB10    C1                            POP  BC
  EB11    F1                            POP  AF
  EB12    ED 7B F404                    LD   SP,(SPCOUT)
	MACRO-80 3.44	09-Dec-81	PAGE	1-13


  EB16    FB                            EI
  EB17    C9                            RET
                                ;
                                ;Verzweigung bei Steuerzeichen
                                ;INPUT:  A=Zeichen
                                ;
  EB18    FE 1B                 KONVTB: CP   1BH          ;ESC ?
  EB1A    20 07                         JR   NZ,KONVT1
  EB1C    3E 02                         LD   A,02H        ;wenn ja
  EB1E    32 F3FE                       LD   (STZ00),A    ;Zeiger auf 2
  EB21    18 D9                         JR   KONVT9       ;nichts ausgeben
                                ;
  EB23    2A 1800               KONVT1: LD   HL,(CUPOS)
  EB26    FE 01                         CP   01H          ;^A Cursor home                      
  EB28    28 5B                         JR   Z,CHOME                                             
  EB2A    FE 07                         CP   07H          ;^G akustisches Signal                                                 
  EB2C    CA ECA9                       JP   Z,MBEEP                                              
  EB2F    FE 08                         CP   08H          ;^H Cursor links                     
  EB31    CA EBAD                       JP   Z,CLEFT                                             
  EB34    FE 0A                         CP   0AH          ;^J Zeilenvorschub                   
  EB36    CA EBB1                       JP   Z,CLF                                               
  EB39    FE 0C                         CP   0CH          ;^L CLS                              
  EB3B    28 51                         JR   Z,BCLS                                              
  EB3D    FE 0D                         CP   0DH          ;^M Wagenruecklauf                   
  EB3F    CA EBC9                       JP   Z,CCRET                                             
  EB42    FE 14                         CP   14H          ;^T BS ab Cursor loeschen            
  EB44    CA EBD0                       JP   Z,CBLOE                                             
  EB47    FE 15                         CP   15H          ;^U Cursor nach rechts               
  EB49    CA EBF3                       JP   Z,CRIGH                                             
  EB4C    FE 16                         CP   16H          ;^V Zeile ab Cursor loeschen         
  EB4E    CA EBF7                       JP   Z,CZLOE                                             
  EB51    FE 18                         CP   18H          ;^X Zeile ab Cursor loeschen + CR    
  EB53    CA EC1E                       JP   Z,CZLCR                                             
  EB56    FE 1A                         CP   1AH          ;^Z Cursor hoch                      
  EB58    CA EC47                       JP   Z,CHOCH                                             
  EB5B    FE 82                         CP   82H          ;Kursor ein
  EB5D    CA ED0B                       JP   Z,CUON
  EB60    FE 83                         CP   83H          ;Kursor aus
  EB62    CA ED13                       JP   Z,CUOFF
                                ;
  EB65    47                            LD   B,A          ;Zeichen merken                      
  EB66    3A F3F8                       LD   A,(COLOR)                                         
  EB69    A7                            AND  A            ;Test auf Color-BWS                  
  EB6A    CA EAFC                       JP   Z,KONVT9     ;Z = monochrom  
  EB6D    78                            LD   A,B                                                 
                                ;
  EB6E    FE 84                         CP   84H          ;normale Darstellung
  EB70    CA ECD0                       JP   Z,BNORM
  EB73    FE 85                         CP   85H          ;invers
  EB75    CA ECDE                       JP   Z,BINVN
  EB78    FE 86                         CP   86H          ;intensiv - HihgLight
  EB7A    CA ECED                       JP   Z,BINTE
  EB7D    FE 87                         CP   87H          ;intensiv + invers
  EB7F    CA ECFA                       JP   Z,BIVIN
  EB82    C3 EAFC                       JP   KONVT9
                                ;
  EB85    21 17FF               CHOME:  LD   HL,17FFH
  EB88    22 1800                       LD   (CUPOS),HL
  EB8B    C3 EAFC                       JP   KONVT9
                                ;
  EB8E    3E 20                 BCLS:   LD   A,20H        ;0Ch  Bildschirm loeschen
  EB90    CD EBBA                       CALL BCL1         ;Loeschroutine
	MACRO-80 3.44	09-Dec-81	PAGE	1-14


  EB93    22 1800                       LD   (CUPOS),HL   ;Cursorposition
  EB96    3A F3F8                       LD   A,(COLOR)    ;Farbbyte
  EB99    E6 77                         AND  77H          ;Farb-BWS vorhanden?
  EB9B    CA EAFC                       JP   Z,KONVT9     ;Z = nein, dann Ende
  EB9E    CD ED9D                       CALL BWSCOL       ;Farbspeicher ein
  EBA1    3A F3F8                       LD   A,(COLOR)
  EBA4    CD EBBA                       CALL BCL1
  EBA7    CD EDA3                       CALL BWSZEI       ;Farbspeicher aus
  EBAA    C3 EAFC                       JP   KONVT9
                                ;
  EBAD    23                    CLEFT:  INC  HL           ;08h  Cursor links
  EBAE    C3 EC4B                       JP   CHOLI
                                ;
  EBB1    11 0040               CLF:    LD   DE,0040H     ;0Ah  Zeilenvorschub
  EBB4    A7                            AND  A
  EBB5    ED 52                         SBC  HL,DE
  EBB7    C3 EC68                       JP   SCROL
                                ;
  EBBA    21 1000               BCL1:   LD   HL,1000H     ;Anfang BWS
  EBBD    77                            LD   (HL),A
  EBBE    54                            LD   D,H
  EBBF    5D                            LD   E,L
  EBC0    1C                            INC  E
  EBC1    C5                            PUSH BC
  EBC2    01 07FF                       LD   BC,07FFH     ;Laenge BWS
  EBC5    ED B0                         LDIR
  EBC7    C1                            POP  BC
  EBC8    C9                            RET
                                ;
  EBC9    7D                    CCRET:  LD   A,L          ;0Dh  Wagenruecklauf
  EBCA    F6 3F                         OR   3FH
  EBCC    6F                            LD   L,A
  EBCD    C3 EC68                       JP   SCROL
                                ;
  EBD0    E5                    CBLOE:  PUSH HL
  EBD1    3E 0F                         LD   A,CUZEI      ;14h  BS ab Cursor loeschen
  EBD3    36 20                 CBLO1:  LD   (HL),20H
  EBD5    2B                            DEC  HL
  EBD6    BC                            CP   H
  EBD7    20 FA                         JR   NZ,CBLO1
  EBD9    E1                            POP  HL
  EBDA    3A F3F8                       LD   A,(COLOR)
  EBDD    47                            LD   B,A
  EBDE    E6 77                         AND  77H
  EBE0    CA EAFC                       JP   Z,KONVT9
  EBE3    CD ED9D                       CALL BWSCOL       ;Farbspeicher ein
  EBE6    3E 0F                         LD   A,CUZEI
  EBE8    70                    CBLO2:  LD   (HL),B
  EBE9    2B                            DEC  HL
  EBEA    BC                            CP   H
  EBEB    20 FB                         JR   NZ,CBLO2
  EBED    CD EDA3                       CALL BWSZEI       ;Farbspeicher aus
  EBF0    C3 EAFC                       JP   KONVT9
                                ;
  EBF3    2B                    CRIGH:  DEC  HL           ;15h  Cursor nach rechts
  EBF4    C3 EC68                       JP   SCROL
                                ;
  EBF7    E5                    CZLOE:  PUSH HL           ;16h  Zeile ab Cursor loeschen
  EBF8    7D                            LD   A,L
  EBF9    E6 3F                         AND  3FH
  EBFB    47                            LD   B,A
  EBFC    04                            INC  B
	MACRO-80 3.44	09-Dec-81	PAGE	1-15


  EBFD    36 20                 CZLO1:  LD   (HL),20H
  EBFF    2B                            DEC  HL
  EC00    10 FB                         DJNZ CZLO1
  EC02    E1                            POP  HL
  EC03    3A F3F8                       LD   A,(COLOR)
  EC06    4F                            LD   C,A
  EC07    E6 77                         AND  77H
  EC09    CA EAFC                       JP   Z,KONVT9
  EC0C    CD ED9D                       CALL BWSCOL       ;Farbspeicher ein
  EC0F    7D                            LD   A,L
  EC10    E6 3F                         AND  3FH
  EC12    47                            LD   B,A
  EC13    04                            INC  B
  EC14    71                    CZLO2:  LD   (HL),C
  EC15    2B                            DEC  HL
  EC16    10 FC                         DJNZ CZLO2
  EC18    CD EDA3                       CALL BWSZEI       ;Farbspeicher aus
  EC1B    C3 EAFC                       JP   KONVT9
                                ;
  EC1E    E5                    CZLCR:  PUSH HL           ;18h  Zeile ab Cursor loeschen + CR
  EC1F    7D                            LD   A,L
  EC20    F6 3F                         OR   3FH
  EC22    6F                            LD   L,A
  EC23    22 1800                       LD   (CUPOS),HL
  EC26    E5                            PUSH HL
  EC27    06 40                         LD   B,40H        ;Zeilenlaenge
  EC29    36 20                 CZLC1:  LD   (HL),20H
  EC2B    2B                            DEC  HL
  EC2C    10 FB                         DJNZ CZLC1
  EC2E    E1                            POP  HL
  EC2F    3A F3F8                       LD   A,(COLOR)
  EC32    4F                            LD   C,A
  EC33    E6 77                         AND  77H
  EC35    CA EAFC                       JP   Z,KONVT9
  EC38    CD ED9D                       CALL BWSCOL       ;Farbspeicher ein
  EC3B    06 40                         LD   B,40H
  EC3D    71                    CZLC2:  LD   (HL),C
  EC3E    2B                            DEC  HL
  EC3F    10 FC                         DJNZ CZLC2
  EC41    CD EDA3                       CALL BWSZEI       ;Farbspeicher aus
  EC44    C3 EAFC                       JP   KONVT9
                                ;
  EC47    11 0040               CHOCH:  LD   DE,0040H     ;1Ah     Cursor hoch
  EC4A    19                            ADD  HL,DE
                                ;
  EC4B    3E 18                 CHOLI:  LD   A,18H        ;Begrenzung Cursor hoch und links
  EC4D    BC                            CP   H
  EC4E    CA EAFC                       JP   Z,KONVT9
  EC51    22 1800                       LD   (CUPOS),HL
  EC54    C3 EAFC                       JP   KONVT9
                                ;
  EC57    77                    CCHAR:  LD   (HL),A
  EC58    3A F3F8                       LD   A,(COLOR)
  EC5B    4F                            LD   C,A
  EC5C    E6 77                         AND  77H
  EC5E    28 07                         JR   Z,CCHA1
  EC60    CD ED9D                       CALL BWSCOL       ;Farbspeicher ein
  EC63    71                            LD   (HL),C
  EC64    CD EDA3                       CALL BWSZEI       ;Farbspeicher aus
  EC67    2B                    CCHA1:  DEC  HL
                                ;
  EC68    22 1800               SCROL:  LD   (CUPOS),HL
	MACRO-80 3.44	09-Dec-81	PAGE	1-16


  EC6B    EB                            EX   DE,HL        ;Test ob Scrollen noetig
  EC6C    21 0FFF                       LD   HL,0FFFH
  EC6F    A7                            AND  A
  EC70    ED 52                         SBC  HL,DE        ;DE = akt. Cursorpos.
  EC72    EB                            EX   DE,HL
  EC73    DA EAFC                       JP   C,KONVT9     ;CY = nicht scrollen
  EC76    3E 20                         LD   A,20H        ;Leerzeichen
  EC78    CD EC92                       CALL SCR11        ;Scrollen
  EC7B    3A F3F8                       LD   A,(COLOR)
  EC7E    E6 77                         AND  77H
  EC80    CA EAFC                       JP   Z,KONVT9     ;Z = kein Farbspeicher
  EC83    CD ED9D                       CALL BWSCOL       ;Farbspeicher ein
  EC86    3A F3F8                       LD   A,(COLOR)    ;Farbbyte
  EC89    CD EC92                       CALL SCR11
  EC8C    CD EDA3                       CALL BWSZEI       ;Farbspeicher aus
  EC8F    C3 EAFC                       JP   KONVT9
                                ;
  EC92    21 17BF               SCR11:  LD   HL,17BFH     ;Umladeroutine Scrollen
  EC95    11 17FF                       LD   DE,17FFH
  EC98    01 07C0                       LD   BC,07C0H
  EC9B    ED B8                         LDDR
  EC9D    EB                            EX   DE,HL
  EC9E    22 1800                       LD   (CUPOS),HL
  ECA1    23                            INC  HL
  ECA2    06 40                         LD   B,40H        ;eine Zeilenlaenge
  ECA4    2D                    SCR12:  DEC  L
  ECA5    77                            LD   (HL),A       ;Leerzeile schreiben
  ECA6    10 FC                         DJNZ SCR12
  ECA8    C9                            RET
                                ;
                                ;
                                ;UP 'MBEEP' (Monitor-Beep)
                                ;
  ECA9    C5                    MBEEP:  PUSH BC 
  ECAA    06 02                         LD   B,02H        ;2 Wiederholungen
  ECAC    C5                    MBEEP1: PUSH BC 
                                ;       LD   BC,0040H     ;--> fuer 2 MHz
  ECAD    01 0080                       LD   BC,0080H     ;--> fuer 4 MHz
  ECB0    CD ECC0                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
                                ;       LD   BC,0F032H    ;--> fuer 2 MHz
  ECB3    01 F064                       LD   BC,0F064H    ;--> fuer 4 MHz
  ECB6    CD ECC0                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
  ECB9    C1                            POP  BC 
  ECBA    10 F0                         DJNZ MBEEP1 
  ECBC    C1                            POP  BC 
  ECBD    C3 EB0B                       JP   COEN1 
                                ;
                                ;
                                ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
                                ;
  ECC0    F5                    UPTON:  PUSH AF 
  ECC1    DB 05                 UPTON1: IN   A,(P05) 
  ECC3    1F                            RRA 
  ECC4    3F                            CCF 
  ECC5    17                            RLA 
  ECC6    D3 05                         OUT  (P05),A 
  ECC8    79                            LD   A,C 
  ECC9    3D                    UPTON2: DEC  A 
  ECCA    20 FD                         JR   NZ,UPTON2 
  ECCC    10 F3                         DJNZ UPTON1 
  ECCE    F1                            POP  AF 
  ECCF    C9                            RET 
	MACRO-80 3.44	09-Dec-81	PAGE	1-17


                                ;
                                ;
  ECD0    3A F3F9               BNORM:  LD   A,(COLO1)    ;84h  normale Darstellung
  ECD3    E6 77                         AND  77H
  ECD5    32 F3F8                       LD   (COLOR),A
  ECD8    32 F3F9                       LD   (COLO1),A
  ECDB    C3 EAFC                       JP   KONVT9
                                ;
  ECDE    3A F3F9               BINVN:  LD   A,(COLO1)    ;85h  invers EIN
  ECE1    E6 77                         AND  77H
  ECE3    0F                            RRCA
  ECE4    0F                            RRCA
  ECE5    0F                            RRCA
  ECE6    0F                            RRCA
  ECE7    32 F3F8                       LD   (COLOR),A
  ECEA    C3 EAFC                       JP   KONVT9
                                ;
  ECED    3A F3F9               BINTE:  LD   A,(COLO1)    ;86h  intensiv EIN
  ECF0    E6 77                         AND  77H
  ECF2    F6 08                         OR   08H
  ECF4    32 F3F8                       LD   (COLOR),A
  ECF7    C3 EAFC                       JP   KONVT9
                                ;
  ECFA    3A F3F8               BIVIN:  LD   A,(COLOR)    ;87h  intensiv + invers
  ECFD    E6 77                         AND  77H
  ECFF    F6 08                         OR   08H
  ED01    0F                            RRCA
  ED02    0F                            RRCA
  ED03    0F                            RRCA
  ED04    0F                            RRCA
  ED05    32 F3F8                       LD   (COLOR),A
  ED08    C3 EAFC                       JP   KONVT9
                                ;
  ED0B    3E 01                 CUON:   LD   A,01H        ;82h Cursor EIN
  ED0D    32 F3FD                       LD   (CUFLAG),A
  ED10    C3 EAFC                       JP   KONVT9
                                ;
  ED13    AF                    CUOFF:  XOR  A            ;83h Cursor AUS
  ED14    32 F3FD                       LD   (CUFLAG),A
  ED17    C3 EAFC                       JP   KONVT9
                                ;
                                ; Behandlung ESC-Sequenzen
                                ;
                                ; Input: ESC + 2 Steuerzeichen
                                ; wenn 1. Zeichen > 80h dann Cursorposition
                                ; sonst Auswertung Farbe / Grafikzeichen
                                ; (stz00) = Zaehler fuer Zeichenanzahl
                                ;
  ED1A    3A F3FE               KONV10: LD   A,(STZ00)
  ED1D    FE 02                         CP   02H          ;2 = 1. Steuerzeichen (Zeile)
  ED1F    20 0C                         JR   NZ,KONV20    ;sonst 3. Durchlauf (Spalte)
  ED21    79                            LD   A,C
  ED22    32 F3FF                       LD   (STZ01),A    ;erstes Zeichen merken
  ED25    3E 01                         LD   A,01H        ;Zeiger fuer 3. Durchlauf
  ED27    32 F3FE                       LD   (STZ00),A
  ED2A    C3 EAFC                       JP   KONVT9       ;nichts ausgeben
                                ;
                                ; Verzweigung Cursorposition / weitere Funktionen
                                ;
  ED2D    79                    KONV20: LD   A,C
  ED2E    32 F400                       LD   (STZ02),A    ;zweites Zeichen merken
  ED31    AF                            XOR  A
	MACRO-80 3.44	09-Dec-81	PAGE	1-18


  ED32    32 F3FE                       LD   (STZ00),A    ;Durchlaufzaehler ruecksetzen
  ED35    21 F3FF                       LD   HL,STZ01
  ED38    7E                            LD   A,(HL)
  ED39    CB 7F                         BIT  7,A          ;welche Funktion? NZ = Cursor
  ED3B    28 2F                         JR   Z,KONV22     ;Z = weitere Funktionen
                                
                                ; Berechnung direkte Cursorposition
                                ; OUT:    HL = BWS-Adresse
                                ;
  ED3D    F5                            PUSH AF
  ED3E    79                            LD   A,C
  ED3F    E6 3F                         AND  3FH          ;max. Spaltenzahl
  ED41    6F                            LD   L,A
  ED42    F1                            POP  AF
  ED43    E6 1F                         AND  1FH          ;max. Zeilenzahl
  ED45    16 00                         LD   D,00H
  ED47    62                            LD   H,D
  ED48    5F                            LD   E,A
  ED49    06 06                         LD   B,06H
  ED4B    CB 23                 KONV21: SLA  E
  ED4D    CB 12                         RL   D
  ED4F    10 FA                         DJNZ KONV21
  ED51    19                            ADD  HL,DE
  ED52    EB                            EX   DE,HL
  ED53    21 17FF                       LD   HL,17FFH     ;Ende BWS-RAM
  ED56    A7                            AND  A
  ED57    ED 52                         SBC  HL,DE
                                ;
                                ; Cursor direkt positionieren
                                ; IN:    HL = Adresse Cursor
                                ;
  ED59    E5                            PUSH HL
  ED5A    2A 1800                       LD   HL,(CUPOS)	  ;alte Position
  ED5D    3A F401                       LD   A,(CHAR)	  ;Zeichen holen
  ED60    77                            LD   (HL),A	      ;auf BS schreiben
  ED61    E1                            POP  HL
  ED62    22 1800                       LD   (CUPOS),HL   ;neue Position setzen
  ED65    7E                            LD   A,(HL)       ;neues Zeichen holen
  ED66    32 F401                       LD   (CHAR),A     ;und merken
  ED69    C3 EAFC                       JP   KONVT9
                                ;
                                ; Auswertung weiterer ESC-Funktionen
                                ; IN:      A = 1. Steuerzeichen
                                ;
                                ; Ausgabe Grafikzeichen aus AC1-ZG ( > 80h )
                                ;
  ED6C    FE 5F                 KONV22: CP   5FH          ;Grafikzeichen?
  ED6E    20 08                         JR   NZ,KONV24    ;NZ = nein
  ED70    23                            INC  HL
  ED71    7E                            LD   A,(HL)       ;2. Zeichen holen
  ED72    2A 1800                       LD   HL,(CUPOS)
  ED75    C3 EC57                       JP   CCHAR        ;Zeichen ausgeben
                                ;
                                ; Einstellen der Farbe (nur Color-BWS)
                                ;
  ED78    FE 5D                 KONV24: CP   5DH          ;Farbe?
  ED7A    C2 EAFC                       JP   NZ,KONVT9    ;NZ = nein
  ED7D    3A F3F8                       LD   A,(COLOR)    ;Color-BWS?
  ED80    A7                            AND  A
  ED81    CA EAFC                       JP   Z,KONVT9     ;Z = nein
  ED84    23                            INC  HL
  ED85    7E                            LD   A,(HL)       ;2. Zeichen holen
	MACRO-80 3.44	09-Dec-81	PAGE	1-19


  ED86    E6 77                         AND  77H          ;intensiv maskieren
  ED88    47                            LD   B,A
  ED89    0F                            RRCA
  ED8A    0F                            RRCA
  ED8B    0F                            RRCA
  ED8C    0F                            RRCA
  ED8D    B8                            CP   B            ;Zeichen- und HG-Farbe gleich?
  ED8E    CA EAFC                       JP   Z,KONVT9     ;Z = Ja, dann ignorieren
  ED91    78                            LD   A,B
  ED92    32 F3F8                       LD   (COLOR),A    ;Farbe setzen
  ED95    E6 77                         AND  77H          ;intensiv maskieren
  ED97    32 F3F9                       LD   (COLO1),A    ;Backup
  ED9A    C3 EAFC                       JP   KONVT9
                                ;
  ED9D    DB F0                 BWSCOL: IN   A,(PF0)      ;bwsport
  ED9F    CB D7                         SET  2,A          ;Farbspeicher ein
  EDA1    18 04                         JR   BWSZ1
                                ;
  EDA3    DB F0                 BWSZEI: IN   A,(PF0)      ;bwsport
  EDA5    CB 97                         RES  2,A          ;Farbspeicher aus
  EDA7    E6 07                 BWSZ1:  AND  07H
  EDA9    D3 F0                         OUT  (PF0),A
  EDAB    C9                            RET
                                ;
  EDAC    AF                    BWSINI: XOR  A            ;Farbbyte auf Monochrom setzen
  EDAD    32 F3F8                       LD   (COLOR),A    ;Arbeitszelle Farbbyte im BIOS
  EDB0    32 F3FA                       LD   (COLO2),A    ;Merkzelle fuer WBOOT im BIOS
  EDB3    0E F0                         LD   C,0F0H       ;I/O-Adresse COLOR-BWS
  EDB5    ED 40                         IN   B,(C)        ;Konfigbyte COLOR-BWS lesen
  EDB7    04                            INC  B            ;fuer COLOR-BWS muss B<255 sein
  EDB8    C8                            RET  Z            ;kein COLOR-BWS vorhanden --> Ende
                                        ;hier wird die Routine verlassen, wenn kein CPLD vorh. ist
  EDB9    05                            DEC  B            ;Konfigbyte COLOR-BWS: Farb-RAM aus
  EDBA    50                            LD   D,B
  EDBB    CB D2                         SET  2,D          ;Konfigbyte COLOR-BWS: Farb-RAM ein
  EDBD    21 1000                       LD   HL,1000H
  EDC0    5E                            LD   E,(HL)       ;Zeichen aus 1000h
  EDC1    ED 51                         OUT  (C),D        ;Farb-RAM einschalten
  EDC3    3A 181F                       LD   A,(CBWSB)    ;Farbbyte aus dem AC1-Monitor
  EDC6    77                            LD   (HL),A       ;Farbe auf 1000h setzen
  EDC7    BE                            CP   (HL)         ;ist Farb-RAM gesteckt?
  EDC8    ED 41                         OUT  (C),B        ;Farb-RAM ausschalten
  EDCA    73                            LD   (HL),E       ;Zeichen auf 1000h zurueckschreiben
  EDCB    C0                            RET  NZ           ;Farbe hat nicht geklappt --> Ende
                                        ;hier wird die Routine verlassen, wenn kein Farb-RAM steckt
  EDCC    ED 51                         OUT  (C),D        ;Farb-RAM einschalten
  EDCE    C5                            PUSH BC
  EDCF    11 1001                       LD   DE,1001H
  EDD2    01 07FF                       LD   BC,07FFH
  EDD5    ED B0                         LDIR              ;Farb-RAM initialisieren
  EDD7    7E                            LD   A,(HL)       ;Farbe aus 17FFh ruecklesen
  EDD8    C1                            POP  BC
  EDD9    ED 41                         OUT  (C),B        ;Farb-RAM ausschalten
  EDDB    32 F3F8                       LD   (COLOR),A    ;Arbeitszelle Farbbyte im BIOS
  EDDE    32 F3FA                       LD   (COLO2),A    ;Merkzelle fuer WBOOT im BIOS
  EDE1    C9                            RET
                                ;
                                ;+++++++++++++++++++++++++++++   Ende CONOUT  ++++++++++++++++
                                ;
  EDE2    AF                    LISTST: XOR  A
  EDE3    3D                            DEC  A
  EDE4    C9                            RET
	MACRO-80 3.44	09-Dec-81	PAGE	1-20


                                ;
                                ;--------------------------------------------------------------------------
                                ;
  EDE5    21 E641               SELDSK: LD   HL,NDISK     ;max. Anzahl der LW
  EDE8    79                            LD   A,C          ;C = akt. LW
  EDE9    BE                            CP   (HL)
  EDEA    21 0000                       LD   HL,0000H     ;HL=0 --> kein LW
  EDED    D0                            RET  NC           ;akt. LW >= NDISK!!!
  EDEE    2A E642                       LD   HL,(DPHX)    ;AnfangsADR DPH(y)-Tabelle
  EDF1    06 00                         LD   B,00H        ;BC = akt. LW
  EDF3    09                            ADD  HL,BC
  EDF4    09                            ADD  HL,BC        ;HL = DPHY + (2 * LW)
  EDF5    5E                            LD   E,(HL)
  EDF6    23                            INC  HL
  EDF7    56                            LD   D,(HL)       ;DE = (DPHY + (2 * LW))
  EDF8    EB                            EX   DE,HL        ;HL = DPH-ADR vom akt. LW
  EDF9    7C                            LD   A,H
  EDFA    B5                            OR   L
  EDFB    C8                            RET  Z            ;HL=0 --> kein DPB
  EDFC    79                            LD   A,C
  EDFD    32 F41C                       LD   (DRIVE),A    ;aktives LW --> A
  EE00    22 F423                       LD   (DPH),HL     ;zugeordneter DPH --> HL
  EE03    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
  EE04    01 0000               HOME:   LD   BC,0000H
  EE07    ED 43 F41D            SETTRK: LD   (TRACK),BC
  EE0B    C9                            RET
                                ;
  EE0C    ED 43 F41F            SETSEC: LD   (SECTOR),BC
  EE10    C9                            RET
                                ;
  EE11    ED 43 F421            SETDMA: LD   (DMA),BC
  EE15    C9                            RET
                                ;
  EE16    60                    SECTRN: LD   H,B
  EE17    69                            LD   L,C
  EE18    7A                            LD   A,D
  EE19    B3                            OR   E
  EE1A    C8                            RET  Z
  EE1B    EB                            EX   DE,HL
  EE1C    06 00                         LD   B,00H
  EE1E    09                            ADD  HL,BC
  EE1F    6E                            LD   L,(HL)
  EE20    62                            LD   H,D
  EE21    C9                            RET
                                ;
                                ;--------------------------------------------------------------------------
                                ;
  EE22    0E 02                 READ:   LD   C,02H
  EE24    3E 04                         LD   A,04H
  EE26    21                            DEFB 21H          ;LD HL,063EH mit nxt. Befehl!!!
  EE27    3E 06                 WRITE:  LD   A,06H        ;DUMMY fuer READ
  EE29    32 F41B                       LD   (RWBYTE),A   ;hier geht es fuer READ weiter!
  EE2C    79                            LD   A,C
  EE2D    32 F43E                       LD   (DF51E),A
  EE30    21 EE49                       LD   HL,LEDEC
  EE33    E5                            PUSH HL
  EE34    2A F423                       LD   HL,(DPH)
  EE37    11 000A                       LD   DE,000AH
  EE3A    19                            ADD  HL,DE
	MACRO-80 3.44	09-Dec-81	PAGE	1-21


  EE3B    7E                            LD   A,(HL)
  EE3C    23                            INC  HL
  EE3D    66                            LD   H,(HL)
  EE3E    6F                            LD   L,A
  EE3F    2B                            DEC  HL
  EE40    7E                            LD   A,(HL)
  EE41    2B                            DEC  HL
  EE42    6E                            LD   L,(HL)
  EE43    67                            LD   H,A
  EE44    E5                            PUSH HL
  EE45    21 F41B                       LD   HL,RWBYTE    ;HL -> Bytefolge fuer R/W
  EE48    C9                            RET
                                ;
  EE49    B7                    LEDEC:  OR   A
  EE4A    C8                            RET  Z
  EE4B    3E 01                         LD   A,01H
  EE4D    C9                            RET
                                ;
                                ;************************  RAM-Disk   ******************************
                                ;
  EE4E    4E                    RDSKRW: LD   C,(HL)       ;RWBYTE: 04 = Lesen; 06 = Schreiben 
  EE4F    23                            INC  HL           ;DRIVE wird uebersprungen
  EE50    23                            INC  HL
  EE51    7E                            LD   A,(HL)       ;TRACK NWT
  EE52    32 F3FB                       LD   (RAFTRK),A
  EE55    23                            INC  HL
  EE56    7E                            LD   A,(HL)       ;TRACK HWT
  EE57    A7                            AND  A
  EE58    20 32                         JR   NZ,RDERR     ;muss 0 sein
  EE5A    23                            INC  HL
  EE5B    7E                            LD   A,(HL)       ;SEKTOR NWT
  EE5C    32 F3FC                       LD   (RAFSEC),A
  EE5F    CB 7F                         BIT  7,A
  EE61    20 29                         JR   NZ,RDERR     ;Bit 7 muss 0 sein
  EE63    CB 77                         BIT  6,A
  EE65    20 25                         JR   NZ,RDERR     ;Bit 6 muss 0 sein
  EE67    23                            INC  HL
  EE68    7E                            LD   A,(HL)       ;SEKTOR HWT
  EE69    A7                            AND  A
  EE6A    20 20                         JR   NZ,RDERR     ;muss 0 sein
  EE6C    23                            INC  HL
  EE6D    23                            INC  HL           ;DMA wird uebersprungen
  EE6E    79                            LD   A,C
  EE6F    01 0080                       LD   BC,0080H
  EE72    FE 06                         CP   06H
  EE74    28 08                         JR   Z,RDSKWR     ;C = 06 --> RDSK Schreiben
  EE76    CD EFAC                       CALL ADRRAF
  EE79    ED B2                         INIR
  EE7B    00                            NOP
  EE7C    AF                            XOR  A            ;in Ordnung
  EE7D    C9                            RET
                                ;
  EE7E    21 0080               RDSKWR: LD   HL,0080H     ;RAM-Disk schreiben 
  EE81    ED 5B F421                    LD   DE,(DMA)
  EE85    CD EFAC                       CALL ADRRAF
  EE88    ED B3                         OTIR
  EE8A    AF                            XOR  A            ;in Ordnung
  EE8B    C9                            RET
                                ;
  EE8C    3E FF                 RDERR:  LD   A,0FFH       ;Fehler
  EE8E    C9                            RET
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-22


  EE8F    20 3D 3E 49           TXTRDI: DEFM " =>INIT.."
  EE93    4E 49 54 2E           
  EE97    2E                    
  EE98    00                            DEFB 0
                                ;
  EE99    4F 4B                 TXTRDO: DEFM "OK"
  EE9B    00                            DEFB 0
                                ;
  EE9C    52 46 4C 20           TXTRDE: DEFM "RFL ERROR!"
  EEA0    45 52 52 4F           
  EEA4    52 21                 
  EEA6    0D 0A                         DEFB 0DH,0AH
  EEA8    00                            DEFB 0
                                ;
  EEA9    AF                    RDTEST: XOR  A            ;Kapazitaet der RAM-Disk testen
  EEAA    D3 E6                         OUT  (PE0+6),A    ;H-Adresse ruecksetzen
  EEAC    21 EEFE                       LD   HL,RDMERK    ;Merkzellen RAM
  EEAF    06 03                         LD   B,3          ;3 Durchlaeufe
  EEB1    0E E0                         LD   C,PE0        ;Test erfolgt in der 1. RAM-Bank
  EEB3    16 00                         LD   D,0          ;Startwert Extended-Adresse
  EEB5    AF                    RDTST1: XOR  A
  EEB6    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EEB8    7A                            LD   A,D
  EEB9    CB 27                         SLA  A            ;Extended-Adresse *= 2
  EEBB    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse auswaehlen
  EEBD    ED 78                         IN   A,(C)
  EEBF    77                            LD   (HL),A       ;Daten aus der RAM-Disk sichern
  EEC0    AF                            XOR  A
  EEC1    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EEC3    7A                            LD   A,D
  EEC4    ED 79                         OUT  (C),A        ;Testwert in die RAM-Disk schreiben
  EEC6    23                            INC  HL           ;Merkzelle++
  EEC7    14                            INC  D            ;Extended-Adresse++ / Testwert++
  EEC8    10 EB                         DJNZ RDTST1
                                ;
                                ;Tabelle der Test-Werte (mit *...* sind die zu testenden Werte):
                                ;
                                ;     RAM-Disk-Size =     256K  1024K  2048K
                                ;Extended-Adresse=0000B    02H    02H   *00H*
                                ;Extended-Adresse=0010B    02H   *01H*   01H
                                ;Extended-Adresse=0100B   *02H*   02H    02H
                                ;
  EECA    06 03                         LD   B,3          ;3 Durchlaeufe
  EECC    16 00                         LD   D,0          ;Startwert Extended-Adresse
  EECE    AF                    RDTST2: XOR  A
  EECF    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EED1    7A                            LD   A,D
  EED2    CB 27                         SLA  A            ;Extended-Adresse *= 2
  EED4    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse auswaehlen
  EED6    ED 78                         IN   A,(C)
  EED8    BA                            CP   D
  EED9    28 06                         JR   Z,RDTST3     ;2048K (B=3), 1024K (B=2), 256K (B=1)
  EEDB    14                            INC  D            ;Extended-Adresse++ / Testwert++
  EEDC    10 F0                         DJNZ RDTST2
  EEDE    C3 EFA3                       JP   RDERRO       ;Fehler: hier stimmt was nicht!
                                ;
  EEE1    21 EF01               RDTST3: LD   HL,RDSIZE
  EEE4    05                            DEC  B
  EEE5    70                            LD   (HL),B       ;RD-Size: 0=256K 1=1024K 2=2048K
                                ;
  EEE6    21 EEFE                       LD   HL,RDMERK    ;Merkzellen RAM (in die RD zurueck)
  EEE9    04                            INC  B            ;1-3 Durchlaeufe, je nach RDSIZE
	MACRO-80 3.44	09-Dec-81	PAGE	1-23


  EEEA    0E E0                         LD   C,PE0        ;1. RAM-Bank
  EEEC    16 00                         LD   D,0          ;Startwert Extended-Adresse
  EEEE    AF                    RDTST4: XOR  A
  EEEF    D3 E7                         OUT  (PE0+7),A    ;L-Adresse ruecksetzen
  EEF1    7A                            LD   A,D
  EEF2    CB 27                         SLA  A            ;Extended-Adresse *= 2
  EEF4    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse auswaehlen
  EEF6    7E                            LD   A,(HL)
  EEF7    ED 79                         OUT  (C),A        ;urspruengliche Daten zurueckschreiben
  EEF9    23                            INC  HL
  EEFA    14                            INC  D
  EEFB    10 F1                         DJNZ RDTST4       ;WICHTIG: nicht mehr als notwendig
  EEFD    C9                            RET               ;in die RAM-Disk zurC<ckschreiben!!
                                ;
  EEFE                          RDMERK: DEFS 3,0          ;3 Merkzellen fuer den RAM
  EF01    00                    RDSIZE: DEFB 0            ;RD-Size: 0=256K 1=1024K 2=2048K
                                ;
  EF02    21 EE8F               RDFORM: LD   HL,TXTRDI    ;Formatierungstext...
  EF05    CD EA3F                       CALL OUTTXT
  EF08    21 C002                       LD   HL,0C002H    ;Hilfsprogramm von 0C000H bis 0C800H
  EF0B    54                            LD   D,H
  EF0C    5D                            LD   E,L
  EF0D    2B                            DEC  HL
  EF0E    36 E0                         LD   (HL),PE0     ;0C001H = Grundadresse der RAM-Disk
  EF10    2B                            DEC  HL
  EF11    36 D3                         LD   (HL),0D3H    ;0C000H = 0D3H --> OUT n
  EF13    01 0200                       LD   BC,0200H
  EF16    ED B0                         LDIR              ;0D3H,0E0H von 0C000H bis 0C1FFH
  EF18    23                            INC  HL
  EF19    36 E1                         LD   (HL),PE0+1
  EF1B    2B                            DEC  HL
  EF1C    01 0200                       LD   BC,0200H
  EF1F    ED B0                         LDIR              ;0D3H,0E1H von 0C200H bis 0C3FFH
  EF21    23                            INC  HL
  EF22    36 E2                         LD   (HL),PE0+2
  EF24    2B                            DEC  HL
  EF25    01 0200                       LD   BC,0200H
  EF28    ED B0                         LDIR              ;0D3H,0E2H von 0C400H bis 0C5FFH
  EF2A    23                            INC  HL
  EF2B    36 E3                         LD   (HL),PE0+3
  EF2D    2B                            DEC  HL
  EF2E    01 0200                       LD   BC,0200H
  EF31    ED B0                         LDIR              ;0D3H,0E3H von 0C600H bis 0C7FFH
  EF33    36 C9                         LD   (HL),0C9H    ;RET auf 0C800H
                                ;
  EF35    21 EF01                       LD   HL,RDSIZE    ;RD-Size: 0=256K 1=1024K 2=2048K
  EF38    7E                            LD   A,(HL)
  EF39    FE 00                         CP   0
  EF3B    28 05                         JR   Z,RDFOR1
  EF3D    CB 27                         SLA  A            ;A *= 2
  EF3F    CB 27                         SLA  A            ;A *= 2
  EF41    3D                            DEC  A
  EF42    57                    RDFOR1: LD   D,A
  EF43    14                            INC  D            ;neue RD-Size: 1=256K 4=1024K 8=2048K
  EF44    AF                            XOR  A
  EF45    D3 E7                         OUT  (PE0+7),A    ;L-Adresse setzen
  EF47    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse
  EF49    1E 00                         LD   E,0          ;Merker fuer Extended-Adresse
  EF4B    06 00                         LD   B,0          ;256 Durchlaeufe
  EF4D    0E E6                         LD   C,PE0+6
  EF4F    ED 41                 RDFOR2: OUT  (C),B        ;H-Adresse setzen
  EF51    3E E5                         LD   A,0E5H       ;RD wird mit 0E5H formatiert
	MACRO-80 3.44	09-Dec-81	PAGE	1-24


  EF53    CD C000                       CALL HPRDSK       ;Hilfsprogramm Format RAM-Disk
  EF56    10 F7                         DJNZ RDFOR2       ;fuer alle H-Adressen (256 Durchl.)
  EF58    1C                            INC  E
  EF59    7B                            LD   A,E
  EF5A    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse
  EF5C    15                            DEC  D
  EF5D    20 F0                         JR   NZ,RDFOR2        
                                ;
  EF5F    21 D000                       LD   HL,CCP
  EF62    22 F421                       LD   (DMA),HL
  EF65    06 2C                         LD   B,2CH        ;44 Bloecke CCP+BDOS
  EF67    CD EF74                       CALL WRCCP
  EF6A    C2 E967                       JP   NZ,CPMERR
  EF6D    21 EE99                       LD   HL,TXTRDO    ;"OK"
  EF70    CD EA3F                       CALL OUTTXT
  EF73    C9                            RET
                                ;
  EF74    C5                    WRCCP:  PUSH BC           ;CCP+BDOS in Systemtrack schreiben
  EF75    0E 00                         LD   C,00H        ;LW A:
  EF77    CD EDE5                       CALL SELDSK
  EF7A    C1                            POP  BC
  EF7B    21 0000                       LD   HL,0000H
  EF7E    22 F41D                       LD   (TRACK),HL   ;Track 0
  EF81    EB                            EX   DE,HL
  EF82    21 D000                       LD   HL,CCP
  EF85    ED 53 F41F            WRCCP1: LD   (SECTOR),DE
  EF89    22 F421                       LD   (DMA),HL
  EF8C    C5                            PUSH BC
  EF8D    CD                            DEFB 0CDH         ;CALL WRITE -> CD ED CA
  EF8E    EE27                  WRCCP2: DEFW WRITE        ;kannn durch READ (EDC5) ersetzt werden
  EF90    C1                            POP  BC
  EF91    20 10                         JR   NZ,RDERRO
  EF93    2A F421                       LD   HL,(DMA)
  EF96    11 0080                       LD   DE,0080H
  EF99    19                            ADD  HL,DE
  EF9A    ED 5B F41F                    LD   DE,(SECTOR)
  EF9E    13                            INC  DE
  EF9F    10 E4                         DJNZ WRCCP1
  EFA1    AF                            XOR  A
  EFA2    C9                            RET
                                ;
  EFA3    21 EE9C               RDERRO: LD   HL,TXTRDE
  EFA6    CD EA3F                       CALL OUTTXT
  EFA9    AF                            XOR  A
  EFAA    3D                            DEC  A
  EFAB    C9                            RET
                                ;
                                ;Adressarithmetik RAF: L=RADR 0-7 , H=RADR 8-15 , A=RADR 16-19
                                ;
  EFAC    AF                    ADRRAF: XOR  A            ;CY = 0
  EFAD    6F                            LD   L,A 
  EFAE    3A F3FC                       LD   A,(RAFSEC)   ;8 bit
  EFB1    67                            LD   H,A          ;H=Sektor (max. 64 = Bit 0-5)
  EFB2    CB 1C                         RR   H
  EFB4    CB 1D                         RR   L            ;H0 -> L7 ...... H5 -> H4
  EFB6    3A F3FB                       LD   A,(RAFTRK)   ;8 bit , A=Track (max. 128 bei 1M = Bit 0-6)
  EFB9    CB 1F                         RR   A            ;A0 -> CY
  EFBB    30 02                         JR   NC,ADRAF1
  EFBD    CB EC                         SET  5,H          ;H5 = A0 (RADR13)
  EFBF    CB 1F                 ADRAF1: RR   A            ;A1 -> CY
  EFC1    30 02                         JR   NC,ADRAF2
  EFC3    CB F4                         SET  6,H          ;H6 = A1 (RADR14)
	MACRO-80 3.44	09-Dec-81	PAGE	1-25


  EFC5    CB 1F                 ADRAF2: RR   A            ;A2 -> CY
  EFC7    30 02                         JR   NC,ADRAF3
  EFC9    CB FC                         SET  7,H          ;H7 = A2 (RADR15)
  EFCB    F5                    ADRAF3: PUSH AF
  EFCC    E6 03                         AND  03H
  EFCE    F6 E0                         OR   PE0          ;Grundadresse der RAM-Disk
  EFD0    4F                            LD   C,A
  EFD1    7D                            LD   A,L
  EFD2    D3 E7                         OUT  (PE0+7),A    ;L-Adresse
  EFD4    7C                            LD   A,H
  EFD5    D3 E6                         OUT  (PE0+6),A    ;H-Adresse
  EFD7    F1                            POP  AF
  EFD8    CB 1F                         RR   A            ;Rotiere A rechts durch Carry
  EFDA    CB 1F                         RR   A
  EFDC    E6 07                         AND  07H          ;max. 2048K RAM-Disk
  EFDE    D3 E5                         OUT  (PE0+5),A    ;Extended-Adresse
  EFE0    06 80                         LD   B,80H
  EFE2    2A F421                       LD   HL,(DMA)
  EFE5    C9                            RET
                                ;
                                ;**********************  Ende  RAM-Disk  *********************
                                ;
                                ;*************************  LOAD-Befehl  *********************
                                ;
  EFE6    C9                    LOAD:   RET
                                ;
                                ;******************************   Ende LOAD  *****************
                                ;
  EFE7    2A F423               LEFFA:  LD   HL,(DPH)     ;zugeordneter DPH --> HL
  EFEA    22 F435                       LD   (DF515),HL
  EFED    2E 0F                 LF000:  LD   L,0FH
  EFEF    D5                    LF002:  PUSH DE
  EFF0    11 000A                       LD   DE,000AH
  EFF3    62                            LD   H,D
  EFF4    E5                            PUSH HL
  EFF5    2A F435                       LD   HL,(DF515)
  EFF8    19                            ADD  HL,DE
  EFF9    5E                            LD   E,(HL)
  EFFA    23                            INC  HL
  EFFB    56                            LD   D,(HL)
  EFFC    E1                            POP  HL
  EFFD    19                            ADD  HL,DE
  EFFE    D1                            POP  DE
  EFFF    7E                            LD   A,(HL)
  F000    B7                            OR   A
  F001    C9                            RET
                                ;Ansprung unklar
  F002    23                    LF015:  INC  HL
  F003    CB FE                         SET  7,(HL)
  F005    2B                            DEC  HL
  F006    AF                    LF019:  XOR  A
  F007    32 F43C                       LD   (DF51C),A
  F00A    CD F011                       CALL LF024
  F00D    3A F43C                       LD   A,(DF51C)
  F010    C9                            RET
                                ;
  F011    4E                    LF024:  LD   C,(HL)
  F012    CD EFE7                       CALL LEFFA
  F015    CA F0CE                       JP   Z,LF0E1
  F018    79                            LD   A,C
  F019    FE 06                         CP   06H
  F01B    3E 01                         LD   A,01H
	MACRO-80 3.44	09-Dec-81	PAGE	1-26


  F01D    20 01                         JR   NZ,LF033
  F01F    AF                            XOR  A
  F020    32 F43D               LF033:  LD   (DF51D),A
  F023    CD EFED                       CALL LF000
  F026    47                            LD   B,A
  F027    2A F41F                       LD   HL,(SECTOR)
  F02A    CB 3C                 LF03D:  SRL  H
  F02C    CB 1D                         RR   L
  F02E    10 FA                         DJNZ LF03D
  F030    22 F438                       LD   (DF518),HL
  F033    21 F43A                       LD   HL,DF51A
  F036    7E                            LD   A,(HL)
  F037    36 01                         LD   (HL),01H
  F039    B7                            OR   A
  F03A    28 26                         JR   Z,LF075
  F03C    3A F41C                       LD   A,(DRIVE)
  F03F    21 F425                       LD   HL,DF505
  F042    BE                            CP   (HL)
  F043    20 16                         JR   NZ,LF06E
  F045    2A F426                       LD   HL,(DF506)
  F048    ED 5B F41D                    LD   DE,(TRACK)
  F04C    ED 52                         SBC  HL,DE
  F04E    20 0B                         JR   NZ,LF06E
  F050    2A F428                       LD   HL,(DF508)
  F053    ED 5B F438                    LD   DE,(DF518)
  F057    ED 52                         SBC  HL,DE
  F059    28 1F                         JR   Z,LF08D
  F05B    3A F43B               LF06E:  LD   A,(DF51B)
  F05E    B7                            OR   A
  F05F    C4 F0BB                       CALL NZ,LF0CE
  F062    21 F41C               LF075:  LD   HL,DRIVE
  F065    11 F425                       LD   DE,DF505
  F068    01 0009                       LD   BC,0009H
  F06B    ED B0                         LDIR
  F06D    2A F438                       LD   HL,(DF518)
  F070    22 F428                       LD   (DF508),HL
  F073    CD F0BE                       CALL LF0D1
  F076    AF                            XOR  A
  F077    32 F43B                       LD   (DF51B),A
  F07A    CD EFED               LF08D:  CALL LF000
  F07D    23                            INC  HL
  F07E    3A F41F                       LD   A,(SECTOR)
  F081    A6                            AND  (HL)
  F082    1F                            RRA
  F083    67                            LD   H,A
  F084    3E 00                         LD   A,00H
  F086    1F                            RRA
  F087    6F                            LD   L,A
  F088    11 F43F                       LD   DE,DISKP
  F08B    19                            ADD  HL,DE
  F08C    ED 5B F421                    LD   DE,(DMA)
  F090    3A F43D                       LD   A,(DF51D)
  F093    B7                            OR   A
  F094    20 05                         JR   NZ,LF0AE
  F096    3C                            INC  A
  F097    32 F43B                       LD   (DF51B),A
  F09A    EB                            EX   DE,HL
  F09B    01 0080               LF0AE:  LD   BC,0080H
  F09E    ED B0                         LDIR
  F0A0    3A F43C                       LD   A,(DF51C)
  F0A3    B7                            OR   A
  F0A4    20 10                         JR   NZ,LF0C9
	MACRO-80 3.44	09-Dec-81	PAGE	1-27


  F0A6    3A F43E                       LD   A,(DF51E)
  F0A9    3D                            DEC  A
  F0AA    C0                            RET  NZ
  F0AB    32 F43B                       LD   (DF51B),A
  F0AE    CD F0BB                       CALL LF0CE
  F0B1    3A F43C                       LD   A,(DF51C)
  F0B4    B7                            OR   A
  F0B5    C8                            RET  Z
  F0B6    AF                    LF0C9:  XOR  A
  F0B7    32 F43A                       LD   (DF51A),A
  F0BA    C9                            RET
                                ;
  F0BB    3E 06                 LF0CE:  LD   A,06H
  F0BD    21                            DEFB 21H          ;LD HL,043EH -> 21 3E 04
  F0BE    3E 04                 LF0D1:  LD   A,04H  
  F0C0    32 F437                       LD   (DF517),A
  F0C3    21 F43F                       LD   HL,DISKP
  F0C6    22 F42A                       LD   (DF50A),HL
  F0C9    21 F425                       LD   HL,DF505
  F0CC    18 09                         JR   LF0EA
                                ;
  F0CE    3A F41B               LF0E1:  LD   A,(RWBYTE)
  F0D1    32 F437                       LD   (DF517),A
  F0D4    21 F41C                       LD   HL,DRIVE
  F0D7    11 F42E               LF0EA:  LD   DE,DF50E
  F0DA    01 0009                       LD   BC,0009H
  F0DD    ED B0                         LDIR
  F0DF    3A F42E                       LD   A,(DF50E)
  F0E2    17                            RLA
  F0E3    DA F2F5                       JP   C,GIDERW     ;GIDE
  F0E6    3A F430                       LD   A,(DF510)
  F0E9    21 F432                       LD   HL,DF512
  F0EC    B6                            OR   (HL)
  F0ED    C2 F1AE                       JP   NZ,LF1C1
  F0F0    CD EFED                       CALL LF000
  F0F3    32 F40E                       LD   (DF4E8),A
  F0F6    B7                            OR   A
  F0F7    3E FF                         LD   A,0FFH
  F0F9    28 02                         JR   Z,LF110
  F0FB    3E 80                         LD   A,80H
  F0FD    32 F411               LF110:  LD   (DF4EB),A
  F100    23                            INC  HL
  F101    23                            INC  HL
  F102    7E                            LD   A,(HL)
  F103    32 F40F                       LD   (DF4E9),A
  F106    3A F431                       LD   A,(DF511)
  F109    BE                            CP   (HL)
  F10A    38 04                         JR   C,LF123
  F10C    96                            SUB  (HL)
  F10D    01 0104                       LD   BC,0104H
  F110    3C                    LF123:  INC  A
  F111    32 F40D                       LD   (DF4E7),A
  F114    23                            INC  HL
  F115    7E                            LD   A,(HL)
  F116    32 F410                       LD   (DF4EA),A
  F119    23                            INC  HL
  F11A    3A F42F                       LD   A,(DF50F)
  F11D    BE                            CP   (HL)
  F11E    38 04                         JR   C,LF137
  F120    96                            SUB  (HL)
  F121    01 0104                       LD   BC,0104H
  F124    32 F40B               LF137:  LD   (DF4E5),A
	MACRO-80 3.44	09-Dec-81	PAGE	1-28


  F127    23                            INC  HL
  F128    7E                            LD   A,(HL)
  F129    B1                            OR   C
  F12A    32 F40A                       LD   (DF4E4),A
  F12D    78                            LD   A,B
  F12E    32 F40C                       LD   (DF4E6),A
  F131    23                            INC  HL
  F132    3A F437                       LD   A,(DF517)
  F135    16 05                         LD   D,05H
  F137    FE 06                         CP   06H
  F139    28 02                         JR   Z,LF150
  F13B    16 06                         LD   D,06H
  F13D    7E                    LF150:  LD   A,(HL)
  F13E    E6 40                         AND  40H
  F140    B2                            OR   D
  F141    32 F408                       LD   (DF4E2),A
  F144    11 F412                       LD   DE,DF4EC
  F147    01 0004                       LD   BC,0004H
  F14A    ED B0                         LDIR
  F14C    0E 02                         LD   C,02H
  F14E    06 02                 LF161:  LD   B,02H
  F150    C5                    LF163:  PUSH BC
  F151    CD F162                       CALL LF175
  F154    C1                            POP  BC
  F155    B7                            OR   A
  F156    C8                            RET  Z
  F157    10 F7                         DJNZ LF163
  F159    0D                            DEC  C
  F15A    C8                            RET  Z
  F15B    C5                            PUSH BC
  F15C    CD F1C2                       CALL LF1D5
  F15F    C1                            POP  BC
  F160    18 EC                         JR   LF161
                                ;
  F162    3E 03                 LF175:  LD   A,03H
  F164    06 02                         LD   B,02H
  F166    21 F414                       LD   HL,CTAB      ;FDC Befehlsbyte
  F169    D3 41                         OUT  (DFDC),A     ;Datenport FDC
  F16B    CD F21D                       CALL LF230
  F16E    CD F1D4                       CALL LF1E7
  F171    20 3B                         JR   NZ,LF1C1
  F173    21 0040                       LD   HL,0040H
  F176    3A F40E                       LD   A,(DF4E8)
  F179    3C                            INC  A
  F17A    29                    LF18D:  ADD  HL,HL
  F17B    3D                            DEC  A
  F17C    20 FC                         JR   NZ,LF18D
  F17E    2B                            DEC  HL
  F17F    24                            INC  H
  F180    2C                            INC  L
  F181    E5                            PUSH HL
  F182    2A F433                       LD   HL,(DF513)
  F185    E5                            PUSH HL
  F186    3A F408                       LD   A,(DF4E2)
  F189    4F                            LD   C,A
  F18A    06 09                         LD   B,09H
  F18C    0F                            RRCA
  F18D    3E 51                         LD   A,51H
  F18F    8F                            ADC  A,A
  F190    32 F25C                       LD   (MODE0),A    ;A2 --> INI
  F193    32 F262                       LD   (MODE1),A    ;A3 --> OUTI
  F196    F3                            DI
	MACRO-80 3.44	09-Dec-81	PAGE	1-29


  F197    CD F214                       CALL LF227
  F19A    E1                            POP  HL
  F19B    D1                            POP  DE
  F19C    43                            LD   B,E
  F19D    0E 41                         LD   C,DFDC       ;Datenport FDC
  F19F    CD F24F                       CALL RW           ;FDC RW-Routine
  F1A2    FB                            EI
  F1A3    CD F1B5                       CALL LF1C8
  F1A6    21 F416                       LD   HL,DF4F0
  F1A9    7E                            LD   A,(HL)
  F1AA    E6 C0                         AND  0C0H
  F1AC    28 02                         JR   Z,LF1C3
  F1AE    3E FF                 LF1C1:  LD   A,0FFH
  F1B0    32 F43C               LF1C3:  LD   (DF51C),A
  F1B3    B7                            OR   A
  F1B4    C9                            RET
                                ;
  F1B5    06 07                 LF1C8:  LD   B,07H
  F1B7    21 F416                       LD   HL,DF4F0
  F1BA    CD F238               LF1CD:  CALL LF24B
  F1BD    77                            LD   (HL),A
  F1BE    23                            INC  HL
  F1BF    10 F9                         DJNZ LF1CD
  F1C1    C9                            RET
                                ;
  F1C2    01 0207               LF1D5:  LD   BC,0207H
  F1C5    CD F214                       CALL LF227
  F1C8    CD F1F4                       CALL LF207
  F1CB    C8                            RET  Z
  F1CC    01 0207                       LD   BC,0207H
  F1CF    CD F214                       CALL LF227
  F1D2    18 20                         JR   LF207
                                ;
  F1D4    3A F40B               LF1E7:  LD   A,(DF4E5)
  F1D7    32 F417                       LD   (DF4F7),A
  F1DA    B7                            OR   A
  F1DB    28 E5                         JR   Z,LF1D5
  F1DD    01 030F                       LD   BC,030FH
  F1E0    21 F412                       LD   HL,DF4EC
  F1E3    CB 66                         BIT  4,(HL)
  F1E5    28 04                         JR   Z,LF1FE
  F1E7    87                            ADD  A,A
  F1E8    32 F40B                       LD   (DF4E5),A
  F1EB    CD F214               LF1FE:  CALL LF227
  F1EE    3A F417                       LD   A,(DF4F7)
  F1F1    32 F40B                       LD   (DF4E5),A
  F1F4    01 0108               LF207:  LD   BC,0108H
  F1F7    CD F214                       CALL LF227
  F1FA    CD F238                       CALL LF24B
  F1FD    47                            LD   B,A
  F1FE    32 F416                       LD   (DF4F0),A
  F201    FE 80                         CP   80H
  F203    C4 F238                       CALL NZ,LF24B
  F206    CB 68                         BIT  5,B
  F208    28 EA                         JR   Z,LF207
  F20A    78                            LD   A,B
  F20B    E6 F0                         AND  0F0H
  F20D    FE C0                         CP   0C0H
  F20F    28 E3                         JR   Z,LF207
  F211    EE 20                         XOR  20H
  F213    C9                            RET
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-30


  F214    C5                    LF227:  PUSH BC
  F215    CD F272                       CALL LF285
  F218    C1                            POP  BC
  F219    21 F409               LF22C:  LD   HL,DF4E3
  F21C    71                            LD   (HL),C
  F21D    0E 41                 LF230:  LD   C,41H
  F21F    D5                            PUSH DE
  F220    11 1FFF               LF233:  LD   DE,1FFFH
  F223    7B                    LF236:  LD   A,E
  F224    B2                            OR   D
  F225    28 0D                         JR   Z,LF247      ;Abbruch nach 8192 Versuchen
  F227    DB 40                         IN   A,(CFDC)     ;Lese Hauptstatusregister
  F229    E6 C0                         AND  0C0H
  F22B    FE 80                         CP   80H          ;FDC bereit zum Schreiben?
  F22D    1B                            DEC  DE
  F22E    20 F3                         JR   NZ,LF236     ;noch nicht bereit
  F230    ED A3                         OUTI              ;1 Byte --> FDC
  F232    20 EC                         JR   NZ,LF233     ;Wdhlg., bis B=0
  F234    06 00                 LF247:  LD   B,00H
  F236    D1                            POP  DE
  F237    C9                            RET
                                ;
  F238    E5                    LF24B:  PUSH HL
  F239    21 1FFF                       LD   HL,1FFFH
  F23C    7D                    LF24F:  LD   A,L
  F23D    B4                            OR   H
  F23E    3E C0                         LD   A,0C0H
  F240    28 0B                         JR   Z,LF260      ;Abbruch nach 8192 Versuchen
  F242    DB 40                         IN   A,(CFDC)     ;Lese Hauptstatusregister
  F244    E6 C0                         AND  0C0H
  F246    FE C0                         CP   0C0H         ;FDC bereit zum Lesen?
  F248    2B                            DEC  HL
  F249    20 F1                         JR   NZ,LF24F     ;noch nicht bereit
  F24B    DB 41                         IN   A,(DFDC)     ;1 Byte vom FDC lesen --> A
  F24D    E1                    LF260:  POP  HL
  F24E    C9                            RET
                                ;
                                ;
                                ;       FDC READ/WRITE Routine
                                ;       ----------------------
                                ;
  F24F    3A F41A               RW:     LD   A,(LATPU)
  F252    CB CF                         SET  1,A
  F254    D3 45                         OUT  (LATCH),A    ;WAIT-Freigabe
  F256    DB 40                 RW01:   IN   A,(CFDC)     ;Lese Hauptstatusregister
  F258    07                            RLCA
  F259    30 FB                         JR   NC,RW01      ;FDC noch nicht bereit
  F25B    ED                            DEFB 0EDH         ;ED A2 = INI
  F25C    A2                    MODE0:  DEFB 0A2H         ;ED A3 = OUTI
  F25D    00                            NOP
  F25E    D3 43                 RW02:   OUT  (WAIT),A     ;WAIT bis Interrupt FDC
  F260    00                            NOP
  F261    ED                            DEFB 0EDH         ;ED A2 = INI
  F262    A2                    MODE1:  DEFB 0A2H         ;ED A3 = OUTI
  F263    C2 F25E                       JP   NZ,RW02
  F266    15                            DEC  D
  F267    C2 F25E                       JP   NZ,RW02
  F26A    3A F41A                       LD   A,(LATPU)
  F26D    CB E7                         SET  4,A          ;Terminal Count
  F26F    D3 45                         OUT  (LATCH),A    ;TC + WAIT-Sperrung
  F271    C9                            RET
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-31


  F272    21 F418               LF285:  LD   HL,DF4F8
  F275    3A F40A                       LD   A,(DF4E4)
  F278    E6 03                         AND  03H
  F27A    BE                            CP   (HL)
  F27B    77                            LD   (HL),A
  F27C    23                            INC  HL
  F27D    4E                            LD   C,(HL)
  F27E    36 48                         LD   (HL),48H
  F280    F5                            PUSH AF
  F281    E5                            PUSH HL
  F282    21 F41A                       LD   HL,LATPU
  F285    3A F40A                       LD   A,(DF4E4)
  F288    E6 03                         AND  03H
  F28A    28 08                         JR   Z,LF2A7
  F28C    FE 02                         CP   02H
  F28E    28 04                         JR   Z,LF2A7
  F290    CB DE                         SET  3,(HL)       ;Floppy-LW 1: Motor an
  F292    18 02                         JR   LF2A9
                                ;
  F294    CB C6                 LF2A7:  SET  0,(HL)       ;Floppy-LW 0: Motor an
  F296    7E                    LF2A9:  LD   A,(HL)
  F297    D3 45                         OUT  (LATCH),A
  F299    E1                            POP  HL
  F29A    F1                            POP  AF
  F29B    20 04                         JR   NZ,LF2B4
  F29D    79                            LD   A,C
  F29E    A7                            AND  A
  F29F    20 09                         JR   NZ,LF2BD
  F2A1    3E 48                 LF2B4:  LD   A,48H
  F2A3    CB 3F                         SRL  A
  F2A5    CB 3F                         SRL  A
  F2A7    BE                            CP   (HL)
  F2A8    38 F7                         JR   C,LF2B4
  F2AA    7E                    LF2BD:  LD   A,(HL)
  F2AB    A7                            AND  A
  F2AC    20 08                         JR   NZ,LF2C9
  F2AE    E5                            PUSH HL
  F2AF    21 F2CA                       LD   HL,DISCTX
  F2B2    CD EA3F                       CALL OUTTXT
  F2B5    E1                            POP  HL
  F2B6    C5                    LF2C9:  PUSH BC
  F2B7    E5                            PUSH HL
  F2B8    01 0204                       LD   BC,0204H
  F2BB    CD F219                       CALL LF22C
  F2BE    CD F238                       CALL LF24B
  F2C1    E1                            POP  HL
  F2C2    C1                            POP  BC
  F2C3    CB 6F                         BIT  5,A
  F2C5    28 E3                         JR   Z,LF2BD
  F2C7    36 90                         LD   (HL),90H
  F2C9    C9                            RET
                                ;
  F2CA    20 44 49 53           DISCTX: DEFM ' DISC?'
  F2CE    43 3F                 
  F2D0    08 08 08 08                   DEFB 8,8,8,8,8,8
  F2D4    08 08                 
  F2D6    00                            NOP
                                ;
                                ;
                                ; Interrupteinsprung von CTC Kanal 3
                                ;
  F2D7    F3                    ISRCTC: DI                ;DI hat gefehlt, wurde ergaenzt
	MACRO-80 3.44	09-Dec-81	PAGE	1-32


  F2D8    F5                            PUSH AF
  F2D9    3A F419                       LD   A,(CTCCNT)   ;CTC-Zusatzzaehler lesen
  F2DC    A7                            AND  A
  F2DD    28 12                         JR   Z,ISRCTE     ;bei "0", die Fkt. beenden
                                        ;Beim Start von HRCPM wird CNTCNT per Interrupt von 255 auf 0 heruntergezaehlt.
                                        ;Das sieht nach einer verzoegerten Steuerung von LATPU und LATCH aus.
  F2DF    3D                            DEC  A
  F2E0    32 F419                       LD   (CTCCNT),A
  F2E3    20 0C                         JR   NZ,ISRCTE
  F2E5    E5                            PUSH HL           ;Bei 2 MHz CPU-Takt wird nach 8 Sekunden diese Stelle erreicht
  F2E6    21 F41A                       LD   HL,LATPU
  F2E9    CB 86                         RES  0,(HL)       ;Floppy-LW 0: Motor aus
  F2EB    CB 9E                         RES  3,(HL)       ;Floppy-LW 1: Motor aus
  F2ED    7E                            LD   A,(HL)
  F2EE    D3 45                         OUT  (LATCH),A    ;Latch auf dem Floppy-Controller ruecksetzen
  F2F0    E1                            POP  HL
  F2F1    F1                    ISRCTE: POP  AF
  F2F2    FB                    INTEND: EI                ;ist zusaetzlich Einsprungpunkt fuer nicht genutzte Interrupts
  F2F3    ED 4D                         RETI
                                ;
                                ;-------------  R/W GIDE HW  -----------------------------------------------------------
                                
  F2F5    DB 8F                 GIDERW: IN   A,(P8F)      ;Command / Status
  F2F7    17                            RLA               ;Bit 0 = CY
  F2F8    38 FB                         JR   C,GIDERW     ;wait for hard disk ready (non-busy)
  F2FA    2E 19                         LD   L,19H
  F2FC    CD EFEF                       CALL LF002
  F2FF    4F                            LD   C,A
  F300    2A F431                       LD   HL,(DF511)
  F303    23                            INC  HL
  F304    AF                            XOR  A
  F305    47                            LD   B,A
  F306    3C                    LF318:  INC  A
  F307    ED 42                         SBC  HL,BC
  F309    28 02                         JR   Z,LF31F
  F30B    30 F9                         JR   NC,LF318
  F30D    09                    LF31F:  ADD  HL,BC
  F30E    3D                            DEC  A
  F30F    57                            LD   D,A
  F310    5D                            LD   E,L
  F311    2E 11                         LD   L,11H
  F313    CD EFEF                       CALL LF002
  F316    B2                            OR   D
  F317    D3 8E                         OUT  (P8E),A      ;Drive and Head
  F319    7B                            LD   A,E
  F31A    D3 8B                         OUT  (P8B),A      ;Sector Number
  F31C    23                            INC  HL
  F31D    5E                            LD   E,(HL)
  F31E    23                            INC  HL
  F31F    56                            LD   D,(HL)
  F320    2A F42F                       LD   HL,(DF50F)
  F323    19                            ADD  HL,DE
  F324    7D                            LD   A,L
  F325    D3 8C                         OUT  (P8C),A      ;Cylinder Low
  F327    7C                            LD   A,H
  F328    D3 8D                         OUT  (P8D),A      ;Cylinder High
  F32A    3E 01                         LD   A,01H
  F32C    D3 8A                         OUT  (P8A),A      ;Sector Count
  F32E    3A F437                       LD   A,(DF517)
  F331    FE 06                         CP   06H
  F333    28 16                         JR   Z,LF35D      ;6 = schreiben
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-33


                                ;  GIDE lesen 1 Sektor = 512 Bytes nach Puffer
                                ;
  F335    3E 20                         LD   A,20H        ;Read Sector
  F337    D3 8F                         OUT  (P8F),A      ;Command / Status
  F339    DB 8F                 LF34B:  IN   A,(P8F)      ;Command / Status
  F33B    CB 5F                         BIT  3,A
  F33D    28 FA                         JR   Z,LF34B      ;wait resp. DRQ active.
  F33F    2A F433                       LD   HL,(DF513)
  F342    01 0088                       LD   BC,0088H     ;B = 0 (counter), C = I/O address (Data Register)
  F345    ED B2                         INIR
  F347    ED B2                         INIR              ;512 bytes gesamt lesen
  F349    18 19                         JR   LF376
                                ;
                                ;  GIDE schreiben 1 Sektor = 512 Bytes von Puffer
                                ;
  F34B    3E 30                 LF35D:  LD   A,30H        ;Write Sector
  F34D    D3 8F                         OUT  (P8F),A      ;Command / Status
  F34F    DB 8F                 LF361:  IN   A,(P8F)      ;Command / Status
  F351    17                            RLA               ;Bit 0 = CY
  F352    38 FB                         JR   C,LF361      ;wait for hard disk ready (non-busy)
  F354    DB 8F                 LF366:  IN   A,(P8F)      ;Command / Status
  F356    CB 5F                         BIT  3,A
  F358    28 FA                         JR   Z,LF366      ;wait resp. DRQ active.
  F35A    2A F433                       LD   HL,(DF513)
  F35D    01 0088                       LD   BC,0088H     ;B = 0 (counter), C = I/O address (Data Register)
  F360    ED B3                         OTIR             
  F362    ED B3                         OTIR              ;512 bytes gesamt schreiben 
                                ;        
  F364    DB 8F                 LF376:  IN   A,(P8F)      ;Command / Status
  F366    17                            RLA               ;Bit 0 = CY
  F367    38 FB                         JR   C,LF376      ;wait for hard disk ready (non-busy)
  F369    DB 8F                         IN   A,(P8F)      ;Command / Status
  F36B    E6 89                         AND  89H          ;10001001b - busy, DRQ, or error?
  F36D    C8                            RET  Z            ;no: all is fine, mit A=0
  F36E    3E FF                         LD   A,0FFH
  F370    32 F43C                       LD   (DF51C),A
  F373    C9                            RET               ;on errors, return with A=FFh
                                ;
                                ;-----------------  ENDE GIDE HW  ------------------------------------------
                                ;
  F374    43 4F 4E 49                   DEFM "CONIN-ZBIOS-STACK==26BYTES"
  F378    4E 2D 5A 42           
  F37C    49 4F 53 2D           
  F380    53 54 41 43           
  F384    4B 3D 3D 32           
  F388    36 42 59 54           
  F38C    45 53                 
  F38E    43 4F 4E 49                   DEFM "CONIN-ZBIOS-STACK==26BYTES"
  F392    4E 2D 5A 42           
  F396    49 4F 53 2D           
  F39A    53 54 41 43           
  F39E    4B 3D 3D 32           
  F3A2    36 42 59 54           
  F3A6    45 53                 
  F3A8    43 4F 4E 4F           CINSP:  DEFM "CONOUT-STACK_CONOUT-STACK_CONOUT-STACK"
  F3AC    55 54 2D 53           
  F3B0    54 41 43 4B           
  F3B4    5F 43 4F 4E           
  F3B8    4F 55 54 2D           
  F3BC    53 54 41 43           
  F3C0    4B 5F 43 4F           
  F3C4    4E 4F 55 54           
	MACRO-80 3.44	09-Dec-81	PAGE	1-34


  F3C8    2D 53 54 41           
  F3CC    43 4B                 
  F3CE    5A 42 49 4F           COUTSP: DEFM "ZBIOS(C)ML-SOFT 2003 & AC1-BIOS(C)HR 2011"
  F3D2    53 28 43 29           
  F3D6    4D 4C 2D 53           
  F3DA    4F 46 54 20           
  F3DE    32 30 30 33           
  F3E2    20 26 20 41           
  F3E6    43 31 2D 42           
  F3EA    49 4F 53 28           
  F3EE    43 29 48 52           
  F3F2    20 32 30 31           
  F3F6    31                    
  F3F7    00                    CPMSTK: NOP
                                ;
                                ;****************  Ende CP/M StackBereich  *******************
                                ;
  F3F8    00                    COLOR:  DEFB 0            ;Merkzelle aktuelle BWS-Farbe (0=Monochrom)
  F3F9    00                    COLO1:  DEFB 0            ;aktuelle Farbe ohne invers und intensiv
  F3FA    00                    COLO2:  DEFB 0            ;Farbe fuer Monitor und CP/M Warmstart
                                ;
  F3FB    00                    RAFTRK: DEFB 0            ;RAFTRK EQU 0F4C2H
  F3FC    00                    RAFSEC: DEFB 0
                                ;
  F3FD    01                    CUFLAG: DEFB 1            ;CUON/CUOFF  KursorFlag  F4CDh
  F3FE    00                    STZ00:  DEFB 0            ;Merkzelle Anz. BS-Steuerzeichen  F4CFh
  F3FF    00                    STZ01:  DEFB 0            ;Merkzelle fuer 1. ESC-Steuerzeichen
  F400    00                    STZ02:  DEFB 0            ;Merkzelle fuer 2. ESC-Steuerzeichen
                                ;
  F401    00                    CHAR:   DEFB 0            ;Merkzelle Zeichen <> Cursor  F4D2h
                                ;
  F402    0000                  SPCIN:  DEFW 0            ;F4D8
  F404    0000                  SPCOUT: DEFW 0
  F406    0000                  OLDNMI: DEFW 0            ;2 Bytes fuer alten NMI
                                ;
  F408    00                    DF4E2:  NOP
  F409    00                    DF4E3:  NOP               ;Merkzelle
  F40A    00                    DF4E4:  NOP
  F40B    00                    DF4E5:  NOP
  F40C    00                    DF4E6:  NOP
  F40D    00                    DF4E7:  NOP
  F40E    00                    DF4E8:  NOP
  F40F    00                    DF4E9:  NOP
  F410    00                    DF4EA:  NOP
  F411    00                    DF4EB:  NOP
                                ;
  F412    00                    DF4EC:  NOP               ;4 Merkzellen  
  F413    00                            NOP
  F414    00                    CTAB:   NOP               ;FDC Befehlsbyte
  F415    00                            NOP               ;4 Merkzellen Ende
                                ;
  F416    00                    DF4F0:  NOP
  F417    00                    DF4F7:  NOP
  F418    00                    DF4F8:  NOP
  F419    00                    CTCCNT: NOP               ;CTC-Counter - Zusatzzaehler fuer CTC-Interrupt
  F41A    00                    LATPU:  NOP               ;Latch fuer den Floppy-Controler
                                ;
                                ;hier beginnt eine Bytefolge fuer Read/Write Operationen
                                ;
  F41B    04                    RWBYTE: DEFB 4            ;4 = READ, 6 = WRITE
  F41C    00                    DRIVE:  DEFB 0            ;LW-Nr.
  F41D    0000                  TRACK:  DEFW 0            ;akt. Track
	MACRO-80 3.44	09-Dec-81	PAGE	1-35


  F41F    0000                  SECTOR: DEFW 0            ;akt. Sektor
  F421    0000                  DMA:    DEFW 0            ;DMA-Adresse
  F423    0000                  DPH:    DEFW 0
                                ;
  F425    00                    DF505:  DEFB 0            ;9 Bytes Kopie ab DRIVE:
  F426    0000                  DF506:  DEFW 0
  F428    0000                  DF508:  DEFW 0
  F42A    0000                  DF50A:  DEFW 0
  F42C    0000                          DEFW 0            ;Ende 9 Bytes
                                ;
  F42E    00                    DF50E:  NOP               ;9 Bytes Kopie ab DRIVE: bzw. DF505:
  F42F    00                    DF50F:  NOP
  F430    00                    DF510:  NOP
  F431    00                    DF511:  DEFB 0
  F432    00                    DF512:  DEFB 0
  F433    0000                  DF513:  DEFW 0            ;Adresse akt. DISKPuffer
  F435    0000                  DF515:  DEFW 0            ;zugeordneter DPH - Ende 9 Bytes
                                ;
  F437    04                    DF517:  DEFB 4            ;4 = READ, 6 = WRITE
  F438    0000                  DF518:  DEFW 0
  F43A    00                    DF51A:  DEFB 0
  F43B    00                    DF51B:  NOP
  F43C    00                    DF51C:  NOP
  F43D    00                    DF51D:  NOP
  F43E    00                    DF51E:  NOP
                                ;
  F43F                          DISKP:  DEFS 1024,0       ;HW-Sektor Puffer aller LW (1k max. fuer FDD)
  F83F                          DIRBF:  DEFS 128,0        ;1 REC Puffer fuer Direktory
  F8BF                          ALL00:  DEFS 128,0        ;2048k(max.) / 2k / 8 = 128
  F93F                          ALL01:  DEFS 50,0         ;0F99FH
  F971                          ALL02:  DEFS 504,0        ;0F9D1H
  FB69                          ALL03:  DEFS 256,0        ;0FBC9H
  FC69                          ALL04:  DEFS 256,0        ;0FCC9H
  FD69                          ALL05:  DEFS 50,0         ;0FDC9H
  FD9B                          ALL06:  DEFS 50,0         ;0FDFBH
  FDCD                          CHK01:  DEFS 32,0         ;0FE2DH
  FDED                          CHK05:  DEFS 32,0         ;0FE4DH
  FE0D                          CHK06:  DEFS 32,0         ;0FE6DH
                                ;
  FE2D    42 49 4F 53                   DEFM "BIOS-Ende"  ;nur fuer Frieder zur Info
  FE31    2D 45 6E 64           
  FE35    65                    
                                ;
                                ;
  FF80                          DFF80   EQU  0FF80H       ;Interrupt-Einsprungpunkt CTC Kanal 0
  FF82                          DFF82   EQU  0FF82H       ;Interrupt-Einsprungpunkt CTC Kanal 1
  FF84                          DFF84   EQU  0FF84H       ;Interrupt-Einsprungpunkt CTC Kanal 2
  FF86                          DFF86   EQU  0FF86H       ;Interrupt-Einsprungpunkt CTC Kanal 3
  FF88                          DFF88   EQU  0FF88H       ;Interrupt-Einsprungpunkt Nr.1 PIO1A
  FF8A                          DFF8A   EQU  0FF8AH       ;Interrupt-Einsprungpunkt Nr.2 PIO1A
                                ;
                                ;#############################   PortAdressen   ##############
                                ;
  0000                          P00     EQU  00H          ;CTC Kanal 0
  0001                          P01     EQU  01H          ;CTC Kanal 1
  0002                          P02     EQU  02H          ;CTC Kanal 2
  0003                          P03     EQU  03H          ;CTC Kanal 3
                                ;
  0004                          P04     EQU  04H          ;PIO_A-Daten
  0005                          P05     EQU  05H          ;PIO_B-Daten
  0006                          P06     EQU  06H          ;PIO_A-Control
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-36


  0014                          P14     EQU  14H          ;Modul_1 - ggf. EPROMs ausblenden
                                ;
  001E                          P1E     EQU  1EH          ;CP/M - Umschalter
                                ;
  008A                          P8A     EQU  8AH          ;GIDE Sector Count
  008B                          P8B     EQU  8BH          ;GIDE Sector Number
  008C                          P8C     EQU  8CH          ;GIDE Cylinder Low
  008D                          P8D     EQU  8DH          ;GIDE Cylinder High
  008E                          P8E     EQU  8EH          ;GIDE Drive and Head
  008F                          P8F     EQU  8FH          ;GIDE Command/Status
                                ;
                                        .DEPHASE
                                        END
	MACRO-80 3.44	09-Dec-81	PAGE	S


Macros:

Symbols:
E9AA 	AC1MOD          EFBF 	ADRAF1          EFC5 	ADRAF2          
EFCB 	ADRAF3          EFAC 	ADRRAF          F8BF 	ALL00           
F93F 	ALL01           F971 	ALL02           FB69 	ALL03           
FC69 	ALL04           FD69 	ALL05           FD9B 	ALL06           
185B 	ARG1            185D 	ARG2            EBBA 	BCL1            
EB8E 	BCLS            D806 	BDOS            0005 	BDOSF           
EA0C 	BEEP1           EA0D 	BEEP2           ECED 	BINTE           
ECDE 	BINVN           ECFA 	BIVIN           ECD0 	BNORM           
E864 	BOOT            E981 	BOOT1           E8F9 	BOOT2           
E901 	BOOT3           E912 	BOOT4           1818 	BREAK           
ED9D 	BWSCOL          EDAC 	BWSINI          EDA7 	BWSZ1           
EDA3 	BWSZEI          EBD3 	CBLO1           EBE8 	CBLO2           
EBD0 	CBLOE           181F 	CBWSB           EC67 	CCHA1           
EC57 	CCHAR           D000 	CCP             EBC9 	CCRET           
0040 	CFDC            F401 	CHAR            FDCD 	CHK01           
FDED 	CHK05           FE0D 	CHK06           EC47 	CHOCH           
EC4B 	CHOLI           EB85 	CHOME           F3A8 	CINSP           
EBAD 	CLEFT           EBB1 	CLF             EB0B 	COEN1           
F3F9 	COLO1           F3FA 	COLO2           F3F8 	COLOR           
D007 	COMLEN          EA57 	CONIN           EA65 	CONIN1          
EA87 	CONIN3          EA8D 	CONIN4          EACF 	CONOUT          
EA4F 	CONST           F3CE 	COUTSP          E967 	CPMERR          
E9A5 	CPMMOD          F3F7 	CPMSTK          EBF3 	CRIGH           
F414 	CTAB            F419 	CTCCNT          F3FD 	CUFLAG          
ED13 	CUOFF           ED0B 	CUON            1800 	CUPOS           
000F 	CUZEI           EC29 	CZLC1           EC3D 	CZLC2           
EC1E 	CZLCR           EBFD 	CZLO1           EC14 	CZLO2           
EBF7 	CZLOE           F408 	DF4E2           F409 	DF4E3           
F40A 	DF4E4           F40B 	DF4E5           F40C 	DF4E6           
F40D 	DF4E7           F40E 	DF4E8           F40F 	DF4E9           
F410 	DF4EA           F411 	DF4EB           F412 	DF4EC           
F416 	DF4F0           F417 	DF4F7           F418 	DF4F8           
F425 	DF505           F426 	DF506           F428 	DF508           
F42A 	DF50A           F42E 	DF50E           F42F 	DF50F           
F430 	DF510           F431 	DF511           F432 	DF512           
F433 	DF513           F435 	DF515           F437 	DF517           
F438 	DF518           F43A 	DF51A           F43B 	DF51B           
F43C 	DF51C           F43D 	DF51D           F43E 	DF51E           
0041 	DFDC            FF80 	DFF80           FF82 	DFF82           
FF84 	DFF84           FF86 	DFF86           FF88 	DFF88           
FF8A 	DFF8A           F83F 	DIRBF           F2CA 	DISCTX          
F43F 	DISKP           F421 	DMA             E77B 	DP1024          
E78A 	DP2048          E6C4 	DPB0            E6D5 	DPB1            
E6F1 	DPB2            E70D 	DPB3            E729 	DPB4            
E745 	DPB5            E761 	DPB6            F423 	DPH             
E652 	DPH0            E662 	DPH1            E672 	DPH2            
E682 	DPH3            E692 	DPH4            E6A2 	DPH5            
E6B2 	DPH6            E642 	DPHX            E644 	DPHY            
F41C 	DRIVE           E9B0 	EXIT            E9B4 	EXIT1           
F2F5 	GIDERW          EE04 	HOME            C000 	HPRDSK          
F2F2 	INTEND          0003 	IOBYTE          F2D7 	ISRCTC          
F2F1 	ISRCTE          EA24 	ISREND          EA2A 	ISRPA           
E9D7 	ISRTAS          ED1A 	KONV10          ED2D 	KONV20          
ED4B 	KONV21          ED6C 	KONV22          ED78 	KONV24          
EB23 	KONVT1          EAFC 	KONVT9          EB18 	KONVTB          
0045 	LATCH           F41A 	LATPU           EE49 	LEDEC           
EFE7 	LEFFA           EABC 	LEND1           EFED 	LF000           
EFEF 	LF002           F002 	LF015           F006 	LF019           
	MACRO-80 3.44	09-Dec-81	PAGE	S-1


F011 	LF024           F020 	LF033           F02A 	LF03D           
F05B 	LF06E           F062 	LF075           F07A 	LF08D           
F09B 	LF0AE           F0B6 	LF0C9           F0BB 	LF0CE           
F0BE 	LF0D1           F0CE 	LF0E1           F0D7 	LF0EA           
F0FD 	LF110           F110 	LF123           F124 	LF137           
F13D 	LF150           F14E 	LF161           F150 	LF163           
F162 	LF175           F17A 	LF18D           F1AE 	LF1C1           
F1B0 	LF1C3           F1B5 	LF1C8           F1BA 	LF1CD           
F1C2 	LF1D5           F1D4 	LF1E7           F1EB 	LF1FE           
F1F4 	LF207           F214 	LF227           F219 	LF22C           
F21D 	LF230           F220 	LF233           F223 	LF236           
F234 	LF247           F238 	LF24B           F23C 	LF24F           
F24D 	LF260           F272 	LF285           F294 	LF2A7           
F296 	LF2A9           F2A1 	LF2B4           F2AA 	LF2BD           
F2B6 	LF2C9           F306 	LF318           F30D 	LF31F           
F339 	LF34B           F34B 	LF35D           F34F 	LF361           
F354 	LF366           F364 	LF376           EAA6 	LIST            
EDE2 	LISTST          EFE6 	LOAD            0004 	LWBYTE          
ECA9 	MBEEP           ECAC 	MBEEP1          E9AC 	MOD1            
F25C 	MODE0           F262 	MODE1           0DF9 	MV24A           
E641 	NDISK           0066 	NMI             F406 	OLDNMI          
07F1 	OUTHL           EA3F 	OUTTXT          0000 	P00             
0001 	P01             0002 	P02             0003 	P03             
0004 	P04             0005 	P05             0006 	P06             
0014 	P14             001E 	P1E             008A 	P8A             
008B 	P8B             008C 	P8C             008D 	P8D             
008E 	P8E             008F 	P8F             00E0 	PE0             
00F0 	PF0             EA38 	PIO1TAB         EA3D 	PIO2TAB         
E9E4 	PRELL1          EA1F 	PRELL2          EAC2 	PUNCH           
F3FC 	RAFSEC          F3FB 	RAFTRK          EE8C 	RDERR           
EFA3 	RDERRO          EF42 	RDFOR1          EF4F 	RDFOR2          
EF02 	RDFORM          EEFE 	RDMERK          EF01 	RDSIZE          
EE4E 	RDSKRW          EE7E 	RDSKWR          EEA9 	RDTEST          
EEB5 	RDTST1          EECE 	RDTST2          EEE1 	RDTST3          
EEEE 	RDTST4          EE22 	READ            05CE 	REGIST          
01A5 	RSA             0038 	RST38           F24F 	RW              
F256 	RW01            F25E 	RW02            F41B 	RWBYTE          
EC92 	SCR11           ECA4 	SCR12           EC68 	SCROL           
F41F 	SECTOR          EE16 	SECTRN          EDE5 	SELDSK          
EE11 	SETDMA          EE0C 	SETSEC          EE07 	SETTRK          
F402 	SPCIN           F404 	SPCOUT          F3FE 	STZ00           
F3FF 	STZ01           F400 	STZ02           EA41 	TEXT1           
EA4C 	TEXT2           F41D 	TRACK           E799 	TXT01           
E840 	TXT01A          E845 	TXT01B          E84B 	TXT01C          
E851 	TXT02           EE9C 	TXTRDE          EE8F 	TXTRDI          
EE99 	TXTRDO          ECC0 	UPTON           ECC1 	UPTON1          
ECC9 	UPTON2          0043 	WAIT            0000 	WARMBT          
E928 	WBOOT           E94A 	WBOOT1          E603 	WBOOTB          
EF74 	WRCCP           EF85 	WRCCP1          EF8E 	WRCCP2          
EE27 	WRITE           FF00 	ZEIPUF          



No Fatal error(s)


